This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.

# File Summary

## Purpose
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: app/src/main/java/**/*.kt, network/src/main/java/**/*.kt, uikit/src/main/java/**/*.kt, app/src/test/**/*.kt, network/src/test/**/*.kt, uikit/src/test/**/*.kt, app/src/androidTest/**/*.kt, network/src/androidTest/**/*.kt, uikit/src/androidTest/**/*.kt, app/src/main/assets/products.json, app/src/main/AndroidManifest.xml, network/src/main/AndroidManifest.xml, uikit/src/main/AndroidManifest.xml, build.gradle.kts, settings.gradle.kts, app/build.gradle.kts, network/build.gradle.kts, uikit/build.gradle.kts, gradle/libs.versions.toml, gradle.properties
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)

# Directory Structure
```
app/build.gradle.kts
app/src/androidTest/java/com/example/lol/ExampleInstrumentedTest.kt
app/src/main/AndroidManifest.xml
app/src/main/assets/products.json
app/src/main/java/com/example/lol/authorization/AuthModeBanner.kt
app/src/main/java/com/example/lol/authorization/AuthRepositoryProvider.kt
app/src/main/java/com/example/lol/authorization/AuthViewModel.kt
app/src/main/java/com/example/lol/authorization/CreatePasswordScreen.kt
app/src/main/java/com/example/lol/authorization/CreatePinScreen.kt
app/src/main/java/com/example/lol/authorization/CredentialHelper.kt
app/src/main/java/com/example/lol/authorization/PinCodeScreen.kt
app/src/main/java/com/example/lol/authorization/SessionManager.kt
app/src/main/java/com/example/lol/authorization/SignInScreen.kt
app/src/main/java/com/example/lol/authorization/SignUpScreen.kt
app/src/main/java/com/example/lol/authorization/SplashScreen.kt
app/src/main/java/com/example/lol/Cart/CartScreen.kt
app/src/main/java/com/example/lol/Cart/CartViewModel.kt
app/src/main/java/com/example/lol/Catalogue/CatalogueScreen.kt
app/src/main/java/com/example/lol/Catalogue/CatalogueViewModel.kt
app/src/main/java/com/example/lol/data/cache/ProductCache.kt
app/src/main/java/com/example/lol/data/fake/FakeAuthRepository.kt
app/src/main/java/com/example/lol/data/fake/FakeCartRepository.kt
app/src/main/java/com/example/lol/data/fake/FakeOrderRepository.kt
app/src/main/java/com/example/lol/data/fake/FakeProductRepository.kt
app/src/main/java/com/example/lol/data/fake/FakeProjectRepository.kt
app/src/main/java/com/example/lol/data/ProductRepository.kt
app/src/main/java/com/example/lol/data/repository/IProductRepository.kt
app/src/main/java/com/example/lol/data/repository/MockAuthRepository.kt
app/src/main/java/com/example/lol/domain/usecase/auth/LoginUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/auth/LogoutUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/auth/RegisterUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/cart/AddToCartUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/cart/UpdateCartItemUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/product/GetProductsUseCase.kt
app/src/main/java/com/example/lol/domain/usecase/product/SearchProductsUseCase.kt
app/src/main/java/com/example/lol/Main/MainScreen.kt
app/src/main/java/com/example/lol/MainActivity.kt
app/src/main/java/com/example/lol/MatuleApplication.kt
app/src/main/java/com/example/lol/notifications/InactivityNotificationConfig.kt
app/src/main/java/com/example/lol/notifications/InactivityNotificationHelper.kt
app/src/main/java/com/example/lol/notifications/InactivityNotificationScheduler.kt
app/src/main/java/com/example/lol/notifications/OneShotInactivityWorker.kt
app/src/main/java/com/example/lol/notifications/RepeatingInactivityWorker.kt
app/src/main/java/com/example/lol/Profile/MyOrdersScreen.kt
app/src/main/java/com/example/lol/Profile/OrderDetailsScreen.kt
app/src/main/java/com/example/lol/Profile/OrdersViewModel.kt
app/src/main/java/com/example/lol/Profile/ProfileScreen.kt
app/src/main/java/com/example/lol/Projects/CreateProjectScreen.kt
app/src/main/java/com/example/lol/Projects/Project.kt
app/src/main/java/com/example/lol/Projects/ProjectDetailsScreen.kt
app/src/main/java/com/example/lol/Projects/ProjectsScreen.kt
app/src/main/java/com/example/lol/Projects/ProjectsViewModel.kt
app/src/main/java/com/example/lol/storybook/StorybookActivity.kt
app/src/main/java/com/example/lol/storybook/StorybookScreen.kt
app/src/test/java/com/example/lol/data/repository/AuthRepositoryTest.kt
app/src/test/java/com/example/lol/data/repository/CartRepositoryTest.kt
app/src/test/java/com/example/lol/data/repository/OrderRepositoryTest.kt
app/src/test/java/com/example/lol/data/repository/ProductRepositoryApiTest.kt
app/src/test/java/com/example/lol/data/repository/ProjectRepositoryTest.kt
app/src/test/java/com/example/lol/ExampleUnitTest.kt
app/src/test/java/com/example/lol/testdata/TestJsonResponses.kt
app/src/test/java/com/example/lol/viewmodel/AuthViewModelTest.kt
app/src/test/java/com/example/lol/viewmodel/CartViewModelTest.kt
app/src/test/java/com/example/lol/viewmodel/ProjectsViewModelTest.kt
build.gradle.kts
gradle.properties
gradle/libs.versions.toml
network/build.gradle.kts
network/src/main/AndroidManifest.xml
network/src/main/java/com/example/lol/data/network/api/MatuleApi.kt
network/src/main/java/com/example/lol/data/network/ITokenManager.kt
network/src/main/java/com/example/lol/data/network/models/Error400.kt
network/src/main/java/com/example/lol/data/network/models/News.kt
network/src/main/java/com/example/lol/data/network/models/ProductApi.kt
network/src/main/java/com/example/lol/data/network/models/ProductItem.kt
network/src/main/java/com/example/lol/data/network/models/ProjectApi.kt
network/src/main/java/com/example/lol/data/network/models/RequestAuth.kt
network/src/main/java/com/example/lol/data/network/models/RequestCart.kt
network/src/main/java/com/example/lol/data/network/models/RequestOrder.kt
network/src/main/java/com/example/lol/data/network/models/RequestProject.kt
network/src/main/java/com/example/lol/data/network/models/RequestRegister.kt
network/src/main/java/com/example/lol/data/network/models/RequestUser.kt
network/src/main/java/com/example/lol/data/network/models/ResponseAuth.kt
network/src/main/java/com/example/lol/data/network/models/ResponseCart.kt
network/src/main/java/com/example/lol/data/network/models/ResponseNews.kt
network/src/main/java/com/example/lol/data/network/models/ResponseOrder.kt
network/src/main/java/com/example/lol/data/network/models/ResponseProducts.kt
network/src/main/java/com/example/lol/data/network/models/ResponseProjects.kt
network/src/main/java/com/example/lol/data/network/models/ResponseRegister.kt
network/src/main/java/com/example/lol/data/network/models/User.kt
network/src/main/java/com/example/lol/data/network/models/UsersAuth.kt
network/src/main/java/com/example/lol/data/network/NetworkResult.kt
network/src/main/java/com/example/lol/data/network/RetrofitInstance.kt
network/src/main/java/com/example/lol/data/network/TokenManager.kt
network/src/main/java/com/example/lol/data/repository/AuthRepository.kt
network/src/main/java/com/example/lol/data/repository/CartRepository.kt
network/src/main/java/com/example/lol/data/repository/IAuthRepository.kt
network/src/main/java/com/example/lol/data/repository/ICartRepository.kt
network/src/main/java/com/example/lol/data/repository/IOrderRepository.kt
network/src/main/java/com/example/lol/data/repository/IProductRepositoryApi.kt
network/src/main/java/com/example/lol/data/repository/IProjectRepository.kt
network/src/main/java/com/example/lol/data/repository/OrderRepository.kt
network/src/main/java/com/example/lol/data/repository/ProductRepositoryApi.kt
network/src/main/java/com/example/lol/data/repository/ProjectRepository.kt
network/src/test/java/com/example/lol/data/repository/AuthRepositoryTest.kt
network/src/test/java/com/example/lol/data/repository/CartRepositoryTest.kt
network/src/test/java/com/example/lol/data/repository/OrderRepositoryTest.kt
network/src/test/java/com/example/lol/data/repository/ProductRepositoryApiTest.kt
network/src/test/java/com/example/lol/data/repository/ProjectRepositoryTest.kt
network/src/test/java/com/example/lol/testdata/TestJsonResponses.kt
settings.gradle.kts
uikit/build.gradle.kts
uikit/src/androidTest/java/com/example/lol/components/UiKitStateTest.kt
uikit/src/main/AndroidManifest.xml
uikit/src/main/java/com/example/lol/components/AppChip.kt
uikit/src/main/java/com/example/lol/components/AppHeader.kt
uikit/src/main/java/com/example/lol/components/AppSelectField.kt
uikit/src/main/java/com/example/lol/components/AppTabBar.kt
uikit/src/main/java/com/example/lol/components/AppTextField.kt
uikit/src/main/java/com/example/lol/components/ErrorNotification.kt
uikit/src/main/java/com/example/lol/components/GenderSelectionSheet.kt
uikit/src/main/java/com/example/lol/components/PhotoPickerBottomSheet.kt
uikit/src/main/java/com/example/lol/components/ProductCard.kt
uikit/src/main/java/com/example/lol/components/ProductDetailsSheet.kt
uikit/src/main/java/com/example/lol/components/SearchBar.kt
uikit/src/main/java/com/example/lol/components/UiKitSemantics.kt
uikit/src/main/java/com/example/lol/data/Product.kt
uikit/src/main/java/com/example/lol/ui/theme/Color.kt
uikit/src/main/java/com/example/lol/ui/theme/Theme.kt
uikit/src/main/java/com/example/lol/ui/theme/Type.kt
```

# Files

## File: app/src/androidTest/java/com/example/lol/ExampleInstrumentedTest.kt
```kotlin
package com.example.lol

import androidx.test.platform.app.InstrumentationRegistry
import androidx.test.ext.junit.runners.AndroidJUnit4

import org.junit.Test
import org.junit.runner.RunWith

import org.junit.Assert.*

/**
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // Context of the app under test.
        val appContext = InstrumentationRegistry.getInstrumentation().targetContext
        assertEquals("com.example.lol", appContext.packageName)
    }
}
```

## File: app/src/main/java/com/example/lol/authorization/AuthModeBanner.kt
```kotlin
package com.example.lol.authorization

import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier

@Suppress("UNUSED_PARAMETER")
@Composable
fun AuthModeBanner(modifier: Modifier = Modifier) {
    // Intentionally hidden in app UI.
}
```

## File: app/src/main/java/com/example/lol/authorization/AuthRepositoryProvider.kt
```kotlin
package com.example.lol.authorization

import android.util.Log
import com.example.lol.data.network.ITokenManager
import com.example.lol.data.network.RetrofitInstance
import com.example.lol.data.repository.AuthRepository
import com.example.lol.data.repository.IAuthRepository
import com.example.lol.data.repository.MockAuthRepository

object AuthRuntimeConfig {
    const val useMockAuthInRuntime: Boolean = true
}

object AuthRepositoryProvider {

    fun provide(tokenManager: ITokenManager): IAuthRepository {
        val repository =
            if (AuthRuntimeConfig.useMockAuthInRuntime) {
                MockAuthRepository.instance
            } else {
                AuthRepository(RetrofitInstance.api, tokenManager)
            }

        Log.i("AuthRuntime", "Auth repository mode: ${modeLabel()}")
        return repository
    }

    fun modeLabel(): String {
        return if (AuthRuntimeConfig.useMockAuthInRuntime) {
            "MockAuth mode"
        } else {
            "Network auth mode"
        }
    }

    fun isMockMode(): Boolean = AuthRuntimeConfig.useMockAuthInRuntime
}
```

## File: app/src/main/java/com/example/lol/authorization/CredentialHelper.kt
```kotlin
package com.example.lol.authorization

import android.content.Context
import androidx.credentials.CreatePasswordRequest
import androidx.credentials.CredentialManager
import androidx.credentials.exceptions.CreateCredentialCancellationException
import androidx.credentials.exceptions.CreateCredentialException

/**
 * Helper для сохранения учётных данных в Google Password Manager. Использует Android Credential
 * Manager API.
 */
class CredentialHelper(context: Context) {
    private val credentialManager = CredentialManager.create(context)

    /**
     * Сохраняет email и пароль пользователя в Google Password Manager.
     * @param context Контекст (должен быть Activity)
     * @param email Email пользователя (используется как ID)
     * @param password Пароль пользователя
     * @return true если сохранено успешно, false если пользователь отменил или произошла ошибка
     */
    suspend fun saveCredentials(context: Context, email: String, password: String): Boolean {
        return try {
            val request = CreatePasswordRequest(id = email, password = password)
            credentialManager.createCredential(context = context, request = request)
            true
        } catch (e: CreateCredentialCancellationException) {
            // Пользователь отменил сохранение - это нормально
            false
        } catch (e: CreateCredentialException) {
            // Другая ошибка - логируем, но не показываем пользователю
            false
        } catch (e: Exception) {
            // Общая ошибка
            false
        }
    }
}
```

## File: app/src/main/java/com/example/lol/data/cache/ProductCache.kt
```kotlin
package com.example.lol.data.cache

import android.content.Context
import android.content.SharedPreferences
import com.example.lol.data.Product
import com.google.gson.Gson
import com.google.gson.reflect.TypeToken

class ProductCache(context: Context) {
    private val prefs: SharedPreferences = context.getSharedPreferences("product_cache", Context.MODE_PRIVATE)
    private val gson = Gson()

    fun saveProducts(products: List<Product>) {
        val json = gson.toJson(products)
        prefs.edit().putString("cached_products", json).apply()
    }

    fun getProducts(): List<Product>? {
        val json = prefs.getString("cached_products", null) ?: return null
        val type = object : TypeToken<List<Product>>() {}.type
        return try {
            gson.fromJson(json, type)
        } catch (e: Exception) {
            null
        }
    }
    
    fun clearCache() {
        prefs.edit().clear().apply()
    }
}
```

## File: app/src/main/java/com/example/lol/data/fake/FakeAuthRepository.kt
```kotlin
package com.example.lol.data.fake

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseAuth
import com.example.lol.data.network.models.ResponseRegister
import com.example.lol.data.network.models.User
import com.example.lol.data.repository.IAuthRepository

/**
 * Fake реализация IAuthRepository для unit-тестов. Позволяет настраивать ответы без реальных
 * сетевых запросов.
 */
class FakeAuthRepository : IAuthRepository {

    private var registerResult: NetworkResult<ResponseRegister> =
            NetworkResult.Error("Not configured")
    private var loginResult: NetworkResult<ResponseAuth> = NetworkResult.Error("Not configured")
    private var getUserResult: NetworkResult<User> = NetworkResult.Error("Not configured")
    private var updateUserResult: NetworkResult<User> = NetworkResult.Error("Not configured")
    private var logoutResult: NetworkResult<Unit> = NetworkResult.Success(Unit)

    // Счётчики вызовов для верификации
    var registerCallCount = 0
        private set
    var loginCallCount = 0
        private set
    var getUserCallCount = 0
        private set
    var updateUserCallCount = 0
        private set
    var logoutCallCount = 0
        private set

    // Последние переданные параметры
    var lastRegisterEmail: String? = null
        private set
    var lastLoginEmail: String? = null
        private set
    var lastLoginPassword: String? = null
        private set

    /** Настраивает успешный ответ на регистрацию. */
    fun setRegisterSuccess(response: ResponseRegister) {
        registerResult = NetworkResult.Success(response)
    }

    /** Настраивает ошибку регистрации. */
    fun setRegisterError(message: String, code: Int? = null) {
        registerResult = NetworkResult.Error(message, code)
    }

    /** Настраивает успешный ответ на авторизацию. */
    fun setLoginSuccess(response: ResponseAuth) {
        loginResult = NetworkResult.Success(response)
    }

    /** Настраивает ошибку авторизации. */
    fun setLoginError(message: String, code: Int? = null) {
        loginResult = NetworkResult.Error(message, code)
    }

    /** Настраивает успешный ответ получения пользователя. */
    fun setGetUserSuccess(user: User) {
        getUserResult = NetworkResult.Success(user)
    }

    /** Настраивает ошибку получения пользователя. */
    fun setGetUserError(message: String, code: Int? = null) {
        getUserResult = NetworkResult.Error(message, code)
    }

    /** Настраивает успешный ответ обновления пользователя. */
    fun setUpdateUserSuccess(user: User) {
        updateUserResult = NetworkResult.Success(user)
    }

    /** Настраивает ошибку обновления пользователя. */
    fun setUpdateUserError(message: String, code: Int? = null) {
        updateUserResult = NetworkResult.Error(message, code)
    }

    /** Настраивает ошибку logout. */
    fun setLogoutError(message: String) {
        logoutResult = NetworkResult.Error(message)
    }

    /** Сброс всех счётчиков и настроек. */
    fun reset() {
        registerCallCount = 0
        loginCallCount = 0
        getUserCallCount = 0
        updateUserCallCount = 0
        logoutCallCount = 0
        lastRegisterEmail = null
        lastLoginEmail = null
        lastLoginPassword = null
    }

    override suspend fun register(
            email: String,
            password: String
    ): NetworkResult<ResponseRegister> {
        registerCallCount++
        lastRegisterEmail = email
        return registerResult
    }

    override suspend fun login(email: String, password: String): NetworkResult<ResponseAuth> {
        loginCallCount++
        lastLoginEmail = email
        lastLoginPassword = password
        return loginResult
    }

    override suspend fun getUser(userId: String): NetworkResult<User> {
        getUserCallCount++
        return getUserResult
    }

    override suspend fun updateUser(
            userId: String,
            firstname: String?,
            lastname: String?,
            secondname: String?,
            datebirthday: String?,
            gender: String?
    ): NetworkResult<User> {
        updateUserCallCount++
        return updateUserResult
    }

    override suspend fun logout(): NetworkResult<Unit> {
        logoutCallCount++
        return logoutResult
    }
}
```

## File: app/src/main/java/com/example/lol/data/fake/FakeCartRepository.kt
```kotlin
package com.example.lol.data.fake

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseCart
import com.example.lol.data.repository.ICartRepository

/** Fake реализация ICartRepository для unit-тестов. */
class FakeCartRepository : ICartRepository {

    private var addToCartResult: NetworkResult<ResponseCart> = NetworkResult.Error("Not configured")
    private var updateCartItemResult: NetworkResult<ResponseCart> =
            NetworkResult.Error("Not configured")

    var addToCartCallCount = 0
        private set
    var updateCartItemCallCount = 0
        private set

    var lastAddedProductId: String? = null
        private set
    var lastAddedCount: Int? = null
        private set
    var lastUpdatedCartItemId: String? = null
        private set
    var lastUpdatedCount: Int? = null
        private set

    fun setAddToCartSuccess(response: ResponseCart) {
        addToCartResult = NetworkResult.Success(response)
    }

    fun setAddToCartError(message: String, code: Int? = null) {
        addToCartResult = NetworkResult.Error(message, code)
    }

    fun setUpdateCartItemSuccess(response: ResponseCart) {
        updateCartItemResult = NetworkResult.Success(response)
    }

    fun setUpdateCartItemError(message: String, code: Int? = null) {
        updateCartItemResult = NetworkResult.Error(message, code)
    }

    fun reset() {
        addToCartCallCount = 0
        updateCartItemCallCount = 0
        lastAddedProductId = null
        lastAddedCount = null
        lastUpdatedCartItemId = null
        lastUpdatedCount = null
    }

    override suspend fun addToCart(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        addToCartCallCount++
        lastAddedProductId = productId
        lastAddedCount = count
        return addToCartResult
    }

    override suspend fun updateCartItem(
            cartItemId: String,
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        updateCartItemCallCount++
        lastUpdatedCartItemId = cartItemId
        lastUpdatedCount = count
        return updateCartItemResult
    }
}
```

## File: app/src/main/java/com/example/lol/data/fake/FakeOrderRepository.kt
```kotlin
package com.example.lol.data.fake

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseOrder
import com.example.lol.data.repository.IOrderRepository

/** Fake реализация IOrderRepository для unit-тестов. */
class FakeOrderRepository : IOrderRepository {

    private var createOrderResult: NetworkResult<ResponseOrder> =
            NetworkResult.Error("Not configured")

    var createOrderCallCount = 0
        private set

    var lastOrderProductId: String? = null
        private set
    var lastOrderCount: Int? = null
        private set

    fun setCreateOrderSuccess(response: ResponseOrder) {
        createOrderResult = NetworkResult.Success(response)
    }

    fun setCreateOrderError(message: String, code: Int? = null) {
        createOrderResult = NetworkResult.Error(message, code)
    }

    fun reset() {
        createOrderCallCount = 0
        lastOrderProductId = null
        lastOrderCount = null
    }

    override suspend fun createOrder(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseOrder> {
        createOrderCallCount++
        lastOrderProductId = productId
        lastOrderCount = count
        return createOrderResult
    }
}
```

## File: app/src/main/java/com/example/lol/data/fake/FakeProductRepository.kt
```kotlin
package com.example.lol.data.fake

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.News
import com.example.lol.data.network.models.ProductApi
import com.example.lol.data.network.models.ProductItem
import com.example.lol.data.repository.IProductRepositoryApi

/** Fake реализация IProductRepositoryApi для unit-тестов. */
class FakeProductRepository : IProductRepositoryApi {

    private var productsResult: NetworkResult<List<ProductItem>> =
            NetworkResult.Success(emptyList())
    private var productByIdResult: NetworkResult<ProductApi> = NetworkResult.Error("Not configured")
    private var searchResult: NetworkResult<List<ProductItem>> = NetworkResult.Success(emptyList())
    private var newsResult: NetworkResult<List<News>> = NetworkResult.Success(emptyList())

    var getProductsCallCount = 0
        private set
    var getProductByIdCallCount = 0
        private set
    var searchProductsCallCount = 0
        private set
    var getNewsCallCount = 0
        private set

    var lastSearchQuery: String? = null
        private set
    var lastProductId: String? = null
        private set

    fun setProductsSuccess(products: List<ProductItem>) {
        productsResult = NetworkResult.Success(products)
    }

    fun setProductsError(message: String, code: Int? = null) {
        productsResult = NetworkResult.Error(message, code)
    }

    fun setProductByIdSuccess(product: ProductApi) {
        productByIdResult = NetworkResult.Success(product)
    }

    fun setProductByIdError(message: String, code: Int? = null) {
        productByIdResult = NetworkResult.Error(message, code)
    }

    fun setSearchSuccess(products: List<ProductItem>) {
        searchResult = NetworkResult.Success(products)
    }

    fun setSearchError(message: String, code: Int? = null) {
        searchResult = NetworkResult.Error(message, code)
    }

    fun setNewsSuccess(news: List<News>) {
        newsResult = NetworkResult.Success(news)
    }

    fun setNewsError(message: String, code: Int? = null) {
        newsResult = NetworkResult.Error(message, code)
    }

    fun reset() {
        getProductsCallCount = 0
        getProductByIdCallCount = 0
        searchProductsCallCount = 0
        getNewsCallCount = 0
        lastSearchQuery = null
        lastProductId = null
    }

    override suspend fun getProducts(): NetworkResult<List<ProductItem>> {
        getProductsCallCount++
        return productsResult
    }

    override suspend fun getProductById(productId: String): NetworkResult<ProductApi> {
        getProductByIdCallCount++
        lastProductId = productId
        return productByIdResult
    }

    override suspend fun searchProducts(query: String): NetworkResult<List<ProductItem>> {
        searchProductsCallCount++
        lastSearchQuery = query
        return searchResult
    }

    override suspend fun getNews(): NetworkResult<List<News>> {
        getNewsCallCount++
        return newsResult
    }
}
```

## File: app/src/main/java/com/example/lol/data/fake/FakeProjectRepository.kt
```kotlin
package com.example.lol.data.fake

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ProjectApi
import com.example.lol.data.repository.IProjectRepository
import java.io.File

/** Fake реализация IProjectRepository для unit-тестов. */
class FakeProjectRepository : IProjectRepository {

    private var getProjectsResult: NetworkResult<List<ProjectApi>> =
            NetworkResult.Success(emptyList())
    private var createProjectResult: NetworkResult<ProjectApi> =
            NetworkResult.Error("Not configured")

    var getProjectsCallCount = 0
        private set
    var createProjectCallCount = 0
        private set

    var lastCreatedTitle: String? = null
        private set
    var lastCreatedCategory: String? = null
        private set

    fun setGetProjectsSuccess(projects: List<ProjectApi>) {
        getProjectsResult = NetworkResult.Success(projects)
    }

    fun setGetProjectsError(message: String, code: Int? = null) {
        getProjectsResult = NetworkResult.Error(message, code)
    }

    fun setCreateProjectSuccess(project: ProjectApi) {
        createProjectResult = NetworkResult.Success(project)
    }

    fun setCreateProjectError(message: String, code: Int? = null) {
        createProjectResult = NetworkResult.Error(message, code)
    }

    fun reset() {
        getProjectsCallCount = 0
        createProjectCallCount = 0
        lastCreatedTitle = null
        lastCreatedCategory = null
    }

    override suspend fun getProjects(): NetworkResult<List<ProjectApi>> {
        getProjectsCallCount++
        return getProjectsResult
    }

    override suspend fun createProject(
            title: String,
            typeProject: String,
            userId: String,
            dateStart: String,
            dateEnd: String,
            gender: String,
            descriptionSource: String,
            category: String,
            image: File?
    ): NetworkResult<ProjectApi> {
        createProjectCallCount++
        lastCreatedTitle = title
        lastCreatedCategory = category
        return createProjectResult
    }
}
```

## File: app/src/main/java/com/example/lol/data/repository/IProductRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.Product

interface IProductRepository {
    fun getProducts(): List<Product>
    fun getProductById(id: Int): Product?
    fun searchProducts(query: String): List<Product>
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/auth/LoginUseCase.kt
```kotlin
package com.example.lol.domain.usecase.auth

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseAuth
import com.example.lol.data.repository.IAuthRepository

class LoginUseCase(private val authRepository: IAuthRepository) {
    suspend operator fun invoke(email: String, password: String): NetworkResult<ResponseAuth> {
        return authRepository.login(email, password)
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/auth/LogoutUseCase.kt
```kotlin
package com.example.lol.domain.usecase.auth

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.repository.IAuthRepository

class LogoutUseCase(private val authRepository: IAuthRepository) {
    suspend operator fun invoke(): NetworkResult<Unit> {
        return authRepository.logout()
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/auth/RegisterUseCase.kt
```kotlin
package com.example.lol.domain.usecase.auth

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseRegister
import com.example.lol.data.repository.IAuthRepository

class RegisterUseCase(private val authRepository: IAuthRepository) {
    suspend operator fun invoke(email: String, password: String): NetworkResult<ResponseRegister> {
        return authRepository.register(email, password)
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/cart/AddToCartUseCase.kt
```kotlin
package com.example.lol.domain.usecase.cart

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseCart
import com.example.lol.data.repository.ICartRepository

class AddToCartUseCase(private val cartRepository: ICartRepository) {
    suspend operator fun invoke(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        return cartRepository.addToCart(userId, productId, count)
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/cart/UpdateCartItemUseCase.kt
```kotlin
package com.example.lol.domain.usecase.cart

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseCart
import com.example.lol.data.repository.ICartRepository

class UpdateCartItemUseCase(private val cartRepository: ICartRepository) {
    suspend operator fun invoke(
            cartItemId: String,
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        return cartRepository.updateCartItem(cartItemId, userId, productId, count)
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/product/GetProductsUseCase.kt
```kotlin
package com.example.lol.domain.usecase.product

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ProductItem
import com.example.lol.data.repository.IProductRepositoryApi

class GetProductsUseCase(private val productRepository: IProductRepositoryApi) {
    suspend operator fun invoke(): NetworkResult<List<ProductItem>> {
        return productRepository.getProducts()
    }
}
```

## File: app/src/main/java/com/example/lol/domain/usecase/product/SearchProductsUseCase.kt
```kotlin
package com.example.lol.domain.usecase.product

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ProductItem
import com.example.lol.data.repository.IProductRepositoryApi

class SearchProductsUseCase(private val productRepository: IProductRepositoryApi) {
    suspend operator fun invoke(query: String): NetworkResult<List<ProductItem>> {
        return productRepository.searchProducts(query)
    }
}
```

## File: app/src/main/java/com/example/lol/MatuleApplication.kt
```kotlin
package com.example.lol

import android.app.Application
import androidx.work.Configuration
import coil.ImageLoader
import coil.ImageLoaderFactory
import coil.disk.DiskCache
import coil.memory.MemoryCache

class MatuleApplication : Application(), Configuration.Provider, ImageLoaderFactory {

    override val workManagerConfiguration: Configuration
        get() = Configuration.Builder().setMinimumLoggingLevel(android.util.Log.INFO).build()

    override fun newImageLoader(): ImageLoader {
        return ImageLoader.Builder(this)
                .memoryCache { MemoryCache.Builder(this).maxSizePercent(0.25).build() }
                .diskCache {
                    DiskCache.Builder()
                            .directory(cacheDir.resolve("image_cache"))
                            .maxSizePercent(0.02)
                            .build()
                }
                .crossfade(true)
                .build()
    }

    override fun onCreate() {
        super.onCreate()
    }
}
```

## File: app/src/main/java/com/example/lol/notifications/InactivityNotificationConfig.kt
```kotlin
package com.example.lol.notifications

object InactivityNotificationConfig {
    const val CHANNEL_ID = "inactivity_channel"
    const val CHANNEL_NAME = "Inactivity Notifications"

    const val REPEATING_WORK_NAME = "inactivity_repeating_work"
    const val ONE_SHOT_WORK_NAME = "inactivity_one_shot_work"

    const val REPEATING_NOTIFICATION_ID = 1001
    const val ONE_SHOT_NOTIFICATION_ID = 1002
}
```

## File: app/src/main/java/com/example/lol/notifications/InactivityNotificationHelper.kt
```kotlin
package com.example.lol.notifications

import android.app.NotificationChannel
import android.app.NotificationManager
import android.app.PendingIntent
import android.content.Context
import android.content.Intent
import android.os.Build
import androidx.core.app.NotificationCompat
import com.example.lol.MainActivity
import com.example.lol.R

object InactivityNotificationHelper {

    fun showNotification(
        context: Context,
        notificationId: Int,
        title: String,
        message: String
    ) {
        val notificationManager =
            context.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager

        ensureChannel(notificationManager)

        val intent = Intent(context, MainActivity::class.java).apply {
            flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK
        }
        val pendingIntent =
            PendingIntent.getActivity(
                context,
                notificationId,
                intent,
                PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_IMMUTABLE
            )

        val notification =
            NotificationCompat.Builder(context, InactivityNotificationConfig.CHANNEL_ID)
                .setSmallIcon(R.drawable.ic_launcher_foreground)
                .setContentTitle(title)
                .setContentText(message)
                .setPriority(NotificationCompat.PRIORITY_DEFAULT)
                .setContentIntent(pendingIntent)
                .setAutoCancel(true)
                .build()

        notificationManager.notify(notificationId, notification)
    }

    private fun ensureChannel(notificationManager: NotificationManager) {
        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) return

        val channel =
            NotificationChannel(
                InactivityNotificationConfig.CHANNEL_ID,
                InactivityNotificationConfig.CHANNEL_NAME,
                NotificationManager.IMPORTANCE_DEFAULT
            )
        notificationManager.createNotificationChannel(channel)
    }
}
```

## File: app/src/main/java/com/example/lol/notifications/InactivityNotificationScheduler.kt
```kotlin
package com.example.lol.notifications

import android.content.Context
import androidx.work.ExistingWorkPolicy
import androidx.work.OneTimeWorkRequestBuilder
import androidx.work.WorkManager
import com.example.lol.authorization.SessionManager
import java.util.concurrent.TimeUnit

object InactivityNotificationScheduler {

    fun schedule(context: Context, sessionManager: SessionManager) {
        if (!sessionManager.isNotificationsEnabled()) return

        val repeatingRequest =
            OneTimeWorkRequestBuilder<RepeatingInactivityWorker>()
                .setInitialDelay(30, TimeUnit.SECONDS)
                .build()

        WorkManager.getInstance(context)
            .enqueueUniqueWork(
                InactivityNotificationConfig.REPEATING_WORK_NAME,
                ExistingWorkPolicy.REPLACE,
                repeatingRequest
            )

        if (!sessionManager.isOneShotInactivityNotificationSent()) {
            val oneShotRequest =
                OneTimeWorkRequestBuilder<OneShotInactivityWorker>()
                    .setInitialDelay(1, TimeUnit.MINUTES)
                    .build()

            WorkManager.getInstance(context)
                .enqueueUniqueWork(
                    InactivityNotificationConfig.ONE_SHOT_WORK_NAME,
                    ExistingWorkPolicy.REPLACE,
                    oneShotRequest
                )
        }
    }

    fun cancel(context: Context) {
        val workManager = WorkManager.getInstance(context)
        workManager.cancelUniqueWork(InactivityNotificationConfig.REPEATING_WORK_NAME)
        workManager.cancelUniqueWork(InactivityNotificationConfig.ONE_SHOT_WORK_NAME)
    }
}
```

## File: app/src/main/java/com/example/lol/notifications/OneShotInactivityWorker.kt
```kotlin
package com.example.lol.notifications

import android.content.Context
import androidx.work.ListenableWorker
import androidx.work.Worker
import androidx.work.WorkerParameters
import com.example.lol.authorization.SessionManager

class OneShotInactivityWorker(context: Context, params: WorkerParameters) : Worker(context, params) {

    override fun doWork(): ListenableWorker.Result {
        val sessionManager = SessionManager(applicationContext)
        if (sessionManager.isOneShotInactivityNotificationSent()) {
            return ListenableWorker.Result.success()
        }

        InactivityNotificationHelper.showNotification(
            context = applicationContext,
            notificationId = InactivityNotificationConfig.ONE_SHOT_NOTIFICATION_ID,
            title = "Вернитесь в приложение",
            message = "Мы сохранили ваш прогресс. Продолжите с места, где остановились."
        )
        sessionManager.markOneShotInactivityNotificationSent()

        return ListenableWorker.Result.success()
    }
}
```

## File: app/src/main/java/com/example/lol/notifications/RepeatingInactivityWorker.kt
```kotlin
package com.example.lol.notifications

import android.content.Context
import androidx.work.ExistingWorkPolicy
import androidx.work.ListenableWorker
import androidx.work.OneTimeWorkRequestBuilder
import androidx.work.WorkManager
import androidx.work.Worker
import androidx.work.WorkerParameters
import java.util.concurrent.TimeUnit

class RepeatingInactivityWorker(context: Context, params: WorkerParameters) : Worker(context, params) {

    override fun doWork(): ListenableWorker.Result {
        InactivityNotificationHelper.showNotification(
            context = applicationContext,
            notificationId = InactivityNotificationConfig.REPEATING_NOTIFICATION_ID,
            title = "Вы давно не заходили",
            message = "Откройте приложение, чтобы продолжить работу над проектами."
        )

        scheduleNextTick()
        return ListenableWorker.Result.success()
    }

    private fun scheduleNextTick() {
        val nextRequest =
            OneTimeWorkRequestBuilder<RepeatingInactivityWorker>()
                .setInitialDelay(2, TimeUnit.MINUTES)
                .build()

        WorkManager.getInstance(applicationContext)
            .enqueueUniqueWork(
                InactivityNotificationConfig.REPEATING_WORK_NAME,
                ExistingWorkPolicy.REPLACE,
                nextRequest
            )
    }
}
```

## File: app/src/main/java/com/example/lol/Profile/OrderDetailsScreen.kt
```kotlin
package com.example.lol.Profile

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.HorizontalDivider
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.*

@Composable
fun OrderDetailsScreen(navController: NavController, viewModel: OrdersViewModel, orderId: String) {
        val orders by viewModel.orders.collectAsState()
        val order = orders.find { it.id == orderId }

        Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
                // Header
                Box(
                        modifier =
                                Modifier.fillMaxWidth()
                                        .padding(
                                                top = 52.dp,
                                                bottom = 12.dp,
                                                start = 20.dp,
                                                end = 20.dp
                                        )
                ) {
                        IconButton(
                                onClick = {
                                        if (!navController.popBackStack()) {
                                                navController.navigate("MyOrders") {
                                                        popUpTo(
                                                                navController
                                                                        .graph
                                                                        .startDestinationId
                                                        ) { inclusive = true }
                                                }
                                        }
                                },
                                modifier =
                                        Modifier.align(Alignment.CenterStart)
                                                .size(32.dp)
                                                .background(
                                                        Color(0xFFF5F5F9),
                                                        RoundedCornerShape(8.dp)
                                                )
                        ) {
                                Icon(
                                        painter =
                                                painterResource(id = R.drawable.icon_chevron_left),
                                        contentDescription = "Back",
                                        tint = Color.Black,
                                        modifier = Modifier.size(24.dp)
                                )
                        }
                        Text(
                                text = "Детали заказа",
                                style = Title2Semibold,
                                modifier = Modifier.align(Alignment.Center),
                                color = Color.Black
                        )
                        if (order != null) {
                                IconButton(
                                        onClick = {
                                                viewModel.removeOrder(order.id)
                                                navController.popBackStack()
                                        },
                                        modifier = Modifier.align(Alignment.CenterEnd).size(32.dp)
                                ) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id = R.drawable.icon_delete
                                                        ),
                                                contentDescription = "Delete",
                                                tint = Color.Red,
                                                modifier = Modifier.size(24.dp)
                                        )
                                }
                        }
                }

                HorizontalDivider(color = Color(0xFFF4F4F4), thickness = 1.dp)

                if (order == null) {
                        Box(
                                modifier = Modifier.fillMaxSize(),
                                contentAlignment = Alignment.Center
                        ) { Text("Заказ не найден", style = Title3Semibold, color = Color.Gray) }
                } else {
                        LazyColumn(
                                contentPadding = PaddingValues(20.dp),
                                verticalArrangement = Arrangement.spacedBy(16.dp)
                        ) {
                                // Order Info Card
                                item {
                                        Box(
                                                modifier =
                                                        Modifier.fillMaxWidth()
                                                                .background(
                                                                        Color(0xFFF5F5F9),
                                                                        RoundedCornerShape(12.dp)
                                                                )
                                                                .padding(16.dp)
                                        ) {
                                                Column {
                                                        Row(
                                                                modifier = Modifier.fillMaxWidth(),
                                                                horizontalArrangement =
                                                                        Arrangement.SpaceBetween
                                                        ) {
                                                                Text(
                                                                        text = "Заказ ${order.id}",
                                                                        style = Title3Semibold,
                                                                        color = Color.Black
                                                                )
                                                                Text(
                                                                        text = order.status,
                                                                        style = CaptionSemibold,
                                                                        color =
                                                                                if (order.status ==
                                                                                                "Отменен"
                                                                                )
                                                                                        Color.Red
                                                                                else if (order.status ==
                                                                                                "В обработке"
                                                                                )
                                                                                        Color(
                                                                                                0xFFFFA500
                                                                                        )
                                                                                else
                                                                                        Color(
                                                                                                0xFF00BFA5
                                                                                        )
                                                                )
                                                        }
                                                        Spacer(modifier = Modifier.height(8.dp))
                                                        Row(
                                                                modifier = Modifier.fillMaxWidth(),
                                                                horizontalArrangement =
                                                                        Arrangement.SpaceBetween
                                                        ) {
                                                                Text(
                                                                        text = order.date,
                                                                        style = CaptionRegular,
                                                                        color = Color(0xFF939396)
                                                                )
                                                                Text(
                                                                        text = order.totalPrice,
                                                                        style = Title3Semibold,
                                                                        color = AccentBlue
                                                                )
                                                        }
                                                }
                                        }
                                }

                                // Items Header
                                item {
                                        Text(
                                                text = "Товары",
                                                style = Title3Semibold,
                                                color = Color.Black
                                        )
                                }

                                // Order Items
                                items(order.items) { item ->
                                        Box(
                                                modifier =
                                                        Modifier.fillMaxWidth()
                                                                .background(
                                                                        Color.White,
                                                                        RoundedCornerShape(12.dp)
                                                                )
                                                                .padding(12.dp)
                                        ) {
                                                Row(
                                                        modifier = Modifier.fillMaxWidth(),
                                                        horizontalArrangement =
                                                                Arrangement.SpaceBetween,
                                                        verticalAlignment =
                                                                Alignment.CenterVertically
                                                ) {
                                                        Column(modifier = Modifier.weight(1f)) {
                                                                Text(
                                                                        text = item.product.title,
                                                                        style = TextMedium,
                                                                        color = Color.Black
                                                                )
                                                                Spacer(
                                                                        modifier =
                                                                                Modifier.height(
                                                                                        4.dp
                                                                                )
                                                                )
                                                                Text(
                                                                        text =
                                                                                "${item.quantity} шт.",
                                                                        style = CaptionRegular,
                                                                        color = Color(0xFF939396)
                                                                )
                                                        }
                                                        Text(
                                                                text =
                                                                        "${item.product.price * item.quantity} ₽",
                                                                style = TextMedium,
                                                                color = Color.Black
                                                        )
                                                }
                                        }
                                        HorizontalDivider(
                                                color = Color(0xFFF4F4F4),
                                                thickness = 1.dp
                                        )
                                }
                        }
                }
        }
}
```

## File: app/src/main/java/com/example/lol/Profile/OrdersViewModel.kt
```kotlin
package com.example.lol.Profile

import android.app.Application
import android.content.Context
import androidx.lifecycle.AndroidViewModel
import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import com.example.lol.Cart.CartItem
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.TokenManager
import com.example.lol.data.repository.IOrderRepository
import com.google.gson.Gson
import com.google.gson.reflect.TypeToken
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale
import java.util.UUID
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch

/**
 * Модель заказа.
 * @param id Уникальный идентификатор заказа
 * @param date Дата создания заказа
 * @param totalPrice Общая стоимость заказа (форматированная строка)
 * @param status Статус заказа
 * @param items Список товаров в заказе
 * @param serverIds Список ID записей на сервере (для каждого товара)
 */
data class Order(
        val id: String,
        val date: String,
        val totalPrice: String,
        val status: String,
        val items: List<CartItem>,
        val serverIds: List<String> = emptyList() // ID заказов на сервере
)

/** Состояние операций с заказами. */
sealed class OrderState {
    object Idle : OrderState()
    object Loading : OrderState()
    object Success : OrderState()
    data class Error(val message: String) : OrderState()
}

/**
 * ViewModel для управления заказами. Синхронизирует заказы с сервером через IOrderRepository и
 * кэширует локально.
 *
 * @param application Контекст приложения для SharedPreferences
 * @param orderRepository Репозиторий для работы с API заказов (опционально)
 * @param tokenManager Менеджер токенов для получения userId (опционально)
 */
class OrdersViewModel(
        application: Application,
        private val orderRepository: IOrderRepository? = null,
        private val tokenManager: TokenManager? = null
) : AndroidViewModel(application) {

    private val prefs = application.getSharedPreferences("orders_prefs", Context.MODE_PRIVATE)
    private val gson = Gson()

    private val _orders = MutableStateFlow<List<Order>>(emptyList())
    val orders: StateFlow<List<Order>> = _orders.asStateFlow()

    private val _orderState = MutableStateFlow<OrderState>(OrderState.Idle)
    val orderState: StateFlow<OrderState> = _orderState.asStateFlow()

    init {
        loadOrders()
    }

    /** Загрузка заказов из локального кэша. */
    private fun loadOrders() {
        val json = prefs.getString("orders_list", null)
        if (json != null) {
            val type = object : TypeToken<List<Order>>() {}.type
            _orders.value = gson.fromJson(json, type)
        }
    }

    /**
     * Создание заказа. При наличии API-репозитория синхронизирует каждый товар с сервером.
     * Сохраняет заказ локально для отображения в истории.
     *
     * @param items Список товаров корзины
     * @param totalPrice Общая стоимость заказа
     */
    fun addOrder(items: List<CartItem>, totalPrice: Double) {
        val dateFormat = SimpleDateFormat("dd.MM.yyyy", Locale.getDefault())
        val currentDate = dateFormat.format(Date())

        // Форматирование цены
        val formattedPrice = String.format("%,.0f ₽", totalPrice).replace(",", " ")

        val orderId = "ORD-${UUID.randomUUID().toString().take(8).uppercase()}"

        val newOrder =
                Order(
                        id = orderId,
                        date = currentDate,
                        totalPrice = formattedPrice,
                        status = "В обработке",
                        items = items,
                        serverIds = emptyList()
                )

        // Добавляем заказ локально сразу (оптимистичное обновление)
        val updatedList =
                _orders.value.toMutableList().apply {
                    add(0, newOrder) // Добавляем в начало списка
                }
        _orders.value = updatedList
        saveOrders(updatedList)

        // Синхронизация с сервером
        syncOrderWithServer(orderId, items)
    }

    /** Синхронизация заказа с сервером. Создаёт запись для каждого товара в корзине. */
    private fun syncOrderWithServer(localOrderId: String, items: List<CartItem>) {
        val userId = tokenManager?.getUserId() ?: return
        val repo = orderRepository ?: return

        _orderState.value = OrderState.Loading

        viewModelScope.launch {
            val serverIds = mutableListOf<String>()
            var hasError = false
            var errorMessage = ""

            // Создаём заказ для каждого товара
            for (item in items) {
                when (val result =
                                repo.createOrder(
                                        userId = userId,
                                        productId = item.product.id.toString(),
                                        count = item.quantity
                                )
                ) {
                    is NetworkResult.Success -> {
                        serverIds.add(result.data.id)
                    }
                    is NetworkResult.Error -> {
                        hasError = true
                        errorMessage = result.message
                        // Продолжаем для остальных товаров
                    }
                    is NetworkResult.Loading -> {}
                }
            }

            // Обновляем заказ с серверными ID
            if (serverIds.isNotEmpty()) {
                _orders.value =
                        _orders.value.map { order ->
                            if (order.id == localOrderId) {
                                order.copy(
                                        serverIds = serverIds,
                                        status = if (hasError) "Частично оформлен" else "Оформлен"
                                )
                            } else {
                                order
                            }
                        }
                saveOrders(_orders.value)
            }

            _orderState.value =
                    if (hasError) {
                        OrderState.Error(errorMessage)
                    } else {
                        OrderState.Success
                    }
        }
    }

    /**
     * Удаление заказа из локального кэша.
     * @param orderId ID заказа для удаления
     */
    fun removeOrder(orderId: String) {
        val updatedList = _orders.value.filter { it.id != orderId }
        _orders.value = updatedList
        saveOrders(updatedList)
    }

    /** Сохранение заказов в локальный кэш. */
    private fun saveOrders(orders: List<Order>) {
        val json = gson.toJson(orders)
        prefs.edit().putString("orders_list", json).apply()
    }

    /** Сброс состояния. */
    fun resetState() {
        _orderState.value = OrderState.Idle
    }
}

/**
 * Factory для создания OrdersViewModel с зависимостями.
 *
 * @param application Контекст приложения
 * @param orderRepository Репозиторий заказов (опционально)
 * @param tokenManager Менеджер токенов (опционально)
 */
class OrdersViewModelFactory(
        private val application: Application,
        private val orderRepository: IOrderRepository? = null,
        private val tokenManager: TokenManager? = null
) : ViewModelProvider.Factory {
    @Suppress("UNCHECKED_CAST")
    override fun <T : ViewModel> create(modelClass: Class<T>): T {
        return OrdersViewModel(application, orderRepository, tokenManager) as T
    }
}
```

## File: app/src/main/java/com/example/lol/Projects/Project.kt
```kotlin
package com.example.lol.Projects

import java.util.UUID

/**
 * Data class representing a project.
 */
data class Project(
    val id: String = UUID.randomUUID().toString(),
    val name: String,
    val type: String = "",
    val startDate: String = "",
    val endDate: String = "",
    val recipient: String = "",
    val descriptionSource: String = "",
    val category: String = "",
    val imageUri: String? = null,
    val createdAt: Long = System.currentTimeMillis()
)
```

## File: app/src/main/java/com/example/lol/storybook/StorybookActivity.kt
```kotlin
package com.example.lol.storybook

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import com.example.lol.ui.theme.LolTheme

class StorybookActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent { LolTheme { StorybookScreen() } }
    }
}
```

## File: app/src/test/java/com/example/lol/data/repository/OrderRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Unit-тесты для OrderRepository с использованием MockWebServer.
 */
class OrderRepositoryTest {
    
    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: OrderRepository
    
    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()
        
        api = Retrofit.Builder()
            .baseUrl(mockWebServer.url("/"))
            .addConverterFactory(GsonConverterFactory.create())
            .build()
            .create(MatuleApi::class.java)
        
        repository = OrderRepository(api)
    }
    
    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }
    
    @Test
    fun `createOrder success returns order data`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(200)
                .setBody(TestJsonResponses.orderJson)
        )
        
        // When
        val result = repository.createOrder(
            userId = "user123",
            productId = "prod1",
            count = 3
        )
        
        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("order1", data?.id)
        assertEquals("user123", data?.userId)
        assertEquals("prod1", data?.productId)
        assertEquals(3, data?.count)
        
        // Verify request body verification is skipped here as we trust Retrofit,
        // but we could verify recordedRequest if needed.
    }
    
    @Test
    fun `createOrder failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(400)
                .setBody(TestJsonResponses.errorJson)
        )
        
        // When
        val result = repository.createOrder(
            userId = "user123",
            productId = "prod1",
            count = 3
        )
        
        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }
}
```

## File: app/src/test/java/com/example/lol/data/repository/ProjectRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Unit-тесты для ProjectRepository с использованием MockWebServer.
 */
class ProjectRepositoryTest {
    
    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: ProjectRepository
    
    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()
        
        api = Retrofit.Builder()
            .baseUrl(mockWebServer.url("/"))
            .addConverterFactory(GsonConverterFactory.create())
            .build()
            .create(MatuleApi::class.java)
        
        repository = ProjectRepository(api)
    }
    
    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }
    
    @Test
    fun `getProjects success returns project list`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(200)
                .setBody(TestJsonResponses.projectsListJson)
        )
        
        // When
        val result = repository.getProjects()
        
        // Then
        assertTrue(result.isSuccess)
        val projects = result.getOrNull()
        assertNotNull(projects)
        assertEquals(1, projects?.size)
        assertEquals("Мой проект", projects?.first()?.title)
    }
    
    @Test
    fun `createProject success returns created project`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(200)
                .setBody(TestJsonResponses.createdProjectJson)
        )
        
        // When
        val result = repository.createProject(
            title = "Новый проект",
            typeProject = "Новинки",
            userId = "user123",
            dateStart = "2026-02-01",
            dateEnd = "2026-06-30",
            gender = "Женский",
            descriptionSource = "Новое описание",
            category = "Новинки",
            image = null
        )
        
        // Then
        assertTrue(result.isSuccess)
        val project = result.getOrNull()
        assertNotNull(project)
        assertEquals("proj2", project?.id)
        assertEquals("Новый проект", project?.title)
    }
    
    @Test
    fun `getProjects failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(400)
                .setBody(TestJsonResponses.errorJson)
        )
        
        // When
        val result = repository.getProjects()
        
        // Then
        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }
}
```

## File: app/src/test/java/com/example/lol/ExampleUnitTest.kt
```kotlin
package com.example.lol

import org.junit.Test

import org.junit.Assert.*

/**
 * Example local unit test, which will execute on the development machine (host).
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
class ExampleUnitTest {
    @Test
    fun addition_isCorrect() {
        assertEquals(4, 2 + 2)
    }
}
```

## File: app/src/test/java/com/example/lol/viewmodel/AuthViewModelTest.kt
```kotlin
package com.example.lol.viewmodel

import com.example.lol.data.fake.FakeAuthRepository
import com.example.lol.data.network.NetworkResult
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.test.*
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test

/**
 * Unit-тесты для AuthViewModel с использованием FakeAuthRepository.
 * 
 * Примечание: Эти тесты демонстрируют паттерн тестирования ViewModel.
 * Для полноценного тестирования потребуется рефакторинг AuthViewModel
 * для использования IAuthRepository вместо SessionManager.
 */
@OptIn(ExperimentalCoroutinesApi::class)
class AuthViewModelTest {
    
    private lateinit var fakeRepository: FakeAuthRepository
    private val testDispatcher = UnconfinedTestDispatcher()
    
    @Before
    fun setup() {
        Dispatchers.setMain(testDispatcher)
        fakeRepository = FakeAuthRepository()
    }
    
    @After
    fun tearDown() {
        Dispatchers.resetMain()
    }
    
    @Test
    fun `login with valid credentials calls repository`() = runTest {
        // Given
        val authResponse = TestJsonResponses.createTestResponseAuth()
        fakeRepository.setLoginSuccess(authResponse)
        
        // When
        val result = fakeRepository.login("test@test.ru", "password123")
        
        // Then
        assertTrue(result is NetworkResult.Success)
        assertEquals(1, fakeRepository.loginCallCount)
        assertEquals("test@test.ru", fakeRepository.lastLoginEmail)
        assertEquals("password123", fakeRepository.lastLoginPassword)
    }
    
    @Test
    fun `login with invalid credentials returns error`() = runTest {
        // Given
        fakeRepository.setLoginError("Invalid credentials.", 400)
        
        // When
        val result = fakeRepository.login("wrong@test.ru", "wrongpass")
        
        // Then
        assertTrue(result is NetworkResult.Error)
        assertEquals("Invalid credentials.", (result as NetworkResult.Error).message)
        assertEquals(400, result.code)
    }
    
    @Test
    fun `register with new email calls repository`() = runTest {
        // Given
        val registerResponse = TestJsonResponses.createTestResponseRegister()
        fakeRepository.setRegisterSuccess(registerResponse)
        
        // When
        val result = fakeRepository.register("new@test.ru", "password123")
        
        // Then
        assertTrue(result is NetworkResult.Success)
        assertEquals(1, fakeRepository.registerCallCount)
        assertEquals("new@test.ru", fakeRepository.lastRegisterEmail)
    }
    
    @Test
    fun `register with existing email returns error`() = runTest {
        // Given
        fakeRepository.setRegisterError("Email already exists", 400)
        
        // When
        val result = fakeRepository.register("existing@test.ru", "password123")
        
        // Then
        assertTrue(result is NetworkResult.Error)
        assertEquals("Email already exists", (result as NetworkResult.Error).message)
    }
}
```

## File: app/src/test/java/com/example/lol/viewmodel/CartViewModelTest.kt
```kotlin
package com.example.lol.viewmodel

import com.example.lol.data.fake.FakeCartRepository
import com.example.lol.data.network.NetworkResult
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.test.*
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test

/**
 * Unit-тесты для логики корзины с использованием FakeCartRepository.
 */
@OptIn(ExperimentalCoroutinesApi::class)
class CartViewModelTest {
    
    private lateinit var fakeRepository: FakeCartRepository
    private val testDispatcher = UnconfinedTestDispatcher()
    
    @Before
    fun setup() {
        Dispatchers.setMain(testDispatcher)
        fakeRepository = FakeCartRepository()
    }
    
    @After
    fun tearDown() {
        Dispatchers.resetMain()
    }
    
    @Test
    fun `addToCart success updates cart`() = runTest {
        // Given
        val cartResponse = TestJsonResponses.createTestResponseCart(
            id = "cart1",
            productId = "prod1",
            count = 1
        )
        fakeRepository.setAddToCartSuccess(cartResponse)
        
        // When
        val result = fakeRepository.addToCart(
            userId = "user123",
            productId = "prod1",
            count = 1
        )
        
        // Then
        assertTrue(result is NetworkResult.Success)
        assertEquals(1, fakeRepository.addToCartCallCount)
        assertEquals("prod1", fakeRepository.lastAddedProductId)
        assertEquals(1, fakeRepository.lastAddedCount)
    }
    
    @Test
    fun `removeFromCart updates quantity to zero`() = runTest {
        // Given - simulate removing by updating to 0
        fakeRepository.setUpdateCartItemError("Cannot update to zero", 400)
        
        // When
        val result = fakeRepository.updateCartItem(
            cartItemId = "cart1",
            userId = "user123",
            productId = "prod1",
            count = 0
        )
        
        // Then
        assertTrue(result is NetworkResult.Error)
        assertEquals(1, fakeRepository.updateCartItemCallCount)
    }
    
    @Test
    fun `clearCart resets repository state`() = runTest {
        // Given
        val cartResponse = TestJsonResponses.createTestResponseCart()
        fakeRepository.setAddToCartSuccess(cartResponse)
        fakeRepository.addToCart("user123", "prod1", 1)
        
        // When
        fakeRepository.reset()
        
        // Then
        assertEquals(0, fakeRepository.addToCartCallCount)
        assertNull(fakeRepository.lastAddedProductId)
    }
}
```

## File: app/src/test/java/com/example/lol/viewmodel/ProjectsViewModelTest.kt
```kotlin
package com.example.lol.viewmodel

import com.example.lol.data.fake.FakeProjectRepository
import com.example.lol.data.network.NetworkResult
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.test.*
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test

/**
 * Unit-тесты для логики проектов с использованием FakeProjectRepository.
 */
@OptIn(ExperimentalCoroutinesApi::class)
class ProjectsViewModelTest {
    
    private lateinit var fakeRepository: FakeProjectRepository
    private val testDispatcher = UnconfinedTestDispatcher()
    
    @Before
    fun setup() {
        Dispatchers.setMain(testDispatcher)
        fakeRepository = FakeProjectRepository()
    }
    
    @After
    fun tearDown() {
        Dispatchers.resetMain()
    }
    
    @Test
    fun `loadProjects success returns project list`() = runTest {
        // Given
        val projects = listOf(
            TestJsonResponses.createTestProjectApi(id = "proj1", title = "Проект 1"),
            TestJsonResponses.createTestProjectApi(id = "proj2", title = "Проект 2")
        )
        fakeRepository.setGetProjectsSuccess(projects)
        
        // When
        val result = fakeRepository.getProjects()
        
        // Then
        assertTrue(result is NetworkResult.Success)
        assertEquals(2, (result as NetworkResult.Success).data.size)
        assertEquals(1, fakeRepository.getProjectsCallCount)
    }
    
    @Test
    fun `createProject success adds new project`() = runTest {
        // Given
        val newProject = TestJsonResponses.createTestProjectApi(
            id = "projNew",
            title = "Новый проект"
        )
        fakeRepository.setCreateProjectSuccess(newProject)
        
        // When
        val result = fakeRepository.createProject(
            title = "Новый проект",
            typeProject = "Новинки",
            userId = "user123",
            dateStart = "2026-01-01",
            dateEnd = "2026-12-31",
            gender = "Мужской",
            descriptionSource = "Описание",
            category = "Популярные",
            image = null
        )
        
        // Then
        assertTrue(result is NetworkResult.Success)
        assertEquals("projNew", (result as NetworkResult.Success).data.id)
        assertEquals("Новый проект", fakeRepository.lastCreatedTitle)
        assertEquals("Популярные", fakeRepository.lastCreatedCategory)
    }
    
    @Test
    fun `loadProjects failure returns error`() = runTest {
        // Given
        fakeRepository.setGetProjectsError("Network error", null)
        
        // When
        val result = fakeRepository.getProjects()
        
        // Then
        assertTrue(result is NetworkResult.Error)
        assertEquals("Network error", (result as NetworkResult.Error).message)
    }
}
```

## File: gradle.properties
```
# Project-wide Gradle settings.
# IDE (e.g. Android Studio) users:
# Gradle settings configured through the IDE *will override*
# any settings specified in this file.
# For more details on how to configure your build environment visit
# http://www.gradle.org/docs/current/userguide/build_environment.html
# Specifies the JVM arguments used for the daemon process.
# The setting is particularly useful for tweaking memory settings.
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
# When configured, Gradle will run in incubating parallel mode.
# This option should only be used with decoupled projects. For more details, visit
# https://developer.android.com/r/tools/gradle-multi-project-decoupled-projects
# org.gradle.parallel=true
# AndroidX package structure to make it clearer which packages are bundled with the
# Android operating system, and which are packaged with your app's APK
# https://developer.android.com/topic/libraries/support-library/androidx-rn
android.useAndroidX=true
# Kotlin code style for this project: "official" or "obsolete":
kotlin.code.style=official
# Enables namespacing of each library's R class so that its R class includes only the
# resources declared in the library itself and none from the library's dependencies,
# thereby reducing the size of the R class for that library
android.nonTransitiveRClass=true
```

## File: network/build.gradle.kts
```kotlin
import org.gradle.api.JavaVersion

plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
}

android {
    namespace = "com.example.lol.network"
    compileSdk = 36

    defaultConfig {
        minSdk = 24
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = "11"
    }
}

dependencies {
    implementation(libs.androidx.core.ktx)
    implementation("com.squareup.retrofit2:retrofit:2.9.0")
    implementation("com.squareup.retrofit2:converter-gson:2.9.0")
    implementation("com.squareup.okhttp3:logging-interceptor:4.12.0")

    testImplementation(libs.junit)
    testImplementation("com.squareup.okhttp3:mockwebserver:4.12.0")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.3")
}
```

## File: network/src/main/AndroidManifest.xml
```xml
<manifest />
```

## File: network/src/main/java/com/example/lol/data/network/api/MatuleApi.kt
```kotlin
package com.example.lol.data.network.api

import com.example.lol.data.network.models.*
import okhttp3.MultipartBody
import okhttp3.RequestBody
import retrofit2.Response
import retrofit2.http.*

/**
 * Retrofit API для взаимодействия с backend Matule.
 *
 * Интерфейс описывает операции авторизации, профиля, каталога, проектов, корзины и заказов.
 */
interface MatuleApi {

        /**
         * Регистрирует нового пользователя.
         *
         * @param request Тело запроса на регистрацию.
         */
        @POST("collections/users/records")
        suspend fun register(@Body request: RequestRegister): Response<okhttp3.ResponseBody>

        /**
         * Авторизует пользователя по email и паролю.
         *
         * @param request Тело запроса на авторизацию.
         */
        @POST("collections/users/auth-with-password")
        suspend fun auth(@Body request: RequestAuth): retrofit2.Response<okhttp3.ResponseBody>

        /**
         * Возвращает профиль пользователя по идентификатору.
         *
         * @param userId Идентификатор пользователя.
         */
        @GET("collections/users/records/{id_user}")
        suspend fun getUser(@Path("id_user") userId: String): Response<User>

        /**
         * Обновляет профиль пользователя.
         *
         * @param userId Идентификатор пользователя.
         * @param email Новый email.
         * @param firstname Имя.
         * @param lastname Фамилия.
         * @param secondname Отчество.
         * @param datebirthday Дата рождения.
         * @param gender Пол.
         */
        @Multipart
        @PATCH("collections/users/records/{id_user}")
        suspend fun updateUser(
                @Path("id_user") userId: String,
                @Part("email") email: RequestBody? = null,
                @Part("firstname") firstname: RequestBody? = null,
                @Part("lastname") lastname: RequestBody? = null,
                @Part("secondname") secondname: RequestBody? = null,
                @Part("datebirthday") datebirthday: RequestBody? = null,
                @Part("gender") gender: RequestBody? = null
        ): Response<User>

        /**
         * Возвращает активные токены авторизации пользователя.
         */
        @GET("collections/_authOrigins/records") suspend fun getUsersAuth(): Response<UsersAuth>

        /**
         * Удаляет токен авторизации (выход из системы).
         *
         * @param tokenId Идентификатор токена в коллекции `_authOrigins`.
         */
        @DELETE("collections/_authOrigins/records/{id_token}")
        suspend fun logout(@Path("id_token") tokenId: String): Response<Unit>

        /** Возвращает список новостей и акций. */
        @GET("collections/news/records") suspend fun getNews(): Response<ResponseNews>

        /**
         * Возвращает список продуктов.
         *
         * @param filter Фильтр в формате "(title ?~ 'query')"
         */
        @GET("collections/products/records")
        suspend fun getProducts(@Query("filter") filter: String? = null): Response<ResponseProducts>

        /**
         * Возвращает детальную информацию о продукте.
         *
         * @param productId Идентификатор продукта.
         */
        @GET("collections/products/records/{id_product}")
        suspend fun getProduct(@Path("id_product") productId: String): Response<ProductApi>

        /** Возвращает список проектов текущего пользователя. */
        @GET("collections/project/records") suspend fun getProjects(): Response<ResponseProjects>

        /**
         * Создаёт новый проект.
         *
         * @param title Название проекта.
         * @param typeProject Тип проекта.
         * @param userId Идентификатор владельца проекта.
         * @param dateStart Дата начала.
         * @param dateEnd Дата окончания.
         * @param gender Пол целевой аудитории/пол пользователя.
         * @param descriptionSource Источник описания.
         * @param category Категория проекта.
         * @param image Необязательное изображение проекта.
         */
        @Multipart
        @POST("collections/project/records")
        suspend fun createProject(
                @Part("title") title: RequestBody,
                @Part("typeProject") typeProject: RequestBody,
                @Part("user_id") userId: RequestBody,
                @Part("dateStart") dateStart: RequestBody,
                @Part("dateEnd") dateEnd: RequestBody,
                @Part("gender") gender: RequestBody,
                @Part("description_source") descriptionSource: RequestBody,
                @Part("category") category: RequestBody,
                @Part image: MultipartBody.Part? = null
        ): Response<ProjectApi>

        /**
         * Добавляет товар в корзину.
         *
         * @param request Тело запроса с данными корзины.
         */
        @POST("collections/cart/records")
        suspend fun createCartItem(@Body request: RequestCart): Response<ResponseCart>

        /**
         * Обновляет количество товара в корзине.
         *
         * @param cartItemId Идентификатор записи корзины.
         * @param userId Идентификатор пользователя.
         * @param productId Идентификатор товара.
         * @param count Новое количество.
         */
        @Multipart
        @PATCH("collections/cart/records/{id_bucket}")
        suspend fun updateCartItem(
                @Path("id_bucket") cartItemId: String,
                @Part("user_id") userId: RequestBody,
                @Part("product_id") productId: RequestBody,
                @Part("count") count: RequestBody
        ): Response<ResponseCart>

        /**
         * Создаёт заказ.
         *
         * @param request Тело запроса с параметрами заказа.
         */
        @POST("collections/orders/records")
        suspend fun createOrder(@Body request: RequestOrder): Response<ResponseOrder>
}
```

## File: network/src/main/java/com/example/lol/data/network/ITokenManager.kt
```kotlin
package com.example.lol.data.network

/**
 * Интерфейс для управления токенами авторизации. Позволяет абстрагировать хранение токенов для
 * тестирования.
 */
interface ITokenManager {

    /** Сохраняет токен авторизации. */
    fun saveToken(token: String)

    /** Получает сохранённый токен. */
    fun getToken(): String?

    /** Сохраняет ID пользователя. */
    fun saveUserId(userId: String)

    /** Получает сохранённый ID пользователя. */
    fun getUserId(): String?

    /** Проверяет наличие токена. */
    fun hasToken(): Boolean

    /** Очищает все данные авторизации. */
    fun clearAuth()
}
```

## File: network/src/main/java/com/example/lol/data/network/models/Error400.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Модель ошибки 400 от сервера. */
data class Error400(
        @SerializedName("status") val status: Int,
        @SerializedName("message") val message: String,
        @SerializedName("data") val data: Map<String, Any>? = null
)
```

## File: network/src/main/java/com/example/lol/data/network/models/News.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Модель новости/акции. */
data class News(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("newsImage") val newsImage: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ProductApi.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Полная модель продукта с сервера (для детальной страницы). */
data class ProductApi(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("title") val title: String,
        @SerializedName("description") val description: String,
        @SerializedName("price") val price: Int,
        @SerializedName("typeCloses") val typeCloses: String,
        @SerializedName("type") val type: String,
        @SerializedName("approximateCost") val approximateCost: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ProductItem.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Краткая модель продукта для списка (каталог). */
data class ProductItem(
        @SerializedName("id") val id: String,
        @SerializedName("title") val title: String,
        @SerializedName("price") val price: Int,
        @SerializedName("typeCloses") val typeCloses: String,
        @SerializedName("type") val type: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ProjectApi.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Модель проекта с сервера. */
data class ProjectApi(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("title") val title: String,
        @SerializedName("dateStart") val dateStart: String,
        @SerializedName("dateEnd") val dateEnd: String,
        @SerializedName("gender") val gender: String,
        @SerializedName("description_source") val descriptionSource: String,
        @SerializedName("category") val category: String,
        @SerializedName("image") val image: String,
        @SerializedName("user_id") val userId: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestAuth.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/**
 * Запрос на авторизацию пользователя.
 * @param identity Email или идентификатор пользователя
 * @param password Пароль пользователя
 */
data class RequestAuth(
        @SerializedName("identity") val identity: String,
        @SerializedName("password") val password: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestCart.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Запрос на добавление/обновление корзины. */
data class RequestCart(
        @SerializedName("user_id") val userId: String,
        @SerializedName("product_id") val productId: String,
        @SerializedName("count") val count: Int
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestOrder.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Запрос на создание заказа. */
data class RequestOrder(
        @SerializedName("user_id") val userId: String,
        @SerializedName("product_id") val productId: String,
        @SerializedName("count") val count: Int
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestProject.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Запрос на создание проекта. */
data class RequestProject(
        @SerializedName("title") val title: String,
        @SerializedName("typeProject") val typeProject: String,
        @SerializedName("user_id") val userId: String,
        @SerializedName("dateStart") val dateStart: String,
        @SerializedName("dateEnd") val dateEnd: String,
        @SerializedName("gender") val gender: String,
        @SerializedName("description_source") val descriptionSource: String,
        @SerializedName("category") val category: String

// Примечание: image отправляется отдельно как multipart
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestRegister.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/**
 * Запрос на регистрацию нового пользователя.
 * @param email Email пользователя
 * @param password Пароль пользователя
 * @param passwordConfirm Подтверждение пароля
 */
data class RequestRegister(
        @SerializedName("email") val email: String,
        @SerializedName("password") val password: String,
        @SerializedName("passwordConfirm") val passwordConfirm: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/RequestUser.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Запрос на обновление профиля пользователя. */
data class RequestUser(
        @SerializedName("email") val email: String? = null,
        @SerializedName("emailVisibility") val emailVisibility: Boolean? = null,
        @SerializedName("firstname") val firstname: String? = null,
        @SerializedName("lastname") val lastname: String? = null,
        @SerializedName("secondname") val secondname: String? = null,
        @SerializedName("datebirthday") val datebirthday: String? = null,
        @SerializedName("gender") val gender: String? = null
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseAuth.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/**
 * Ответ сервера на авторизацию.
 * @param record Данные пользователя
 * @param token JWT токен для последующих запросов
 */
data class ResponseAuth(
        @SerializedName("record") val record: User,
        @SerializedName("token") val token: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseCart.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера на операции с корзиной. */
data class ResponseCart(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("user_id") val userId: String,
        @SerializedName("product_id") val productId: String,
        @SerializedName("count") val count: Int
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseNews.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера со списком новостей/акций (пагинация). */
data class ResponseNews(
        @SerializedName("page") val page: Int,
        @SerializedName("perPage") val perPage: Int,
        @SerializedName("totalPages") val totalPages: Int,
        @SerializedName("totalItems") val totalItems: Int,
        @SerializedName("items") val items: List<News>
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseOrder.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера на создание заказа. */
data class ResponseOrder(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("user_id") val userId: String,
        @SerializedName("product_id") val productId: String,
        @SerializedName("count") val count: Int
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseProducts.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера со списком продуктов (пагинация). */
data class ResponseProducts(
        @SerializedName("page") val page: Int,
        @SerializedName("perPage") val perPage: Int,
        @SerializedName("totalPages") val totalPages: Int,
        @SerializedName("totalItems") val totalItems: Int,
        @SerializedName("items") val items: List<ProductItem>
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseProjects.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера со списком проектов (пагинация). */
data class ResponseProjects(
        @SerializedName("page") val page: Int,
        @SerializedName("perPage") val perPage: Int,
        @SerializedName("totalPages") val totalPages: Int,
        @SerializedName("totalItems") val totalItems: Int,
        @SerializedName("items") val items: List<ProjectApi>
)
```

## File: network/src/main/java/com/example/lol/data/network/models/ResponseRegister.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Ответ сервера на регистрацию пользователя. */
data class ResponseRegister(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("emailVisibility") val emailVisibility: Boolean,
        @SerializedName("firstname") val firstname: String,
        @SerializedName("lastname") val lastname: String,
        @SerializedName("secondname") val secondname: String,
        @SerializedName("verified") val verified: Boolean,
        @SerializedName("datebirthday") val datebirthday: String,
        @SerializedName("gender") val gender: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/User.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Модель данных пользователя с сервера. */
data class User(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("emailVisibility") val emailVisibility: Boolean,
        @SerializedName("firstname") val firstname: String,
        @SerializedName("lastname") val lastname: String,
        @SerializedName("secondname") val secondname: String,
        @SerializedName("verified") val verified: Boolean,
        @SerializedName("datebirthday") val datebirthday: String,
        @SerializedName("gender") val gender: String
)
```

## File: network/src/main/java/com/example/lol/data/network/models/UsersAuth.kt
```kotlin
package com.example.lol.data.network.models

import com.google.gson.annotations.SerializedName

/** Элемент авторизации пользователя для получения токена. */
data class UserAuth(
        @SerializedName("id") val id: String,
        @SerializedName("collectionId") val collectionId: String,
        @SerializedName("collectionName") val collectionName: String,
        @SerializedName("created") val created: String,
        @SerializedName("updated") val updated: String,
        @SerializedName("collectionRef") val collectionRef: String,
        @SerializedName("fingerprint") val fingerprint: String,
        @SerializedName("recordRef") val recordRef: String
)

/** Ответ сервера со списком токенов авторизации. */
data class UsersAuth(
        @SerializedName("page") val page: Int,
        @SerializedName("perPage") val perPage: Int,
        @SerializedName("totalPages") val totalPages: Int,
        @SerializedName("totalItems") val totalItems: Int,
        @SerializedName("items") val items: List<UserAuth>
)
```

## File: network/src/main/java/com/example/lol/data/network/NetworkResult.kt
```kotlin
package com.example.lol.data.network

/**
 * Sealed class для представления результата сетевого запроса. Обеспечивает типобезопасную обработку
 * успеха, ошибки и состояния загрузки.
 */
sealed class NetworkResult<out T> {

    /**
     * Успешный результат с данными.
     * @param data Данные полученные от сервера
     */
    data class Success<T>(val data: T) : NetworkResult<T>()

    /**
     * Ошибка выполнения запроса.
     * @param message Сообщение об ошибке
     * @param code HTTP код ошибки (опционально)
     */
    data class Error(val message: String, val code: Int? = null) : NetworkResult<Nothing>()

    /** Состояние загрузки. */
    object Loading : NetworkResult<Nothing>()

    /** Проверяет успешность результата. */
    val isSuccess: Boolean
        get() = this is Success

    /** Проверяет наличие ошибки. */
    val isError: Boolean
        get() = this is Error

    /** Проверяет состояние загрузки. */
    val isLoading: Boolean
        get() = this is Loading

    /** Получает данные или null если результат не Success. */
    fun getOrNull(): T? = (this as? Success)?.data

    /** Получает сообщение об ошибке или null. */
    fun errorMessageOrNull(): String? = (this as? Error)?.message

    /** Преобразует данные в случае успеха. */
    inline fun <R> map(transform: (T) -> R): NetworkResult<R> {
        return when (this) {
            is Success -> Success(transform(data))
            is Error -> this
            is Loading -> this
        }
    }

    /** Выполняет действие в случае успеха. */
    inline fun onSuccess(action: (T) -> Unit): NetworkResult<T> {
        if (this is Success) action(data)
        return this
    }

    /** Выполняет действие в случае ошибки. */
    inline fun onError(action: (String, Int?) -> Unit): NetworkResult<T> {
        if (this is Error) action(message, code)
        return this
    }
}
```

## File: network/src/main/java/com/example/lol/data/network/RetrofitInstance.kt
```kotlin
package com.example.lol.data.network

import com.example.lol.data.network.api.MatuleApi
import com.google.gson.GsonBuilder
import java.util.concurrent.TimeUnit
import okhttp3.Interceptor
import okhttp3.OkHttpClient
import okhttp3.logging.HttpLoggingInterceptor
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Singleton для создания и предоставления экземпляра Retrofit. Настраивает OkHttp клиент с
 * логированием и Bearer токеном.
 */
object RetrofitInstance {

    private const val BASE_URL = "https://api.matule.ru/api/"
    private const val TIMEOUT_SECONDS = 30L

    private val gson = GsonBuilder().setLenient().create()

    private var tokenProvider: (() -> String?)? = null

    /**
     * Устанавливает провайдер токена для авторизации запросов.
     * @param provider Функция возвращающая текущий токен
     */
    fun setTokenProvider(provider: () -> String?) {
        tokenProvider = provider
    }

    /** Interceptor для добавления Bearer токена в заголовки запросов. */
    private val authInterceptor = Interceptor { chain ->
        val originalRequest = chain.request()
        val token = tokenProvider?.invoke()

        val request =
                if (!token.isNullOrBlank()) {
                    // Оставляем только печатные ASCII символы (0x20–0x7E)
                    val cleanToken = token.filter { it.code in 0x20..0x7E }
                    originalRequest
                            .newBuilder()
                            .header("Authorization", "Bearer $cleanToken")
                            .build()
                } else {
                    originalRequest
                }

        chain.proceed(request)
    }

    /** Interceptor для логирования HTTP запросов и ответов. */
    private val loggingInterceptor =
            HttpLoggingInterceptor().apply { level = HttpLoggingInterceptor.Level.BODY }

    /** Настроенный OkHttp клиент с обходом SSL для демо. */
    private val okHttpClient: OkHttpClient by lazy {
        // Обход SSL проверки для сервера с проблемным сертификатом
        val trustAllCerts =
                arrayOf<javax.net.ssl.TrustManager>(
                        object : javax.net.ssl.X509TrustManager {
                            override fun checkClientTrusted(
                                    chain: Array<java.security.cert.X509Certificate>,
                                    authType: String
                            ) {}
                            override fun checkServerTrusted(
                                    chain: Array<java.security.cert.X509Certificate>,
                                    authType: String
                            ) {}
                            override fun getAcceptedIssuers():
                                    Array<java.security.cert.X509Certificate> = arrayOf()
                        }
                )

        val sslContext = javax.net.ssl.SSLContext.getInstance("SSL")
        sslContext.init(null, trustAllCerts, java.security.SecureRandom())
        val sslSocketFactory = sslContext.socketFactory

        OkHttpClient.Builder()
                .sslSocketFactory(
                        sslSocketFactory,
                        trustAllCerts[0] as javax.net.ssl.X509TrustManager
                )
                .hostnameVerifier { _, _ -> true }
                .addInterceptor(authInterceptor)
                .addInterceptor(loggingInterceptor)
                .connectTimeout(TIMEOUT_SECONDS, TimeUnit.SECONDS)
                .readTimeout(TIMEOUT_SECONDS, TimeUnit.SECONDS)
                .writeTimeout(TIMEOUT_SECONDS, TimeUnit.SECONDS)
                .build()
    }

    /** Экземпляр Retrofit. */
    private val retrofit: Retrofit by lazy {
        Retrofit.Builder()
                .baseUrl(BASE_URL)
                .client(okHttpClient)
                .addConverterFactory(GsonConverterFactory.create(gson))
                .build()
    }

    /** API интерфейс для выполнения запросов. */
    val api: MatuleApi by lazy { retrofit.create(MatuleApi::class.java) }

    /**
     * Создаёт экземпляр Retrofit с кастомным базовым URL. Используется для тестирования с
     * MockWebServer.
     */
    fun createWithBaseUrl(baseUrl: String): MatuleApi {
        return Retrofit.Builder()
                .baseUrl(baseUrl)
                .client(okHttpClient)
                .addConverterFactory(GsonConverterFactory.create(gson))
                .build()
                .create(MatuleApi::class.java)
    }
}
```

## File: network/src/main/java/com/example/lol/data/network/TokenManager.kt
```kotlin
package com.example.lol.data.network

import android.content.Context
import android.content.SharedPreferences

/**
 * Менеджер для хранения и управления Bearer токеном авторизации. Использует SharedPreferences для
 * сохранения токена между сессиями.
 */
class TokenManager(context: Context) : ITokenManager {

    private val prefs: SharedPreferences =
            context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)

    init {
        // Автоочистка поврежденных данных при инициализации
        try {
            val token = prefs.getString(KEY_TOKEN, null)
            // Если токен содержит символы вне ASCII (например кириллицу из прошлой ошибки), очищаем
            // всё
            if (token != null && !token.all { it.code in 0x20..0x7E }) {
                prefs.edit().clear().apply()
            }
        } catch (e: Exception) {
            // Если файл SharedPreferences поврежден и выбрасывает исключение при чтении
            // (XmlPullParserException)
            prefs.edit().clear().apply()
        }
    }

    companion object {
        private const val PREFS_NAME = "matule_auth_prefs"
        private const val KEY_TOKEN = "auth_token"
        private const val KEY_USER_ID = "user_id"
    }

    /**
     * Сохраняет токен авторизации.
     * @param token JWT токен от сервера
     */
    override fun saveToken(token: String) {
        prefs.edit().putString(KEY_TOKEN, token).apply()
    }

    /**
     * Получает сохранённый токен.
     * @return токен или null если не сохранён
     */
    override fun getToken(): String? {
        return try {
            prefs.getString(KEY_TOKEN, null)?.replace("\n", "")?.replace("\r", "")?.trim()
        } catch (e: Exception) {
            null
        }
    }

    /**
     * Сохраняет ID пользователя.
     * @param userId ID пользователя от сервера
     */
    override fun saveUserId(userId: String) {
        prefs.edit().putString(KEY_USER_ID, userId).apply()
    }

    /**
     * Получает сохранённый ID пользователя.
     * @return ID пользователя или null если не сохранён
     */
    override fun getUserId(): String? {
        return prefs.getString(KEY_USER_ID, null)
    }

    /**
     * Проверяет наличие токена.
     * @return true если токен сохранён
     */
    override fun hasToken(): Boolean {
        return !getToken().isNullOrBlank()
    }

    /** Очищает все данные авторизации. */
    override fun clearAuth() {
        prefs.edit().remove(KEY_TOKEN).remove(KEY_USER_ID).apply()
    }
}
```

## File: network/src/main/java/com/example/lol/data/repository/AuthRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.ITokenManager
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*
import okhttp3.MediaType.Companion.toMediaTypeOrNull
import okhttp3.RequestBody.Companion.toRequestBody

/** Реализация репозитория авторизации. Выполняет сетевые запросы через MatuleApi. */
class AuthRepository(private val api: MatuleApi, private val tokenManager: ITokenManager) :
        IAuthRepository {

    override suspend fun register(
            email: String,
            password: String
    ): NetworkResult<ResponseRegister> {
        return try {
            val request =
                    RequestRegister(email = email, password = password, passwordConfirm = password)
            val response = api.register(request)

            if (response.isSuccessful && response.body() != null) {
                val responseString = response.body()!!.string().trim()
                val gson = com.google.gson.Gson()

                val registerResponse =
                        try {
                            gson.fromJson(responseString, ResponseRegister::class.java)
                        } catch (e: Exception) {
                            return NetworkResult.Error("Ошибка регистрации")
                        }

                if (registerResponse == null || registerResponse.id.isBlank()) {
                    return NetworkResult.Error("Ошибка регистрации")
                }

                NetworkResult.Success(registerResponse)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun login(email: String, password: String): NetworkResult<ResponseAuth> {
        return try {
            val request = RequestAuth(identity = email, password = password)
            val response = api.auth(request)

            if (response.isSuccessful && response.body() != null) {
                val responseString = response.body()!!.string().trim()
                val gson = com.google.gson.Gson()

                val authResponse =
                        try {
                            gson.fromJson(responseString, ResponseAuth::class.java)
                        } catch (e: Exception) {
                            return NetworkResult.Error("Неверный email или пароль")
                        }

                // Проверяем что ответ содержит необходимые данные
                if (authResponse == null ||
                                authResponse.token.isBlank() ||
                                authResponse.record.id.isBlank()
                ) {
                    return NetworkResult.Error("Неверный email или пароль")
                }

                // Сохраняем токен и ID пользователя, предварительно очистив его от недопустимых
                // символов
                val cleanToken = authResponse.token.replace("\n", "").replace("\r", "").trim()
                tokenManager.saveToken(cleanToken)
                tokenManager.saveUserId(authResponse.record.id)

                NetworkResult.Success(authResponse)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun getUser(userId: String): NetworkResult<User> {
        return try {
            val response = api.getUser(userId)

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun updateUser(
            userId: String,
            firstname: String?,
            lastname: String?,
            secondname: String?,
            datebirthday: String?,
            gender: String?
    ): NetworkResult<User> {
        return try {
            val response =
                    api.updateUser(
                            userId = userId,
                            firstname = firstname?.toRequestBody("text/plain".toMediaTypeOrNull()),
                            lastname = lastname?.toRequestBody("text/plain".toMediaTypeOrNull()),
                            secondname =
                                    secondname?.toRequestBody("text/plain".toMediaTypeOrNull()),
                            datebirthday =
                                    datebirthday?.toRequestBody("text/plain".toMediaTypeOrNull()),
                            gender = gender?.toRequestBody("text/plain".toMediaTypeOrNull())
                    )

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun logout(): NetworkResult<Unit> {
        return try {
            // Получаем список токенов авторизации
            val authResponse = api.getUsersAuth()

            if (authResponse.isSuccessful && authResponse.body() != null) {
                val usersAuth = authResponse.body()!!
                val currentUserId = tokenManager.getUserId()

                // Находим токен текущего пользователя
                val tokenToDelete = usersAuth.items.find { it.recordRef == currentUserId }

                if (tokenToDelete != null) {
                    val deleteResponse = api.logout(tokenToDelete.id)
                    if (deleteResponse.isSuccessful) {
                        tokenManager.clearAuth()
                        NetworkResult.Success(Unit)
                    } else {
                        NetworkResult.Error("Не удалось выйти из системы", deleteResponse.code())
                    }
                } else {
                    // Токен не найден, всё равно очищаем локальные данные
                    tokenManager.clearAuth()
                    NetworkResult.Success(Unit)
                }
            } else {
                // Даже если ошибка, очищаем локальные данные
                tokenManager.clearAuth()
                NetworkResult.Success(Unit)
            }
        } catch (e: Exception) {
            // При ошибке сети всё равно очищаем локальные данные
            tokenManager.clearAuth()
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    /** Парсит сообщение об ошибке из JSON ответа. */
    private fun parseErrorMessage(errorBody: String?): String {
        if (errorBody == null) return "Неизвестная ошибка"

        return try {
            // Пытаемся распарсить как Error400
            val gson = com.google.gson.Gson()
            val error = gson.fromJson(errorBody, Error400::class.java)
            error.message
        } catch (e: Exception) {
            errorBody.take(200)
        }
    }
}
```

## File: network/src/main/java/com/example/lol/data/repository/CartRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*
import okhttp3.MediaType.Companion.toMediaTypeOrNull
import okhttp3.RequestBody.Companion.toRequestBody

/** Реализация репозитория для работы с корзиной. */
class CartRepository(private val api: MatuleApi) : ICartRepository {

    override suspend fun addToCart(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        return try {
            val request = RequestCart(userId = userId, productId = productId, count = count)
            val response = api.createCartItem(request)

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun updateCartItem(
            cartItemId: String,
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseCart> {
        return try {
            val response =
                    api.updateCartItem(
                            cartItemId = cartItemId,
                            userId = userId.toRequestBody("text/plain".toMediaTypeOrNull()),
                            productId = productId.toRequestBody("text/plain".toMediaTypeOrNull()),
                            count = count.toString().toRequestBody("text/plain".toMediaTypeOrNull())
                    )

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    private fun parseErrorMessage(errorBody: String?): String {
        if (errorBody == null) return "Неизвестная ошибка"

        return try {
            val gson = com.google.gson.Gson()
            val error = gson.fromJson(errorBody, Error400::class.java)
            error.message
        } catch (e: Exception) {
            errorBody.take(200)
        }
    }
}
```

## File: network/src/main/java/com/example/lol/data/repository/IAuthRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseAuth
import com.example.lol.data.network.models.ResponseRegister
import com.example.lol.data.network.models.User

/**
 * Интерфейс репозитория для операций авторизации. Абстрагирует сетевой слой для возможности замены
 * реализации.
 */
interface IAuthRepository {

    /**
     * Регистрация нового пользователя.
     * @param email Email пользователя
     * @param password Пароль
     * @return Результат регистрации
     */
    suspend fun register(email: String, password: String): NetworkResult<ResponseRegister>

    /**
     * Авторизация пользователя.
     * @param email Email пользователя
     * @param password Пароль
     * @return Результат авторизации с токеном
     */
    suspend fun login(email: String, password: String): NetworkResult<ResponseAuth>

    /**
     * Получение информации о пользователе.
     * @param userId ID пользователя
     * @return Данные пользователя
     */
    suspend fun getUser(userId: String): NetworkResult<User>

    /**
     * Обновление профиля пользователя.
     * @param userId ID пользователя
     * @param firstname Имя
     * @param lastname Фамилия
     * @param secondname Отчество
     * @param datebirthday Дата рождения
     * @param gender Пол
     * @return Обновлённые данные пользователя
     */
    suspend fun updateUser(
            userId: String,
            firstname: String? = null,
            lastname: String? = null,
            secondname: String? = null,
            datebirthday: String? = null,
            gender: String? = null
    ): NetworkResult<User>

    /**
     * Выход из системы.
     * @return Результат операции
     */
    suspend fun logout(): NetworkResult<Unit>
}
```

## File: network/src/main/java/com/example/lol/data/repository/ICartRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseCart

/** Интерфейс репозитория для операций с корзиной. */
interface ICartRepository {

        /**
         * Добавление товара в корзину.
         * @param userId ID пользователя
         * @param productId ID продукта
         * @param count Количество
         * @return Результат операции
         */
        suspend fun addToCart(
                userId: String,
                productId: String,
                count: Int
        ): NetworkResult<ResponseCart>

        /**
         * Обновление количества товара в корзине.
         * @param cartItemId ID элемента корзины
         * @param userId ID пользователя
         * @param productId ID продукта
         * @param count Новое количество
         * @return Результат операции
         */
        suspend fun updateCartItem(
                cartItemId: String,
                userId: String,
                productId: String,
                count: Int
        ): NetworkResult<ResponseCart>
}
```

## File: network/src/main/java/com/example/lol/data/repository/IOrderRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseOrder

/** Интерфейс репозитория для операций с заказами. */
interface IOrderRepository {

    /**
     * Создание заказа.
     * @param userId ID пользователя
     * @param productId ID продукта
     * @param count Количество
     * @return Результат создания заказа
     */
    suspend fun createOrder(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseOrder>
}
```

## File: network/src/main/java/com/example/lol/data/repository/IProductRepositoryApi.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.News
import com.example.lol.data.network.models.ProductApi
import com.example.lol.data.network.models.ProductItem

/**
 * Интерфейс репозитория для работы с продуктами и новостями. Расширяет функциональность для работы
 * с API.
 */
interface IProductRepositoryApi {

    /**
     * Получение списка продуктов.
     * @return Список продуктов
     */
    suspend fun getProducts(): NetworkResult<List<ProductItem>>

    /**
     * Получение детальной информации о продукте.
     * @param productId ID продукта
     * @return Детальная информация о продукте
     */
    suspend fun getProductById(productId: String): NetworkResult<ProductApi>

    /**
     * Поиск продуктов по запросу.
     * @param query Поисковый запрос
     * @return Отфильтрованный список продуктов
     */
    suspend fun searchProducts(query: String): NetworkResult<List<ProductItem>>

    /**
     * Получение списка новостей/акций.
     * @return Список новостей
     */
    suspend fun getNews(): NetworkResult<List<News>>
}
```

## File: network/src/main/java/com/example/lol/data/repository/IProjectRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ProjectApi
import java.io.File

/** Интерфейс репозитория для операций с проектами. */
interface IProjectRepository {

    /**
     * Получение списка проектов.
     * @return Список проектов
     */
    suspend fun getProjects(): NetworkResult<List<ProjectApi>>

    /**
     * Создание нового проекта.
     * @param title Название проекта
     * @param typeProject Тип проекта
     * @param userId ID пользователя
     * @param dateStart Дата начала
     * @param dateEnd Дата окончания
     * @param gender Пол
     * @param descriptionSource Описание источника
     * @param category Категория
     * @param image Файл изображения (опционально)
     * @return Созданный проект
     */
    suspend fun createProject(
            title: String,
            typeProject: String,
            userId: String,
            dateStart: String,
            dateEnd: String,
            gender: String,
            descriptionSource: String,
            category: String,
            image: File? = null
    ): NetworkResult<ProjectApi>
}
```

## File: network/src/main/java/com/example/lol/data/repository/OrderRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*

/** Реализация репозитория для работы с заказами. */
class OrderRepository(private val api: MatuleApi) : IOrderRepository {

    override suspend fun createOrder(
            userId: String,
            productId: String,
            count: Int
    ): NetworkResult<ResponseOrder> {
        return try {
            val request = RequestOrder(userId = userId, productId = productId, count = count)
            val response = api.createOrder(request)

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    private fun parseErrorMessage(errorBody: String?): String {
        if (errorBody == null) return "Неизвестная ошибка"

        return try {
            val gson = com.google.gson.Gson()
            val error = gson.fromJson(errorBody, Error400::class.java)
            error.message
        } catch (e: Exception) {
            errorBody.take(200)
        }
    }
}
```

## File: network/src/main/java/com/example/lol/data/repository/ProductRepositoryApi.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*

/** Реализация репозитория для работы с продуктами через API. */
class ProductRepositoryApi(private val api: MatuleApi) : IProductRepositoryApi {

    override suspend fun getProducts(): NetworkResult<List<ProductItem>> {
        return try {
            val response = api.getProducts()

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!.items)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun getProductById(productId: String): NetworkResult<ProductApi> {
        return try {
            val response = api.getProduct(productId)

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun searchProducts(query: String): NetworkResult<List<ProductItem>> {
        return try {
            // Формируем фильтр согласно API: "(title ?~ 'query')"
            val filter = "(title ?~ '$query')"
            val response = api.getProducts(filter)

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!.items)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun getNews(): NetworkResult<List<News>> {
        return try {
            val response = api.getNews()

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!.items)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    private fun parseErrorMessage(errorBody: String?): String {
        if (errorBody == null) return "Неизвестная ошибка"

        return try {
            val gson = com.google.gson.Gson()
            val error = gson.fromJson(errorBody, Error400::class.java)
            error.message
        } catch (e: Exception) {
            errorBody.take(200)
        }
    }
}
```

## File: network/src/main/java/com/example/lol/data/repository/ProjectRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*
import java.io.File
import okhttp3.MediaType.Companion.toMediaTypeOrNull
import okhttp3.MultipartBody
import okhttp3.RequestBody.Companion.asRequestBody
import okhttp3.RequestBody.Companion.toRequestBody

/** Реализация репозитория для работы с проектами. */
class ProjectRepository(private val api: MatuleApi) : IProjectRepository {

    override suspend fun getProjects(): NetworkResult<List<ProjectApi>> {
        return try {
            val response = api.getProjects()

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!.items)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    override suspend fun createProject(
            title: String,
            typeProject: String,
            userId: String,
            dateStart: String,
            dateEnd: String,
            gender: String,
            descriptionSource: String,
            category: String,
            image: File?
    ): NetworkResult<ProjectApi> {
        return try {
            val imagePart =
                    image?.let {
                        val requestFile = it.asRequestBody("image/*".toMediaTypeOrNull())
                        MultipartBody.Part.createFormData("image", it.name, requestFile)
                    }

            val response =
                    api.createProject(
                            title = title.toRequestBody("text/plain".toMediaTypeOrNull()),
                            typeProject =
                                    typeProject.toRequestBody("text/plain".toMediaTypeOrNull()),
                            userId = userId.toRequestBody("text/plain".toMediaTypeOrNull()),
                            dateStart = dateStart.toRequestBody("text/plain".toMediaTypeOrNull()),
                            dateEnd = dateEnd.toRequestBody("text/plain".toMediaTypeOrNull()),
                            gender = gender.toRequestBody("text/plain".toMediaTypeOrNull()),
                            descriptionSource =
                                    descriptionSource.toRequestBody(
                                            "text/plain".toMediaTypeOrNull()
                                    ),
                            category = category.toRequestBody("text/plain".toMediaTypeOrNull()),
                            image = imagePart
                    )

            if (response.isSuccessful && response.body() != null) {
                NetworkResult.Success(response.body()!!)
            } else {
                val errorMessage = parseErrorMessage(response.errorBody()?.string())
                NetworkResult.Error(errorMessage, response.code())
            }
        } catch (e: Exception) {
            NetworkResult.Error(e.message ?: "Ошибка сети")
        }
    }

    private fun parseErrorMessage(errorBody: String?): String {
        if (errorBody == null) return "Неизвестная ошибка"

        return try {
            val gson = com.google.gson.Gson()
            val error = gson.fromJson(errorBody, Error400::class.java)
            error.message
        } catch (e: Exception) {
            errorBody.take(200)
        }
    }
}
```

## File: network/src/test/java/com/example/lol/data/repository/AuthRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Unit-тесты для AuthRepository с использованием MockWebServer. Использует StubTokenManager для
 * изоляции от Android Context.
 */
class AuthRepositoryTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: AuthRepository
    private lateinit var stubTokenManager: StubTokenManager

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        stubTokenManager = StubTokenManager()
        repository = AuthRepository(api, stubTokenManager)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `login success returns token and user`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.successLoginJson)
        )

        // When
        val result = repository.login("test@test.ru", "password123")

        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test", data?.token)
        assertEquals("user123", data?.record?.id)
        assertEquals("Иван", data?.record?.firstname)

        // Verify token was saved
        assertEquals("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test", stubTokenManager.savedToken)
        assertEquals("user123", stubTokenManager.savedUserId)
    }

    @Test
    fun `login failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse()
                        .setResponseCode(400)
                        .setBody(TestJsonResponses.invalidCredentialsJson)
        )

        // When
        val result = repository.login("wrong@test.ru", "wrongpassword")

        // Then
        assertTrue(result.isError)
        assertEquals("Invalid credentials.", result.errorMessageOrNull())
    }

    @Test
    fun `register success returns user data`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.successRegisterJson)
        )

        // When
        val result = repository.register("new@test.ru", "password123")

        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("user456", data?.id)
        assertFalse(data?.verified ?: true)
    }

    @Test
    fun `register failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.register("existing@test.ru", "password123")

        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }

    @Test
    fun `updateUser success returns updated user`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.updatedUserJson)
        )
        stubTokenManager.savedUserId = "user123"

        // When
        val result = repository.updateUser(
                userId = "user123",
                firstname = "Петр",
                lastname = "Петров",
                secondname = "Петрович",
                datebirthday = "1995-05-15",
                gender = "Мужской"
        )

        // Then
        assertTrue(result.isSuccess)
        val user = result.getOrNull()
        assertNotNull(user)
        assertEquals("Петр", user?.firstname)
        assertEquals("Петров", user?.lastname)
    }

    @Test
    fun `getUser success returns profile`() = runTest {
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.updatedUserJson)
        )

        val result = repository.getUser("user123")

        assertTrue(result.isSuccess)
        val user = result.getOrNull()
        assertNotNull(user)
        assertEquals("user123", user?.id)
        assertEquals("Петр", user?.firstname)
    }

    @Test
    fun `getUser failure returns server error`() = runTest {
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        val result = repository.getUser("unknown")

        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }

    @Test
    fun `logout success clears tokens`() = runTest {
        // Given
        stubTokenManager.savedToken = "test_token"
        stubTokenManager.savedUserId = "user123"
        
        // First response for getUsersAuth
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.usersAuthJson)
        )
        // Second response for logout (delete token)
        mockWebServer.enqueue(
                MockResponse().setResponseCode(204)
        )

        // When
        val result = repository.logout()

        // Then
        assertTrue(result.isSuccess)
        assertNull(stubTokenManager.savedToken)
        assertNull(stubTokenManager.savedUserId)
    }

    @Test
    fun `logout when token missing still clears local auth`() = runTest {
        stubTokenManager.savedToken = "test_token"
        stubTokenManager.savedUserId = "unknown_user"

        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.usersAuthJson)
        )

        val result = repository.logout()

        assertTrue(result.isSuccess)
        assertNull(stubTokenManager.savedToken)
        assertNull(stubTokenManager.savedUserId)
    }
}

/** Stub реализация для тестов без Android Context. Имитирует поведение TokenManager в памяти. */
class StubTokenManager : com.example.lol.data.network.ITokenManager {
    var savedToken: String? = null
    var savedUserId: String? = null

    override fun saveToken(token: String) {
        savedToken = token
    }

    override fun getToken(): String? = savedToken

    override fun saveUserId(userId: String) {
        savedUserId = userId
    }

    override fun getUserId(): String? = savedUserId

    override fun hasToken(): Boolean = !savedToken.isNullOrBlank()

    override fun clearAuth() {
        savedToken = null
        savedUserId = null
    }
}
```

## File: network/src/test/java/com/example/lol/data/repository/CartRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/** Unit-тесты для CartRepository с использованием MockWebServer. */
class CartRepositoryTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: CartRepository

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        repository = CartRepository(api)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `addToCart success returns cart item`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.cartItemJson)
        )

        // When
        val result = repository.addToCart(userId = "user123", productId = "prod1", count = 2)

        // Then
        assertTrue(result.isSuccess)
        val cartItem = result.getOrNull()
        assertNotNull(cartItem)
        assertEquals("cart1", cartItem?.id)
        assertEquals("prod1", cartItem?.productId)
        assertEquals(2, cartItem?.count)
    }

    @Test
    fun `addToCart failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.addToCart(userId = "user123", productId = "invalid", count = 1)

        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }

    @Test
    fun `updateCartItem network error returns error`() = runTest {
        // Given - shutdown server to simulate network error
        mockWebServer.shutdown()

        // When
        val result =
                repository.updateCartItem(
                        cartItemId = "cart1",
                        userId = "user123",
                        productId = "prod1",
                        count = 5
                )

        // Then
        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }

    @Test
    fun `updateCartItem success returns updated item`() = runTest {
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.cartItemJson)
        )

        val result =
                repository.updateCartItem(
                        cartItemId = "cart1",
                        userId = "user123",
                        productId = "prod1",
                        count = 5
                )

        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals(2, data?.count)
    }
}
```

## File: network/src/test/java/com/example/lol/data/repository/OrderRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Unit-тесты для OrderRepository с использованием MockWebServer.
 */
class OrderRepositoryTest {
    
    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: OrderRepository
    
    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()
        
        api = Retrofit.Builder()
            .baseUrl(mockWebServer.url("/"))
            .addConverterFactory(GsonConverterFactory.create())
            .build()
            .create(MatuleApi::class.java)
        
        repository = OrderRepository(api)
    }
    
    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }
    
    @Test
    fun `createOrder success returns order data`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(200)
                .setBody(TestJsonResponses.orderJson)
        )
        
        // When
        val result = repository.createOrder(
            userId = "user123",
            productId = "prod1",
            count = 3
        )
        
        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("order1", data?.id)
        assertEquals("user123", data?.userId)
        assertEquals("prod1", data?.productId)
        assertEquals(3, data?.count)
        
        // Verify request body verification is skipped here as we trust Retrofit,
        // but we could verify recordedRequest if needed.
    }
    
    @Test
    fun `createOrder failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
            MockResponse()
                .setResponseCode(400)
                .setBody(TestJsonResponses.errorJson)
        )
        
        // When
        val result = repository.createOrder(
            userId = "user123",
            productId = "prod1",
            count = 3
        )
        
        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }
}
```

## File: network/src/test/java/com/example/lol/data/repository/ProductRepositoryApiTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/** Unit-тесты для ProductRepositoryApi с использованием MockWebServer. */
class ProductRepositoryApiTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: ProductRepositoryApi

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        repository = ProductRepositoryApi(api)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `getProducts success returns product list`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productsListJson)
        )

        // When
        val result = repository.getProducts()

        // Then
        assertTrue(result.isSuccess)
        val products = result.getOrNull()
        assertNotNull(products)
        assertEquals(2, products?.size)
        assertEquals("Футболка", products?.first()?.title)
        assertEquals(1500, products?.first()?.price)
    }

    @Test
    fun `getProductById success returns product details`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productDetailJson)
        )

        // When
        val result = repository.getProductById("prod1")

        // Then
        assertTrue(result.isSuccess)
        val product = result.getOrNull()
        assertNotNull(product)
        assertEquals("prod1", product?.id)
        assertEquals("Футболка", product?.title)
        assertEquals("Хлопковая футболка", product?.description)
    }

    @Test
    fun `searchProducts sends correct filter parameter`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productsListJson)
        )

        // When
        val result = repository.searchProducts("Футболка")

        // Then
        assertTrue(result.isSuccess)

        // Verify the request was made with correct filter
        val request = mockWebServer.takeRequest()
        assertTrue(request.path?.contains("filter") == true)
    }

    @Test
    fun `getProducts failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.getProducts()

        // Then
        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }

    @Test
    fun `getNews success returns news list`() = runTest {
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.newsListJson)
        )

        val result = repository.getNews()

        assertTrue(result.isSuccess)
        val news = result.getOrNull()
        assertNotNull(news)
        assertEquals(1, news?.size)
        assertEquals("news1", news?.first()?.id)
    }

    @Test
    fun `getNews failure returns server message`() = runTest {
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        val result = repository.getNews()

        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }
}
```

## File: network/src/test/java/com/example/lol/data/repository/ProjectRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.assertEquals
import org.junit.Assert.assertNotNull
import org.junit.Assert.assertTrue
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/** Unit-тесты для ProjectRepository с использованием MockWebServer. */
class ProjectRepositoryTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: ProjectRepository

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
            Retrofit.Builder()
                .baseUrl(mockWebServer.url("/"))
                .addConverterFactory(GsonConverterFactory.create())
                .build()
                .create(MatuleApi::class.java)

        repository = ProjectRepository(api)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `getProjects success returns project list`() = runTest {
        mockWebServer.enqueue(
            MockResponse().setResponseCode(200).setBody(TestJsonResponses.projectsListJson)
        )

        val result = repository.getProjects()

        assertTrue(result.isSuccess)
        val projects = result.getOrNull()
        assertNotNull(projects)
        assertEquals(1, projects?.size)
        assertEquals("Мой проект", projects?.first()?.title)
    }

    @Test
    fun `createProject success returns created project`() = runTest {
        mockWebServer.enqueue(
            MockResponse().setResponseCode(200).setBody(TestJsonResponses.createdProjectJson)
        )

        val result =
            repository.createProject(
                title = "Новый проект",
                typeProject = "Новинки",
                userId = "user123",
                dateStart = "2026-02-01",
                dateEnd = "2026-06-30",
                gender = "Женский",
                descriptionSource = "Новое описание",
                category = "Новинки",
                image = null
            )

        assertTrue(result.isSuccess)
        val project = result.getOrNull()
        assertNotNull(project)
        assertEquals("proj2", project?.id)
        assertEquals("Новый проект", project?.title)
    }

    @Test
    fun `getProjects failure returns error`() = runTest {
        mockWebServer.enqueue(
            MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        val result = repository.getProjects()

        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }

    @Test
    fun `createProject failure returns error`() = runTest {
        mockWebServer.enqueue(
            MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        val result =
            repository.createProject(
                title = "Новый проект",
                typeProject = "Новинки",
                userId = "user123",
                dateStart = "2026-02-01",
                dateEnd = "2026-06-30",
                gender = "Женский",
                descriptionSource = "Новое описание",
                category = "Новинки",
                image = null
            )

        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }
}
```

## File: network/src/test/java/com/example/lol/testdata/TestJsonResponses.kt
```kotlin
package com.example.lol.testdata

import com.example.lol.data.network.models.*

/** Тестовые данные и JSON ответы для unit-тестов. */
object TestJsonResponses {

    // ==================== AUTH ====================

    val successLoginJson =
            """
        {
            "record": {
                "id": "user123",
                "collectionId": "users",
                "collectionName": "_pb_users_auth_",
                "created": "2026-01-01T00:00:00Z",
                "updated": "2026-01-01T00:00:00Z",
                "emailVisibility": true,
                "firstname": "Иван",
                "lastname": "Иванов",
                "secondname": "Иванович",
                "verified": true,
                "datebirthday": "1990-01-01",
                "gender": "Мужской"
            },
            "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test"
        }
    """.trimIndent()

    val successRegisterJson =
            """
        {
            "id": "user456",
            "collectionId": "users",
            "collectionName": "_pb_users_auth_",
            "created": "2026-01-02T00:00:00Z",
            "updated": "2026-01-02T00:00:00Z",
            "emailVisibility": true,
            "firstname": "",
            "lastname": "",
            "secondname": "",
            "verified": false,
            "datebirthday": "",
            "gender": ""
        }
    """.trimIndent()

    val errorJson =
            """
        {
            "status": 400,
            "message": "Failed to create record.",
            "data": {}
        }
    """.trimIndent()

    val invalidCredentialsJson =
            """
        {
            "status": 400,
            "message": "Invalid credentials.",
            "data": {}
        }
    """.trimIndent()

    // ==================== PRODUCTS ====================

    val productsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 2,
            "items": [
                {
                    "id": "prod1",
                    "title": "Футболка",
                    "price": 1500,
                    "typeCloses": "Верх",
                    "type": "Новинки"
                },
                {
                    "id": "prod2",
                    "title": "Джинсы",
                    "price": 3000,
                    "typeCloses": "Низ",
                    "type": "Популярные"
                }
            ]
        }
    """.trimIndent()

    val productDetailJson =
            """
        {
            "id": "prod1",
            "collectionId": "products",
            "collectionName": "products",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "title": "Футболка",
            "description": "Хлопковая футболка",
            "price": 1500,
            "typeCloses": "Верх",
            "type": "Новинки",
            "approximateCost": "1500 ₽"
        }
    """.trimIndent()

    // ==================== CART ====================

    val cartItemJson =
            """
        {
            "id": "cart1",
            "collectionId": "cart",
            "collectionName": "cart",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "user_id": "user123",
            "product_id": "prod1",
            "count": 2
        }
    """.trimIndent()

    // ==================== PROJECTS ====================

    val projectsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "proj1",
                    "collectionId": "project",
                    "collectionName": "project",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z",
                    "title": "Мой проект",
                    "dateStart": "2026-01-01",
                    "dateEnd": "2026-12-31",
                    "gender": "Мужской",
                    "description_source": "Описание",
                    "category": "Популярные",
                    "image": "image.jpg",
                    "user_id": "user123"
                }
            ]
        }
    """.trimIndent()

    val createdProjectJson =
            """
        {
            "id": "proj2",
            "collectionId": "project",
            "collectionName": "project",
            "created": "2026-01-02T00:00:00Z",
            "updated": "2026-01-02T00:00:00Z",
            "title": "Новый проект",
            "dateStart": "2026-02-01",
            "dateEnd": "2026-06-30",
            "gender": "Женский",
            "description_source": "Новое описание",
            "category": "Новинки",
            "image": "",
            "user_id": "user123"
        }
    """.trimIndent()

    // ==================== ORDER ====================

    val orderJson =
            """
        {
            "id": "order1",
            "collectionId": "orders",
            "collectionName": "orders",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "user_id": "user123",
            "product_id": "prod1",
            "count": 3
        }
    """.trimIndent()

    // ==================== NEWS ====================

    val newsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "news1",
                    "collectionId": "news",
                    "collectionName": "news",
                    "newsImage": "promo.jpg",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z"
                }
            ]
        }
    """.trimIndent()

    // ==================== TEST DATA OBJECTS ====================

    fun createTestUser(
            id: String = "user123",
            firstname: String = "Иван",
            lastname: String = "Иванов"
    ) =
            User(
                    id = id,
                    collectionId = "users",
                    collectionName = "_pb_users_auth_",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    emailVisibility = true,
                    firstname = firstname,
                    lastname = lastname,
                    secondname = "Иванович",
                    verified = true,
                    datebirthday = "1990-01-01",
                    gender = "Мужской"
            )

    fun createTestProductItem(id: String = "prod1", title: String = "Футболка", price: Int = 1500) =
            ProductItem(
                    id = id,
                    title = title,
                    price = price,
                    typeCloses = "Верх",
                    type = "Новинки"
            )

    fun createTestProductApi(id: String = "prod1", title: String = "Футболка", price: Int = 1500) =
            ProductApi(
                    id = id,
                    collectionId = "products",
                    collectionName = "products",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    title = title,
                    description = "Описание товара",
                    price = price,
                    typeCloses = "Верх",
                    type = "Новинки",
                    approximateCost = "$price ₽"
            )

    fun createTestProjectApi(id: String = "proj1", title: String = "Мой проект") =
            ProjectApi(
                    id = id,
                    collectionId = "project",
                    collectionName = "project",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    title = title,
                    dateStart = "2026-01-01",
                    dateEnd = "2026-12-31",
                    gender = "Мужской",
                    descriptionSource = "Описание",
                    category = "Популярные",
                    image = "image.jpg",
                    userId = "user123"
            )

    fun createTestResponseCart(id: String = "cart1", productId: String = "prod1", count: Int = 1) =
            ResponseCart(
                    id = id,
                    collectionId = "cart",
                    collectionName = "cart",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    userId = "user123",
                    productId = productId,
                    count = count
            )

    fun createTestResponseOrder(
            id: String = "order1",
            productId: String = "prod1",
            count: Int = 1
    ) =
            ResponseOrder(
                    id = id,
                    collectionId = "orders",
                    collectionName = "orders",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    userId = "user123",
                    productId = productId,
                    count = count
            )

    fun createTestResponseAuth() = ResponseAuth(record = createTestUser(), token = "test_token_123")

    fun createTestResponseRegister() =
            ResponseRegister(
                    id = "user456",
                    collectionId = "users",
                    collectionName = "_pb_users_auth_",
                    created = "2026-01-02T00:00:00Z",
                    updated = "2026-01-02T00:00:00Z",
                    emailVisibility = true,
                    firstname = "",
                    lastname = "",
                    secondname = "",
                    verified = false,
                    datebirthday = "",
                    gender = ""
            )

    val updatedUserJson =
            """
        {
            "id": "user123",
            "collectionId": "users",
            "collectionName": "_pb_users_auth_",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "emailVisibility": true,
            "firstname": "Петр",
            "lastname": "Петров",
            "secondname": "Петрович",
            "verified": true,
            "datebirthday": "1995-05-15",
            "gender": "Мужской"
        }
    """.trimIndent()

    val usersAuthJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "token1",
                    "collectionId": "_authOrigins",
                    "collectionName": "_authOrigins",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z",
                    "collectionRef": "users",
                    "fingerprint": "fp_test",
                    "recordRef": "user123"
                }
            ]
        }
    """.trimIndent()
}
```

## File: uikit/build.gradle.kts
```kotlin
import org.gradle.api.JavaVersion

plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
}

android {
    namespace = "com.example.lol.uikit"
    compileSdk = 36

    defaultConfig {
        minSdk = 24
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = "11"
    }

    buildFeatures {
        compose = true
    }
}

dependencies {
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx.v2100)
    implementation(platform(libs.androidx.compose.bom.v20251200))
    implementation(libs.androidx.compose.ui)
    implementation(libs.androidx.compose.ui.graphics)
    implementation(libs.androidx.ui.tooling.preview)
    implementation(libs.androidx.material3)

    testImplementation(libs.junit)

    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(platform(libs.androidx.compose.bom.v20251200))
    androidTestImplementation(libs.androidx.ui.test.junit4)
    androidTestImplementation(libs.androidx.activity.compose.v1121)

    debugImplementation(libs.androidx.ui.tooling)
    debugImplementation(libs.androidx.ui.test.manifest)
}
```

## File: uikit/src/androidTest/java/com/example/lol/components/UiKitStateTest.kt
```kotlin
package com.example.lol.components

import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.setValue
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.toArgb
import androidx.compose.ui.test.assertIsNotSelected
import androidx.compose.ui.test.assertIsSelected
import androidx.compose.ui.test.assertCountEquals
import androidx.compose.ui.test.assertTextContains
import androidx.compose.ui.test.junit4.createComposeRule
import androidx.compose.ui.test.onAllNodesWithText
import androidx.compose.ui.test.onNodeWithTag
import androidx.compose.ui.test.onNodeWithText
import androidx.compose.ui.test.performClick
import com.example.lol.data.Product
import com.example.lol.ui.theme.RedError
import org.junit.Assert.assertEquals
import org.junit.Rule
import org.junit.Test

class UiKitStateTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun inputErrorState_exposesErrorColorsAndMessage() {
        composeTestRule.setContent {
            AppTextField(
                value = "",
                onValueChange = {},
                label = "Email",
                placeholder = "name@mail.com",
                isError = true,
                errorMessage = "Поле обязательно",
                testTagPrefix = "input_error"
            )
        }

        composeTestRule.onNodeWithTag("input_error_error").assertTextContains("Поле обязательно")

        val containerConfig =
            composeTestRule.onNodeWithTag("input_error_container").fetchSemanticsNode().config
        val errorConfig = composeTestRule.onNodeWithTag("input_error_error").fetchSemanticsNode().config

        assertEquals(Color(0xFFFFF5F5).toArgb().toLong(), containerConfig[UiKitBackgroundColorKey])
        assertEquals(RedError.toArgb().toLong(), containerConfig[UiKitBorderColorKey])
        assertEquals(RedError.toArgb().toLong(), errorConfig[UiKitTextColorKey])
    }

    @Test
    fun selectWithoutIcon_clickOpensBottomSheetWithEmojiOptions() {
        composeTestRule.setContent {
            var selectedValue by mutableStateOf("")

            AppSelectField(
                value = selectedValue,
                label = "Выбор",
                placeholder = "Выберите",
                options = listOf("😀 Опция 1", "🚀 Опция 2"),
                showChevron = false,
                testTagPrefix = "select_no_icon",
                onOptionSelected = { selectedValue = it }
            )
        }

        composeTestRule.onNodeWithTag("select_no_icon_trigger").performClick()

        composeTestRule.onNodeWithTag("select_no_icon_sheet").assertTextContains("Выбор")
        composeTestRule.onNodeWithText("😀 Опция 1").assertTextContains("😀")
    }

    @Test
    fun chip_togglesBetweenSelectedAndNotSelected() {
        composeTestRule.setContent {
            var selected by mutableStateOf(false)

            AppChip(
                text = "Новинки",
                isSelected = selected,
                onClick = { selected = !selected },
                testTag = "chip_toggle"
            )
        }

        composeTestRule.onNodeWithTag("chip_toggle").assertIsNotSelected()
        composeTestRule.onNodeWithTag("chip_toggle").performClick()
        composeTestRule.onNodeWithTag("chip_toggle").assertIsSelected()
    }

    @Test
    fun selectField_selectingEmojiOptionUpdatesValue() {
        composeTestRule.setContent {
            var selectedValue by mutableStateOf("")

            AppSelectField(
                value = selectedValue,
                placeholder = "Выберите",
                options = listOf("🧪 Тест", "📦 Пакет"),
                testTagPrefix = "select_emoji",
                onOptionSelected = { selectedValue = it }
            )
        }

        composeTestRule.onNodeWithTag("select_emoji_trigger").performClick()
        composeTestRule.onNodeWithTag("select_emoji_option_0").performClick()

        composeTestRule.onNodeWithText("🧪 Тест").assertTextContains("Тест")
    }

    @Test
    fun tabBar_keepsSingleFocusedItem() {
        composeTestRule.setContent {
            var selectedRoute by mutableStateOf("main")
            val items =
                listOf(
                    AppTabBarItem(route = "main", title = "Main"),
                    AppTabBarItem(route = "catalog", title = "Catalog"),
                    AppTabBarItem(route = "profile", title = "Profile")
                )

            AppTabBar(
                items = items,
                selectedRoute = selectedRoute,
                testTagPrefix = "tab",
                onItemSelected = { selectedRoute = it }
            )
        }

        composeTestRule.onNodeWithTag("tab_main").assertIsSelected()
        composeTestRule.onNodeWithTag("tab_catalog").assertIsNotSelected()
        composeTestRule.onNodeWithTag("tab_profile").assertIsNotSelected()

        composeTestRule.onNodeWithTag("tab_profile").performClick()

        composeTestRule.onNodeWithTag("tab_profile").assertIsSelected()
        composeTestRule.onNodeWithTag("tab_main").assertIsNotSelected()
        composeTestRule.onNodeWithTag("tab_catalog").assertIsNotSelected()
    }

    @Test
    fun productCard_addAndDeleteStates_triggerCorrectActions() {
        var addClicks = 0
        var removeClicks = 0

        val product =
            Product(
                id = 1,
                title = "Nike Air Max 270",
                description = "Great sneakers",
                price = 12990,
                category = "Sneakers",
                imageUrl = "https://example.com/image.png"
            )

        composeTestRule.setContent {
            var isInCart by mutableStateOf(false)

            ProductCard(
                product = product,
                onClick = {},
                onAddToCart = {
                    addClicks += 1
                    isInCart = true
                },
                onRemoveFromCart = {
                    removeClicks += 1
                    isInCart = false
                },
                isInCart = isInCart
            )
        }

        composeTestRule.onAllNodesWithText("Добавить").assertCountEquals(1)
        composeTestRule.onAllNodesWithText("Убрать").assertCountEquals(0)
        composeTestRule.onNodeWithText("Добавить").performClick()

        assertEquals(1, addClicks)
        assertEquals(0, removeClicks)

        composeTestRule.onAllNodesWithText("Убрать").assertCountEquals(1)
        composeTestRule.onAllNodesWithText("Добавить").assertCountEquals(0)
        composeTestRule.onNodeWithText("Убрать").performClick()

        assertEquals(1, addClicks)
        assertEquals(1, removeClicks)
        composeTestRule.onAllNodesWithText("Добавить").assertCountEquals(1)
    }
}
```

## File: uikit/src/main/AndroidManifest.xml
```xml
<manifest />
```

## File: uikit/src/main/java/com/example/lol/components/AppChip.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.platform.testTag
import androidx.compose.ui.semantics.selected
import androidx.compose.ui.semantics.semantics
import androidx.compose.ui.unit.dp
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.ChipInactiveBg
import com.example.lol.ui.theme.TextGray
import com.example.lol.ui.theme.TextMedium

@Composable
fun AppChip(
    text: String,
    isSelected: Boolean,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
    testTag: String = "app_chip"
) {
    Box(
        modifier =
            modifier
                .background(
                    color = if (isSelected) AccentBlue else ChipInactiveBg,
                    shape = RoundedCornerShape(10.dp)
                )
                .clickable(onClick = onClick)
                .padding(horizontal = 20.dp, vertical = 14.dp)
                .testTag(testTag)
                .semantics {
                    selected = isSelected
                },
        contentAlignment = Alignment.Center
    ) {
        Text(
            text = text,
            color = if (isSelected) androidx.compose.ui.graphics.Color.White else TextGray,
            style = TextMedium
        )
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/AppHeader.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.example.lol.uikit.R
import com.example.lol.ui.theme.Title3Semibold

/**
 * Универсальный заголовок экрана с опциональной кнопкой назад и правым слотом.
 *
 * @param title Текст в центре заголовка.
 * @param showBackButton Показывать ли кнопку назад слева.
 * @param onBackClick Обработчик нажатия на кнопку назад.
 * @param trailingIcon Опциональный контент в правой части заголовка.
 * @param modifier Модификатор контейнера.
 */
@Composable
fun AppHeader(
        title: String? = null,
        showBackButton: Boolean = false,
        onBackClick: () -> Unit = {},
        trailingIcon: @Composable (() -> Unit)? = null,
        modifier: Modifier = Modifier
) {
    Row(
            modifier = modifier.fillMaxWidth().height(56.dp).padding(horizontal = 20.dp),
            verticalAlignment = Alignment.CenterVertically,
            horizontalArrangement = Arrangement.SpaceBetween
    ) {
        Box(modifier = Modifier.size(44.dp), contentAlignment = Alignment.CenterStart) {
            if (showBackButton) {
                Box(
                        modifier =
                                Modifier.size(44.dp)
                                        .background(Color(0xFFF5F5F9), CircleShape)
                                        .clickable(onClick = onBackClick),
                        contentAlignment = Alignment.Center
                ) {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_chevron_left),
                            contentDescription = "Back",
                            tint = Color.Black,
                            modifier = Modifier.size(24.dp)
                    )
                }
            }
        }

        if (title != null) {
            Text(text = title, style = Title3Semibold, color = Color.Black)
        }

        Box(modifier = Modifier.size(44.dp), contentAlignment = Alignment.CenterEnd) {
            if (trailingIcon != null) {
                trailingIcon()
            }
        }
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/AppSelectField.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.testTag
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.example.lol.uikit.R
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.InputBg
import com.example.lol.ui.theme.InputStroke
import com.example.lol.ui.theme.RedError
import com.example.lol.ui.theme.TextGray
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title3Semibold

/**
 * Поле выбора значения из списка через ModalBottomSheet.
 *
 * @param value Текущее выбранное значение.
 * @param label Подпись над полем.
 * @param placeholder Текст-заполнитель, когда значение не выбрано.
 * @param options Список доступных вариантов.
 * @param onOptionSelected Колбэк выбора варианта.
 * @param showChevron Показывать ли иконку стрелки в поле.
 * @param isError Признак ошибки поля.
 * @param errorMessage Сообщение ошибки под полем.
 * @param testTagPrefix Префикс тестовых тегов.
 * @param modifier Модификатор контейнера.
 */
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun AppSelectField(
        value: String,
        label: String? = null,
        placeholder: String = "",
        options: List<String>,
        onOptionSelected: (String) -> Unit,
        showChevron: Boolean = true,
        isError: Boolean = false,
        errorMessage: String? = null,
        testTagPrefix: String = "app_select_field",
        modifier: Modifier = Modifier
) {
    var isSheetVisible by remember { mutableStateOf(false) }
    val sheetState = rememberModalBottomSheetState()
    val borderColor = if (isError) RedError else InputStroke
    val backgroundColor = if (isError) Color(0xFFFFF5F5) else InputBg

    Column(modifier = modifier) {
        if (label != null) {
            Text(text = label, style = CaptionRegular, color = TextGray)
            Spacer(modifier = Modifier.height(8.dp))
        }

        Box(
                modifier =
                        Modifier.fillMaxWidth()
                                .height(48.dp)
                                .background(backgroundColor, RoundedCornerShape(10.dp))
                                .border(1.dp, borderColor, RoundedCornerShape(10.dp))
                                .clickable { isSheetVisible = true }
                                .padding(horizontal = 16.dp)
                                .testTag("${testTagPrefix}_trigger"),
                contentAlignment = Alignment.CenterStart
        ) {
            Row(verticalAlignment = Alignment.CenterVertically) {
                Text(
                        text = if (value.isEmpty()) placeholder else value,
                        color = if (value.isEmpty()) Color(0xFFBFC7D1) else Color.Black,
                        style = TextRegular,
                        modifier = Modifier.weight(1f)
                )
                if (showChevron) {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_chevron_down),
                            contentDescription = "Open options",
                            tint = Color(0xFFBFC7D1),
                            modifier = Modifier.size(20.dp)
                    )
                }
            }
        }

        if (isError && !errorMessage.isNullOrBlank()) {
            Spacer(modifier = Modifier.height(4.dp))
            Text(text = errorMessage, style = CaptionRegular, color = RedError)
        }
    }

    if (isSheetVisible) {
        ModalBottomSheet(
                onDismissRequest = { isSheetVisible = false },
                sheetState = sheetState,
                containerColor = Color.White,
                modifier = Modifier.testTag("${testTagPrefix}_sheet")
        ) {
            Column(modifier = Modifier.fillMaxWidth().padding(horizontal = 20.dp, vertical = 12.dp)) {
                if (!label.isNullOrBlank()) {
                    Text(
                            text = label,
                            style = Title3Semibold,
                            color = Color.Black,
                            modifier = Modifier.padding(bottom = 16.dp)
                    )
                }

                options.forEachIndexed { index, option ->
                    Row(
                            modifier =
                                    Modifier.fillMaxWidth()
                                            .clickable {
                                                onOptionSelected(option)
                                                isSheetVisible = false
                                            }
                                            .padding(vertical = 14.dp)
                                            .testTag("${testTagPrefix}_option_$index"),
                            verticalAlignment = Alignment.CenterVertically
                    ) {
                        Text(text = option, style = TextRegular, color = Color.Black)
                    }
                }
            }
        }
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/AppTabBar.kt
```kotlin
package com.example.lol.components

import androidx.annotation.DrawableRes
import androidx.compose.foundation.layout.size
import androidx.compose.material3.Icon
import androidx.compose.material3.NavigationBar
import androidx.compose.material3.NavigationBarItem
import androidx.compose.material3.NavigationBarItemDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.testTag
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.ui.theme.AccentBlue

data class AppTabBarItem(
    val route: String,
    val title: String,
    @DrawableRes val iconRes: Int? = null
)

@Composable
fun AppTabBar(
    items: List<AppTabBarItem>,
    selectedRoute: String,
    onItemSelected: (String) -> Unit,
    modifier: Modifier = Modifier,
    testTagPrefix: String = "app_tab_bar"
) {
    NavigationBar(
        modifier = modifier,
        containerColor = Color.White,
        contentColor = AccentBlue,
        tonalElevation = 0.dp
    ) {
        items.forEach { item ->
            NavigationBarItem(
                modifier = Modifier.testTag("${testTagPrefix}_${item.route}"),
                icon = {
                    if (item.iconRes != null) {
                        Icon(
                            painter = painterResource(id = item.iconRes),
                            contentDescription = item.title,
                            modifier = Modifier.size(24.dp)
                        )
                    }
                },
                label = {
                    Text(
                        item.title,
                        fontSize = 12.sp,
                        fontFamily = FontFamily.Default,
                        fontWeight = FontWeight.Normal
                    )
                },
                selected = selectedRoute == item.route,
                colors =
                    NavigationBarItemDefaults.colors(
                        selectedIconColor = AccentBlue,
                        selectedTextColor = AccentBlue,
                        indicatorColor = Color.Transparent,
                        unselectedIconColor = Color(0xFFB8C1CC),
                        unselectedTextColor = Color(0xFFB8C1CC)
                    ),
                onClick = { onItemSelected(item.route) }
            )
        }
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/AppTextField.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.BasicTextField
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.SolidColor
import androidx.compose.ui.graphics.toArgb
import androidx.compose.ui.platform.testTag
import androidx.compose.ui.semantics.semantics
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.input.VisualTransformation
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.ui.theme.InputBg
import com.example.lol.ui.theme.InputStroke
import com.example.lol.ui.theme.TextGray
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.Roboto

/**
 * Custom text field component for the app with consistent styling.
 * 
 * @param value Current text value
 * @param onValueChange Callback when text changes
 * @param label Optional label above the field
 * @param placeholder Placeholder text when empty
 * @param modifier Modifier for styling
 * @param visualTransformation Transformation for password etc.
 * @param keyboardOptions Keyboard configuration
 * @param trailingIcon Icon at the end
 * @param leadingIcon Icon at the start
 * @param singleLine Whether to restrict to single line
 * @param isError Whether to show error state
 * @param errorMessage Text to display when in error state
 * @param testTagPrefix Prefix for UI-test tags
 */
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun AppTextField(
    value: String,
    onValueChange: (String) -> Unit,
    label: String? = null,
    placeholder: String = "",
    modifier: Modifier = Modifier,
    visualTransformation: VisualTransformation = VisualTransformation.None,
    keyboardOptions: KeyboardOptions = KeyboardOptions.Default,
    trailingIcon: @Composable (() -> Unit)? = null,
    leadingIcon: @Composable (() -> Unit)? = null,
    singleLine: Boolean = true,
    isError: Boolean = false,
    errorMessage: String? = null,
    testTagPrefix: String = "app_text_field"
) {
    val backgroundColor = if (isError) Color(0xFFFFF5F5) else InputBg
    val borderColor = if (isError) com.example.lol.ui.theme.RedError else InputStroke
    val errorColor = com.example.lol.ui.theme.RedError

    Column(modifier = modifier) {
        if (label != null) {
            Text(
                text = label,
                style = CaptionRegular,
                color = TextGray
            )
            Spacer(modifier = Modifier.height(8.dp))
        }
        BasicTextField(
            value = value,
            onValueChange = onValueChange,
            modifier = Modifier
                .fillMaxWidth()
                .height(48.dp)
                .background(backgroundColor, RoundedCornerShape(10.dp))
                .border(1.dp, borderColor, RoundedCornerShape(10.dp))
                .testTag("${testTagPrefix}_container")
                .semantics {
                    uiKitBackgroundColor = backgroundColor.toArgb().toLong()
                    uiKitBorderColor = borderColor.toArgb().toLong()
                },
            textStyle = TextRegular.copy(
                color = Color.Black
            ),
            visualTransformation = visualTransformation,
            keyboardOptions = keyboardOptions,
            singleLine = singleLine,
            cursorBrush = SolidColor(Color.Black),
            decorationBox = { innerTextField ->
                Row(
                    modifier = Modifier.padding(horizontal = 16.dp),
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    if (leadingIcon != null) {
                        leadingIcon()
                        Spacer(modifier = Modifier.width(12.dp))
                    }
                    Box(modifier = Modifier.weight(1f)) {
                        if (value.isEmpty()) {
                            Text(
                                text = placeholder,
                                color = Color(0xFFBFC7D1),
                                style = TextRegular
                            )
                        }
                        innerTextField()
                    }
                    if (trailingIcon != null) {
                        Spacer(modifier = Modifier.width(12.dp))
                        trailingIcon()
                    }
                }
            }
        )
        if (isError && errorMessage != null) {
            Spacer(modifier = Modifier.height(4.dp))
            Text(
                text = errorMessage,
                style = CaptionRegular,
                color = errorColor,
                modifier = Modifier
                    .testTag("${testTagPrefix}_error")
                    .semantics { uiKitTextColor = errorColor.toArgb().toLong() },
                fontSize = 12.sp
            )
        }
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/ErrorNotification.kt
```kotlin
package com.example.lol.components

import androidx.compose.animation.AnimatedVisibility
import androidx.compose.animation.slideInVertically
import androidx.compose.animation.slideOutVertically
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.compose.ui.zIndex
import com.example.lol.uikit.R
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.RedError
import kotlinx.coroutines.delay

/**
 * Всплывающее уведомление об ошибке с автозакрытием через 5 секунд.
 *
 * @param message Текст ошибки. Если `null`, уведомление не показывается.
 * @param onDismiss Вызывается при ручном или автоматическом закрытии.
 */
@Composable
fun ErrorNotification(message: String?, onDismiss: () -> Unit) {
        var isVisible by remember(message) { mutableStateOf(message != null) }

        LaunchedEffect(message) {
                if (message != null) {
                        isVisible = true
                        delay(5000)
                        isVisible = false
                        onDismiss()
                }
        }

        AnimatedVisibility(
                visible = isVisible && message != null,
                enter = slideInVertically(initialOffsetY = { -it }),
                exit = slideOutVertically(targetOffsetY = { -it }),
                modifier = Modifier.zIndex(100f)
        ) {
                Box(
                        modifier =
                                Modifier.fillMaxWidth()
                                        .padding(top = 40.dp, start = 20.dp, end = 20.dp)
                ) {
                        Row(
                                modifier =
                                        Modifier.fillMaxWidth()
                                                .background(RedError, RoundedCornerShape(12.dp))
                                                .padding(16.dp),
                                verticalAlignment = Alignment.CenterVertically
                        ) {
                                Text(
                                        text = message ?: "",
                                        color = Color.White,
                                        style = CaptionRegular,
                                        modifier = Modifier.weight(1f)
                                )

                                Icon(
                                        painter = painterResource(id = R.drawable.icon_close),
                                        contentDescription = "Close",
                                        tint = Color.White,
                                        modifier =
                                                Modifier.size(20.dp).clickable {
                                                        isVisible = false
                                                        onDismiss()
                                                }
                                )
                        }
                }
        }
}
```

## File: uikit/src/main/java/com/example/lol/components/GenderSelectionSheet.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Text
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title3Semibold

/**
 * BottomSheet для выбора пола на экране регистрации.
 *
 * @param onDismiss Колбэк закрытия BottomSheet.
 * @param onGenderSelected Колбэк выбора значения пола.
 */
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun GenderSelectionSheet(
    onDismiss: () -> Unit,
    onGenderSelected: (String) -> Unit
) {
    val sheetState = rememberModalBottomSheetState()
    
    ModalBottomSheet(
        onDismissRequest = onDismiss,
        sheetState = sheetState,
        containerColor = Color.White,
        dragHandle = {
            Box(
                modifier = Modifier
                    .padding(top = 10.dp)
                    .width(32.dp)
                    .height(4.dp)
                    .background(Color(0xFFEBEBEB), RoundedCornerShape(2.dp))
            )
        }
    ) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(20.dp)
                .padding(bottom = 20.dp)
        ) {
            Text(
                text = "Пол",
                style = Title3Semibold,
                color = Color.Black,
                modifier = Modifier.padding(bottom = 16.dp)
            )
            
            GenderOption(text = "Мужской", emoji = "👨", onClick = { onGenderSelected("Мужской") })
            Spacer(modifier = Modifier.height(16.dp))
            GenderOption(text = "Женский", emoji = "👩", onClick = { onGenderSelected("Женский") })
        }
    }
}

/**
 * Элемент списка выбора пола в BottomSheet.
 *
 * @param text Отображаемое название варианта.
 * @param emoji Эмодзи для визуального акцента.
 * @param onClick Обработчик выбора варианта.
 */
@Composable
fun GenderOption(text: String, emoji: String, onClick: () -> Unit) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick)
            .padding(vertical = 12.dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(text = emoji, style = Title3Semibold, modifier = Modifier.padding(end = 12.dp))
        Text(text = text, style = TextRegular, color = Color.Black)
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/PhotoPickerBottomSheet.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title3Semibold

/**
 * BottomSheet выбора источника фотографии.
 *
 * @param onDismiss Колбэк закрытия BottomSheet.
 * @param onCameraClick Обработчик выбора камеры.
 * @param onGalleryClick Обработчик выбора галереи.
 */
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PhotoPickerBottomSheet(
    onDismiss: () -> Unit,
    onCameraClick: () -> Unit,
    onGalleryClick: () -> Unit
) {
    val sheetState = rememberModalBottomSheetState()
    
    ModalBottomSheet(
        onDismissRequest = onDismiss,
        sheetState = sheetState,
        containerColor = Color.White,
        dragHandle = {
            Box(
                modifier = Modifier
                    .padding(top = 10.dp)
                    .width(32.dp)
                    .height(4.dp)
                    .background(Color(0xFFEBEBEB), RoundedCornerShape(2.dp))
            )
        }
    ) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(20.dp)
                .padding(bottom = 20.dp)
        ) {
            Text(
                text = "Добавить фото",
                style = Title3Semibold,
                color = Color.Black,
                modifier = Modifier.padding(bottom = 16.dp)
            )
            
            PhotoOption(text = "Сделать снимок", icon = "📷", onClick = onCameraClick)
            Spacer(modifier = Modifier.height(16.dp))
            PhotoOption(text = "Выбрать из галереи", icon = "🖼️", onClick = onGalleryClick)
        }
    }
}

/**
 * Элемент списка выбора источника фото.
 *
 * @param text Отображаемый текст пункта.
 * @param icon Эмодзи-иконка пункта.
 * @param onClick Обработчик нажатия на пункт.
 */
@Composable
fun PhotoOption(text: String, icon: String, onClick: () -> Unit) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick)
            .padding(vertical = 12.dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(text = icon, fontSize = 24.sp, modifier = Modifier.padding(end = 12.dp))
        Text(text = text, style = TextRegular, color = Color.Black)
    }
}
```

## File: uikit/src/main/java/com/example/lol/components/ProductCard.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextOverflow
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.data.Product
import com.example.lol.ui.theme.AccentBlue

/**
 * Карточка товара в списках каталога и главной.
 *
 * @param product Данные товара для отображения.
 * @param onClick Обработчик открытия подробной информации.
 * @param onAddToCart Обработчик добавления товара в корзину.
 * @param onRemoveFromCart Обработчик удаления товара из корзины.
 * @param isInCart Признак, что товар уже добавлен в корзину.
 * @param modifier Модификатор карточки.
 */
@Composable
fun ProductCard(
        product: Product,
        onClick: () -> Unit,
        onAddToCart: () -> Unit,
        onRemoveFromCart: () -> Unit,
        isInCart: Boolean,
        modifier: Modifier = Modifier
) {
        Card(
                modifier =
                        modifier.fillMaxWidth()
                                .height(136.dp)
                                .clickable(onClick = onClick)
                                .shadow(
                                        elevation = 20.dp,
                                        shape = RoundedCornerShape(12.dp),
                                        spotColor = Color(0x99E4E8F5)
                                ),
                shape = RoundedCornerShape(12.dp),
                colors = CardDefaults.cardColors(containerColor = Color.White),
                border = androidx.compose.foundation.BorderStroke(1.dp, Color(0xFFF4F4F4)),
                elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
        ) {
                Box(modifier = Modifier.fillMaxSize().padding(16.dp)) {
                        Column(modifier = Modifier.fillMaxWidth(0.65f)) {
                                Text(
                                        text = product.title,
                                        fontSize = 16.sp,
                                        fontWeight = FontWeight.Bold,
                                        color = Color.Black,
                                        fontFamily = FontFamily.Default,
                                        maxLines = 2,
                                        overflow = TextOverflow.Ellipsis,
                                        lineHeight = 20.sp
                                )

                                Spacer(modifier = Modifier.height(4.dp))

                                Text(
                                        text = product.category,
                                        fontSize = 14.sp,
                                        fontWeight = FontWeight.Normal,
                                        color = Color(0xFF939396),
                                        fontFamily = FontFamily.Default
                                )

                                Spacer(modifier = Modifier.weight(1f))
                        }

                        Row(
                                modifier = Modifier.fillMaxWidth().align(Alignment.BottomCenter),
                                horizontalArrangement = Arrangement.SpaceBetween,
                                verticalAlignment = Alignment.Bottom
                        ) {
                                Text(
                                        text = "${product.price} ₽",
                                        fontSize = 17.sp,
                                        fontWeight = FontWeight.Bold,
                                        color = Color.Black,
                                        fontFamily = FontFamily.Default
                                )

                                if (isInCart) {
                                        Button(
                                                onClick = onRemoveFromCart,
                                                colors =
                                                        ButtonDefaults.buttonColors(
                                                                containerColor = Color.White,
                                                                contentColor = AccentBlue
                                                        ),
                                                shape = RoundedCornerShape(10.dp),
                                                contentPadding = PaddingValues(horizontal = 20.dp),
                                                modifier =
                                                        Modifier.height(40.dp)
                                                                .border(
                                                                        1.dp,
                                                                        AccentBlue,
                                                                        RoundedCornerShape(10.dp)
                                                                )
                                        ) {
                                                Text(
                                                        text = "Убрать",
                                                        color = AccentBlue,
                                                        fontSize = 14.sp,
                                                        fontWeight = FontWeight.SemiBold
                                                )
                                        }
                                } else {
                                        Button(
                                                onClick = onAddToCart,
                                                colors =
                                                        ButtonDefaults.buttonColors(
                                                                containerColor = AccentBlue
                                                        ),
                                                shape = RoundedCornerShape(10.dp),
                                                contentPadding = PaddingValues(horizontal = 20.dp),
                                                modifier = Modifier.height(40.dp)
                                        ) {
                                                Text(
                                                        text = "Добавить",
                                                        color = Color.White,
                                                        fontSize = 14.sp,
                                                        fontWeight = FontWeight.SemiBold
                                                )
                                        }
                                }
                        }
                }
        }
}
```

## File: uikit/src/main/java/com/example/lol/components/ProductDetailsSheet.kt
```kotlin
package com.example.lol.components

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.uikit.R
import com.example.lol.data.Product
import com.example.lol.ui.theme.AccentBlue

/**
 * Контент BottomSheet с подробной информацией о товаре.
 *
 * @param product Товар для отображения.
 * @param onAddToCart Обработчик добавления товара в корзину.
 * @param onClose Обработчик закрытия BottomSheet.
 */
@Composable
fun ProductDetailsContent(product: Product, onAddToCart: () -> Unit, onClose: () -> Unit) {
        Column(
                modifier =
                        Modifier.fillMaxWidth()
                                .background(Color.White)
                                .padding(horizontal = 20.dp, vertical = 24.dp)
        ) {
                Row(
                        modifier = Modifier.fillMaxWidth(),
                        horizontalArrangement = Arrangement.SpaceBetween,
                        verticalAlignment = Alignment.Top
                ) {
                        Text(
                                text = product.title,
                                fontSize = 20.sp,
                                fontWeight = FontWeight.Bold,
                                fontFamily = FontFamily.Default,
                                color = Color.Black,
                                lineHeight = 28.sp,
                                modifier = Modifier.weight(1f)
                        )

                        IconButton(
                                onClick = onClose,
                                modifier =
                                        Modifier.background(Color(0xFFF5F5F9), CircleShape)
                                                .size(24.dp)
                        ) {
                                Icon(
                                        painter = painterResource(id = R.drawable.icon_close),
                                        contentDescription = "Close",
                                        tint = Color(0xFF7E7E9A),
                                        modifier = Modifier.size(12.dp)
                                )
                        }
                }

                Spacer(modifier = Modifier.height(24.dp))

                Text(
                        text = "Описание",
                        fontSize = 16.sp,
                        fontWeight = FontWeight.Medium,
                        color = Color(0xFF939396)
                )

                Spacer(modifier = Modifier.height(8.dp))

                Text(
                        text = product.description,
                        fontSize = 15.sp,
                        color = Color.Black,
                        lineHeight = 20.sp
                )

                Spacer(modifier = Modifier.height(24.dp))

                Text(text = "Примерный расход:", fontSize = 14.sp, color = Color(0xFF939396))
                Text(
                        // Значение фиксировано в текущем макете.
                        text = "80-90 г",
                        fontSize = 16.sp,
                        fontWeight = FontWeight.Medium,
                        color = Color.Black
                )

                Spacer(modifier = Modifier.height(32.dp))

                Button(
                        onClick = onAddToCart,
                        modifier = Modifier.fillMaxWidth().height(56.dp),
                        colors = ButtonDefaults.buttonColors(containerColor = AccentBlue),
                        shape = RoundedCornerShape(10.dp)
                ) {
                        Text(
                                text = "Добавить за ${product.price} ₽",
                                fontSize = 17.sp,
                                fontWeight = FontWeight.SemiBold,
                                color = Color.White
                        )
                }
        }
}
```

## File: uikit/src/main/java/com/example/lol/components/SearchBar.kt
```kotlin
package com.example.lol.components

import androidx.compose.material3.Icon
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import com.example.lol.uikit.R

/** Reusable search bar component that wraps AppTextField with a search icon. */
@Composable
fun SearchBar(
        value: String,
        onValueChange: (String) -> Unit,
        placeholder: String = "Поиск",
        modifier: Modifier = Modifier
) {
    AppTextField(
            value = value,
            onValueChange = onValueChange,
            placeholder = placeholder,
            modifier = modifier,
            leadingIcon = {
                Icon(
                        painter = painterResource(id = R.drawable.icon_search),
                        contentDescription = "Search",
                        tint = Color(0xFF939396)
                )
            }
    )
}
```

## File: uikit/src/main/java/com/example/lol/components/UiKitSemantics.kt
```kotlin
package com.example.lol.components

import androidx.compose.ui.semantics.SemanticsPropertyKey
import androidx.compose.ui.semantics.SemanticsPropertyReceiver

val UiKitBackgroundColorKey = SemanticsPropertyKey<Long>("uikit_background_color")
var SemanticsPropertyReceiver.uiKitBackgroundColor by UiKitBackgroundColorKey

val UiKitBorderColorKey = SemanticsPropertyKey<Long>("uikit_border_color")
var SemanticsPropertyReceiver.uiKitBorderColor by UiKitBorderColorKey

val UiKitTextColorKey = SemanticsPropertyKey<Long>("uikit_text_color")
var SemanticsPropertyReceiver.uiKitTextColor by UiKitTextColorKey
```

## File: uikit/src/main/java/com/example/lol/data/Product.kt
```kotlin
package com.example.lol.data

data class Product(
        val id: Int,
        val title: String,
        val description: String,
        val price: Int,
        val category: String,
        val imageUrl: String
)
```

## File: uikit/src/main/java/com/example/lol/ui/theme/Color.kt
```kotlin
package com.example.lol.ui.theme

import androidx.compose.ui.graphics.Color

val Purple80 = Color(0xFFD0BCFF)
val PurpleGrey80 = Color(0xFFCCC2DC)
val Pink80 = Color(0xFFEFB8C8)

val Purple40 = Color(0xFF6650a4)
val PurpleGrey40 = Color(0xFF625b71)
val Pink40 = Color(0xFF7D5260)

val AccentColor = Color(0xFF48B2E7)
val AccentBlue = Color(0xFF1A6FEE)
val AccentBlueInactive = Color(0xFFC9D4FB)
val TextBlack = Color(0xFF000000)
val TextGray = Color(0xFF7E7E9A)
val TextHint = Color(0xFFBFC7D1)
val InputBg = Color(0xFFF5F5F9)
val InputStroke = Color(0xFFEBEBEB)
val BackgroundWhite = Color(0xFFFFFFFF)
val RedError = Color(0xFFF44336)

val BlockColor = Color(0xFFFFFFFF)
val CardShadowColor = Color(0x99E4E8F5)
val ChipInactiveBg = Color(0xFFF5F5F9)
```

## File: uikit/src/main/java/com/example/lol/ui/theme/Theme.kt
```kotlin
package com.example.lol.ui.theme

import android.app.Activity
import android.os.Build
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.dynamicDarkColorScheme
import androidx.compose.material3.dynamicLightColorScheme
import androidx.compose.material3.lightColorScheme
import androidx.compose.runtime.Composable
import androidx.compose.runtime.SideEffect
import androidx.compose.ui.graphics.toArgb
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.platform.LocalView
import androidx.core.view.WindowCompat

private val DarkColorScheme = darkColorScheme(
    primary = AccentBlue,
    secondary = PurpleGrey80,
    tertiary = Pink80
)

private val LightColorScheme = lightColorScheme(
    primary = AccentBlue,
    secondary = PurpleGrey40,
    tertiary = Pink40,
    background = BackgroundWhite,
    surface = BackgroundWhite,
    onPrimary = BackgroundWhite,
    onSecondary = BackgroundWhite,
    onTertiary = BackgroundWhite,
    onBackground = TextBlack,
    onSurface = TextBlack,
)

@Composable
fun LolTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    // Dynamic color is available on Android 12+
    dynamicColor: Boolean = false,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }
        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }
    val view = LocalView.current
    if (!view.isInEditMode) {
        SideEffect {
            val window = (view.context as Activity).window
            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = !darkTheme
        }
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}
```

## File: uikit/src/main/java/com/example/lol/ui/theme/Type.kt
```kotlin
package com.example.lol.ui.theme

import androidx.compose.material3.Typography
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.em
import androidx.compose.ui.unit.sp

// Пока используются системные шрифты как безопасный fallback.
val Roboto = FontFamily.Default
val RobotoFlex = FontFamily.Default
val SFProDisplay = FontFamily.Default

val Title1Semibold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.SemiBold,
                fontSize = 24.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0033.em
        )

val Title1Bold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Bold,
                fontSize = 24.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0033.em
        )

val Title1ExtraBold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.ExtraBold,
                fontSize = 24.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0033.em
        )

val Title2Regular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 20.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0038.em
        )

val Title2Semibold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.SemiBold,
                fontSize = 20.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0038.em
        )

val Title2ExtraBold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.ExtraBold,
                fontSize = 20.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0038.em
        )

val Title2Bold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Bold,
                fontSize = 20.sp,
                lineHeight = 28.sp,
                letterSpacing = 0.0038.em
        )

val Title3Regular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 17.sp,
                lineHeight = 24.sp
        )

val Title3Medium =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Medium,
                fontSize = 17.sp,
                lineHeight = 24.sp
        )

val Title3Semibold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.SemiBold,
                fontSize = 17.sp,
                lineHeight = 24.sp
        )

val HeadlineRegular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 16.sp,
                lineHeight = 20.sp,
                letterSpacing = (-0.0032).em
        )

val HeadlineMedium =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Medium,
                fontSize = 16.sp,
                lineHeight = 20.sp,
                letterSpacing = (-0.0032).em
        )

val TextRegular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 15.sp,
                lineHeight = 20.sp
        )

val TextMedium =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Medium,
                fontSize = 15.sp,
                lineHeight = 20.sp
        )

val CaptionRegular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 14.sp,
                lineHeight = 20.sp
        )

val CaptionSemibold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.SemiBold,
                fontSize = 14.sp,
                lineHeight = 20.sp
        )

val Caption2Regular =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Normal,
                fontSize = 12.sp,
                lineHeight = 16.sp
        )

val Caption2Bold =
        TextStyle(
                fontFamily = Roboto,
                fontWeight = FontWeight.Bold,
                fontSize = 12.sp,
                lineHeight = 16.sp
        )

val TypographyTitle =
        TextStyle(
                fontFamily = RobotoFlex,
                fontWeight = FontWeight.ExtraBold,
                fontSize = 32.sp,
                lineHeight = 48.sp,
                letterSpacing = 0.01.em
        )

val AccentStyle =
        TextStyle(
                fontFamily = RobotoFlex,
                fontWeight = FontWeight.Normal,
                fontSize = 14.sp,
                lineHeight = 16.sp
        )

val Typography =
        Typography(
                displayLarge = TypographyTitle,
                headlineLarge = Title1ExtraBold,
                headlineMedium = Title1Semibold,
                titleLarge = Title2Semibold,
                titleMedium = Title3Semibold,
                titleSmall = Title3Medium,
                bodyLarge = HeadlineRegular,
                bodyMedium = TextRegular,
                bodySmall = CaptionRegular,
                labelLarge = HeadlineMedium,
                labelMedium = TextMedium,
                labelSmall = Caption2Regular
        )
```

## File: app/src/main/java/com/example/lol/Cart/CartViewModel.kt
```kotlin
package com.example.lol.Cart

import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import com.example.lol.data.Product
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.TokenManager
import com.example.lol.domain.usecase.cart.AddToCartUseCase
import com.example.lol.domain.usecase.cart.UpdateCartItemUseCase
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.update
import kotlinx.coroutines.launch

/** Элемент корзины с продуктом и количеством. */
data class CartItem(
        val product: Product,
        var quantity: Int,
        val cartItemId: String? = null // ID записи в API для обновления
)

/** Состояние корзины. */
sealed class CartState {
    object Idle : CartState()
    object Loading : CartState()
    object Success : CartState()
    data class Error(val message: String) : CartState()
}

/** ViewModel для управления корзиной. Синхронизирует локальное состояние с API через UseCases. */
class CartViewModel(
        private val addToCartUseCase: AddToCartUseCase? = null,
        private val updateCartItemUseCase: UpdateCartItemUseCase? = null,
        private val tokenManager: TokenManager? = null
) : ViewModel() {

    private val _cartItems = MutableStateFlow<List<CartItem>>(emptyList())
    val cartItems: StateFlow<List<CartItem>> = _cartItems.asStateFlow()

    private val _cartState = MutableStateFlow<CartState>(CartState.Idle)
    val cartState: StateFlow<CartState> = _cartState.asStateFlow()

    /** Добавление продукта в корзину. Если репозиторий доступен, синхронизирует с сервером. */
    fun addToCart(product: Product) {
        _cartItems.update { currentItems ->
            val existingItem = currentItems.find { it.product.id == product.id }
            if (existingItem != null) {
                currentItems.map {
                    if (it.product.id == product.id) it.copy(quantity = it.quantity + 1) else it
                }
            } else {
                currentItems + CartItem(product, 1)
            }
        }

        // Синхронизация с API если доступен
        syncAddToCart(product)
    }

    /** Синхронизация добавления товара с сервером. */
    private fun syncAddToCart(product: Product) {
        val userId = tokenManager?.getUserId() ?: return
        val useCase = addToCartUseCase ?: return

        viewModelScope.launch {
            when (val result = useCase(userId, product.id.toString(), 1)) {
                is NetworkResult.Success -> {
                    // Обновляем cartItemId для возможности последующего обновления
                    _cartItems.update { items ->
                        items.map {
                            if (it.product.id == product.id && it.cartItemId == null) {
                                it.copy(cartItemId = result.data.id)
                            } else {
                                it
                            }
                        }
                    }
                }
                is NetworkResult.Error -> {
                    // Логируем ошибку, но не откатываем локальное изменение
                    _cartState.value = CartState.Error(result.message)
                }
                is NetworkResult.Loading -> {}
            }
        }
    }

    /** Удаление продукта из корзины. */
    fun removeFromCart(product: Product) {
        val item = _cartItems.value.find { it.product.id == product.id }

        _cartItems.update { currentItems -> currentItems.filter { it.product.id != product.id } }

        // Синхронизация с API (удаление = count = 0)
        item?.cartItemId?.let { cartItemId -> syncUpdateCartItem(cartItemId, product, 0) }
    }

    /** Увеличение количества товара. */
    fun increaseQuantity(product: Product) {
        val item = _cartItems.value.find { it.product.id == product.id }
        val newQuantity = (item?.quantity ?: 0) + 1

        _cartItems.update { currentItems ->
            currentItems.map {
                if (it.product.id == product.id) it.copy(quantity = newQuantity) else it
            }
        }

        item?.cartItemId?.let { cartItemId -> syncUpdateCartItem(cartItemId, product, newQuantity) }
    }

    /** Уменьшение количества товара. */
    fun decreaseQuantity(product: Product) {
        val item = _cartItems.value.find { it.product.id == product.id }
        val newQuantity = maxOf(0, (item?.quantity ?: 0) - 1)

        _cartItems.update { currentItems ->
            currentItems
                    .map {
                        if (it.product.id == product.id) {
                            it.copy(quantity = newQuantity)
                        } else {
                            it
                        }
                    }
                    .filter { it.quantity > 0 }
        }

        item?.cartItemId?.let { cartItemId -> syncUpdateCartItem(cartItemId, product, newQuantity) }
    }

    /** Синхронизация обновления количества товара с сервером. */
    private fun syncUpdateCartItem(cartItemId: String, product: Product, count: Int) {
        val userId = tokenManager?.getUserId() ?: return
        val useCase = updateCartItemUseCase ?: return

        viewModelScope.launch {
            when (val result = useCase(cartItemId, userId, product.id.toString(), count)) {
                is NetworkResult.Success -> {
                    _cartState.value = CartState.Success
                }
                is NetworkResult.Error -> {
                    _cartState.value = CartState.Error(result.message)
                }
                is NetworkResult.Loading -> {}
            }
        }
    }

    /** Очистка корзины. */
    fun clearCart() {
        _cartItems.value = emptyList()
        _cartState.value = CartState.Success
    }

    /** Расчёт общей стоимости корзины. */
    fun calculateTotal(): Int {
        return _cartItems.value.sumOf { it.product.price * it.quantity }
    }

    /** Проверка наличия товара в корзине. */
    fun isInCart(productId: Int): Boolean {
        return _cartItems.value.any { it.product.id == productId }
    }

    /** Получение количества товара в корзине. */
    fun getQuantity(productId: Int): Int {
        return _cartItems.value.find { it.product.id == productId }?.quantity ?: 0
    }

    /** Сброс состояния ошибки. */
    fun resetState() {
        _cartState.value = CartState.Idle
    }
}

/** Factory для создания CartViewModel с зависимостями. */
class CartViewModelFactory(
        private val addToCartUseCase: AddToCartUseCase? = null,
        private val updateCartItemUseCase: UpdateCartItemUseCase? = null,
        private val tokenManager: TokenManager? = null
) : ViewModelProvider.Factory {
    @Suppress("UNCHECKED_CAST")
    override fun <T : ViewModel> create(modelClass: Class<T>): T {
        return CartViewModel(addToCartUseCase, updateCartItemUseCase, tokenManager) as T
    }
}
```

## File: app/src/main/java/com/example/lol/data/repository/MockAuthRepository.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ResponseAuth
import com.example.lol.data.network.models.ResponseRegister
import com.example.lol.data.network.models.User
import java.util.UUID

class MockAuthRepository : IAuthRepository {

        companion object {
                val instance: MockAuthRepository by lazy { MockAuthRepository() }
        }

        private val users = mutableMapOf<String, MockUser>()
        private var currentUser: MockUser? = null

        data class MockUser(
                val id: String,
                val email: String,
                val password: String,
                var firstname: String = "",
                var lastname: String = "",
                var secondname: String = "",
                var datebirthday: String = "",
                var gender: String = ""
        )

        override suspend fun register(
                email: String,
                password: String
        ): NetworkResult<ResponseRegister> {
                if (users.containsKey(email)) {
                        return NetworkResult.Error("Пользователь уже существует")
                }
                val id = UUID.randomUUID().toString()
                val created = "2023-10-27 10:00:00.000Z"

                users[email] = MockUser(id = id, email = email, password = password)

                return NetworkResult.Success(
                        ResponseRegister(
                                id = id,
                                collectionId = "users_collection",
                                collectionName = "users",
                                created = created,
                                updated = created,
                                emailVisibility = true,
                                firstname = "",
                                lastname = "",
                                secondname = "",
                                verified = true,
                                datebirthday = "",
                                gender = ""
                        )
                )
        }

        override suspend fun login(email: String, password: String): NetworkResult<ResponseAuth> {
                val user = users[email]
                if (user == null || user.password != password) {
                        return NetworkResult.Error("Неверный email или пароль")
                }

                currentUser = user

                val userModel =
                        User(
                                id = user.id,
                                collectionId = "users_collection",
                                collectionName = "users",
                                created = "2023-10-27 10:00:00.000Z",
                                updated = "2023-10-27 10:00:00.000Z",
                                emailVisibility = true,
                                firstname = user.firstname,
                                lastname = user.lastname,
                                secondname = user.secondname,
                                verified = true,
                                datebirthday = user.datebirthday,
                                gender = user.gender
                        )

                return NetworkResult.Success(
                        ResponseAuth(record = userModel, token = "mock_token_${user.id}")
                )
        }

        override suspend fun getUser(userId: String): NetworkResult<User> {
                val user = currentUser ?: users.values.find { it.id == userId }

                if (user == null) {
                        return NetworkResult.Error("Пользователь не найден")
                }

                return NetworkResult.Success(
                        User(
                                id = user.id,
                                collectionId = "users_collection",
                                collectionName = "users",
                                created = "2023-10-27 10:00:00.000Z",
                                updated = "2023-10-27 10:00:00.000Z",
                                emailVisibility = true,
                                firstname = user.firstname,
                                lastname = user.lastname,
                                secondname = user.secondname,
                                verified = true,
                                datebirthday = user.datebirthday,
                                gender = user.gender
                        )
                )
        }

        override suspend fun updateUser(
                userId: String,
                firstname: String?,
                lastname: String?,
                secondname: String?,
                datebirthday: String?,
                gender: String?
        ): NetworkResult<User> {
                val user = currentUser ?: users.values.find { it.id == userId }

                if (user == null) {
                        return NetworkResult.Error("Пользователь не найден")
                }

                firstname?.let { user.firstname = it }
                lastname?.let { user.lastname = it }
                secondname?.let { user.secondname = it }
                datebirthday?.let { user.datebirthday = it }
                gender?.let { user.gender = it }

                users[user.email] = user

                return NetworkResult.Success(
                        User(
                                id = user.id,
                                collectionId = "users_collection",
                                collectionName = "users",
                                created = "2023-10-27 10:00:00.000Z",
                                updated = "2023-10-27 10:00:00.000Z",
                                emailVisibility = true,
                                firstname = user.firstname,
                                lastname = user.lastname,
                                secondname = user.secondname,
                                verified = true,
                                datebirthday = user.datebirthday,
                                gender = user.gender
                        )
                )
        }

        override suspend fun logout(): NetworkResult<Unit> {
                currentUser = null
                return NetworkResult.Success(Unit)
        }
}
```

## File: app/src/main/java/com/example/lol/Profile/MyOrdersScreen.kt
```kotlin
package com.example.lol.Profile

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.HorizontalDivider
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.*

@Composable
fun MyOrdersScreen(navController: NavController, viewModel: OrdersViewModel) {
        val orders by viewModel.orders.collectAsState()

        Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
                // Header
                Box(
                        modifier =
                                Modifier.fillMaxWidth()
                                        .padding(
                                                top = 52.dp,
                                                bottom = 12.dp,
                                                start = 20.dp,
                                                end = 20.dp
                                        )
                ) {
                        IconButton(
                                onClick = {
                                        if (!navController.popBackStack()) {
                                                navController.navigate("Profile") {
                                                        popUpTo(
                                                                navController
                                                                        .graph
                                                                        .startDestinationId
                                                        ) { inclusive = true }
                                                }
                                        }
                                },
                                modifier =
                                        Modifier.align(Alignment.CenterStart)
                                                .size(32.dp)
                                                .background(
                                                        Color(0xFFF5F5F9),
                                                        RoundedCornerShape(8.dp)
                                                )
                        ) {
                                Icon(
                                        painter =
                                                painterResource(id = R.drawable.icon_chevron_left),
                                        contentDescription = "Back",
                                        tint = Color.Black,
                                        modifier = Modifier.size(24.dp)
                                )
                        }
                        Text(
                                text = "Мои заказы",
                                style = Title2Semibold,
                                modifier = Modifier.align(Alignment.Center),
                                color = Color.Black
                        )
                }

                HorizontalDivider(color = Color(0xFFF4F4F4), thickness = 1.dp)

                if (orders.isEmpty()) {
                        Box(
                                modifier = Modifier.fillMaxSize(),
                                contentAlignment = Alignment.Center
                        ) { Text("У вас нет заказов", style = Title3Semibold, color = Color.Gray) }
                } else {
                        LazyColumn(
                                contentPadding = PaddingValues(20.dp),
                                verticalArrangement = Arrangement.spacedBy(16.dp)
                        ) {
                                items(orders) { order ->
                                        OrderCard(
                                                order = order,
                                                onClick = {
                                                        navController.navigate(
                                                                "OrderDetails/${order.id}"
                                                        )
                                                }
                                        )
                                }
                        }
                }
        }
}

@Composable
fun OrderCard(order: Order, onClick: () -> Unit) {
        Box(
                modifier =
                        Modifier.fillMaxWidth()
                                .clickable(onClick = onClick)
                                .background(Color(0xFFF5F5F9), RoundedCornerShape(12.dp))
                                .padding(16.dp)
        ) {
                Column {
                        Row(
                                modifier = Modifier.fillMaxWidth(),
                                horizontalArrangement = Arrangement.SpaceBetween
                        ) {
                                Text(
                                        text = "Заказ №${order.id}",
                                        style = Title3Semibold,
                                        color = Color.Black
                                )
                                Text(
                                        text = order.totalPrice,
                                        style = Title3Semibold,
                                        color = AccentBlue
                                )
                        }
                        Spacer(modifier = Modifier.height(8.dp))
                        Row(
                                modifier = Modifier.fillMaxWidth(),
                                horizontalArrangement = Arrangement.SpaceBetween
                        ) {
                                Text(
                                        text = order.date,
                                        style = CaptionRegular,
                                        color = Color(0xFF939396)
                                )
                                Text(
                                        text = order.status,
                                        style = CaptionRegular,
                                        color =
                                                if (order.status == "Отменен") Color.Red
                                                else if (order.status == "В обработке")
                                                        Color(0xFFFFA500)
                                                else Color(0xFF00BFA5)
                                )
                        }
                }
        }
}
```

## File: app/src/main/java/com/example/lol/Projects/ProjectsViewModel.kt
```kotlin
package com.example.lol.Projects

import android.app.Application
import android.content.Context
import androidx.lifecycle.AndroidViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.TokenManager
import com.example.lol.data.network.models.ProjectApi
import com.example.lol.data.repository.IProjectRepository
import com.google.gson.Gson
import com.google.gson.reflect.TypeToken
import java.io.File
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch

/** Состояние загрузки проектов. */
sealed class ProjectsState {
    object Idle : ProjectsState()
    object Loading : ProjectsState()
    object Success : ProjectsState()
    data class Error(val message: String) : ProjectsState()
}

/**
 * ViewModel для управления проектами. Использует IProjectRepository для сетевых запросов с fallback
 * на SharedPreferences.
 */
class ProjectsViewModel(
        application: Application,
        private val projectRepository: IProjectRepository? = null,
        private val tokenManager: TokenManager? = null
) : AndroidViewModel(application) {

    private val sharedPrefs =
            application.getSharedPreferences("projects_prefs", Context.MODE_PRIVATE)
    private val gson = Gson()

    private val _projects = MutableStateFlow<List<Project>>(emptyList())
    val projects: StateFlow<List<Project>> = _projects.asStateFlow()

    private val _projectsState = MutableStateFlow<ProjectsState>(ProjectsState.Idle)
    val projectsState: StateFlow<ProjectsState> = _projectsState.asStateFlow()

    init {
        loadProjects()
    }

    /** Загрузка проектов: сначала API, затем fallback на локальное хранилище. */
    fun loadProjects() {
        viewModelScope.launch {
            _projectsState.value = ProjectsState.Loading

            val repo = projectRepository
            if (repo != null) {
                when (val result = repo.getProjects()) {
                    is NetworkResult.Success -> {
                        // Конвертируем ProjectApi в локальные Project
                        val apiProjects = result.data.map { it.toLocalProject() }
                        _projects.value = apiProjects.sortedByDescending { it.createdAt }
                        // Сохраняем в кэш
                        saveProjectsToCache()
                        _projectsState.value = ProjectsState.Success
                    }
                    is NetworkResult.Error -> {
                        // Fallback на локальное хранилище
                        loadProjectsFromCache()
                        _projectsState.value = ProjectsState.Error(result.message)
                    }
                    is NetworkResult.Loading -> {}
                }
            } else {
                // Нет репозитория - используем только локальное хранилище
                loadProjectsFromCache()
                _projectsState.value = ProjectsState.Success
            }
        }
    }

    /** Загрузка проектов из SharedPreferences (кэш/offline). */
    private fun loadProjectsFromCache() {
        val json = sharedPrefs.getString("projects", null)
        if (json != null) {
            val type = object : TypeToken<List<Project>>() {}.type
            val loadedProjects: List<Project> = gson.fromJson(json, type)
            _projects.value = loadedProjects.sortedByDescending { it.createdAt }
        }
    }

    /** Сохранение проектов в SharedPreferences. */
    private fun saveProjectsToCache() {
        val json = gson.toJson(_projects.value)
        sharedPrefs.edit().putString("projects", json).apply()
    }

    /** Добавление нового проекта. Синхронизирует с API если доступен. */
    fun addProject(project: Project, imageFile: File? = null) {
        viewModelScope.launch {
            _projectsState.value = ProjectsState.Loading

            // Добавляем локально сразу
            val updatedList = _projects.value.toMutableList()
            updatedList.add(0, project)
            _projects.value = updatedList
            saveProjectsToCache()

            // Синхронизация с API
            val repo = projectRepository
            val userId = tokenManager?.getUserId()

            if (repo != null && userId != null) {
                when (val result =
                                repo.createProject(
                                        title = project.name,
                                        typeProject = project.type,
                                        userId = userId,
                                        dateStart = project.startDate,
                                        dateEnd = project.endDate,
                                        gender = project.recipient,
                                        descriptionSource = project.descriptionSource,
                                        category = project.category,
                                        image = imageFile
                                )
                ) {
                    is NetworkResult.Success -> {
                        // Обновляем локальный проект с данными от сервера
                        _projects.value =
                                _projects.value.map {
                                    if (it.id == project.id) {
                                        it.copy(id = result.data.id)
                                    } else {
                                        it
                                    }
                                }
                        saveProjectsToCache()
                        _projectsState.value = ProjectsState.Success
                    }
                    is NetworkResult.Error -> {
                        // Проект уже добавлен локально, показываем ошибку
                        _projectsState.value = ProjectsState.Error(result.message)
                    }
                    is NetworkResult.Loading -> {}
                }
            } else {
                _projectsState.value = ProjectsState.Success
            }
        }
    }

    /** Удаление проекта по ID. */
    fun removeProject(projectId: String) {
        _projects.value = _projects.value.filter { it.id != projectId }
        saveProjectsToCache()
    }

    /** Получение проекта по ID. */
    fun getProjectById(projectId: String): Project? {
        return _projects.value.find { it.id == projectId }
    }

    /** Получение относительного времени для отображения. */
    fun getRelativeTime(createdAt: Long): String {
        val now = System.currentTimeMillis()
        val diff = now - createdAt

        val seconds = diff / 1000
        val minutes = seconds / 60
        val hours = minutes / 60
        val days = hours / 24

        return when {
            days > 1 -> "Прошло $days дня"
            days == 1L -> "Вчера"
            hours > 1 -> "Прошло $hours часов"
            hours == 1L -> "Прошел 1 час"
            minutes > 1 -> "Прошло $minutes минут"
            else -> "Только что"
        }
    }

    /** Получение уникальных категорий из products.json asset. */
    fun getCategories(): List<String> {
        return try {
            val json =
                    getApplication<Application>()
                            .assets
                            .open("products.json")
                            .bufferedReader()
                            .use { it.readText() }
            val type = object : TypeToken<List<Map<String, Any>>>() {}.type
            val products: List<Map<String, Any>> = gson.fromJson(json, type)
            products.mapNotNull { it["category"] as? String }.distinct()
        } catch (e: Exception) {
            listOf("Популярные", "Новинки", "Мужское", "Женское", "Аксессуары")
        }
    }

    /** Сброс состояния ошибки. */
    fun resetState() {
        _projectsState.value = ProjectsState.Idle
    }

    /** Конвертация ProjectApi в локальный Project. */
    private fun ProjectApi.toLocalProject(): Project {
        return Project(
                id = this.id,
                name = this.title,
                type = "", // typeProject не возвращается в ответе
                startDate = this.dateStart,
                endDate = this.dateEnd,
                recipient = this.gender,
                descriptionSource = this.descriptionSource,
                category = this.category,
                imageUri =
                        if (this.image.isNotEmpty()) {
                            "https://dsn-vypryamitel.ru/api/files/${this.collectionId}/${this.id}/${this.image}"
                        } else null,
                createdAt = parseDate(this.created)
        )
    }

    /** Парсинг даты из строки API. */
    private fun parseDate(dateString: String): Long {
        return try {
            java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss", java.util.Locale.getDefault())
                    .parse(dateString)
                    ?.time
                    ?: System.currentTimeMillis()
        } catch (e: Exception) {
            System.currentTimeMillis()
        }
    }
}

/** Factory для создания ProjectsViewModel с зависимостями. */
class ProjectsViewModelFactory(
        private val application: Application,
        private val projectRepository: IProjectRepository? = null,
        private val tokenManager: TokenManager? = null
) : ViewModelProvider.Factory {
    @Suppress("UNCHECKED_CAST")
    override fun <T : androidx.lifecycle.ViewModel> create(modelClass: Class<T>): T {
        return ProjectsViewModel(application, projectRepository, tokenManager) as T
    }
}
```

## File: app/src/main/java/com/example/lol/storybook/StorybookScreen.kt
```kotlin
package com.example.lol.storybook

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lol.R
import com.example.lol.components.*
import com.example.lol.data.Product
import com.example.lol.ui.theme.*

@Composable
fun StorybookScreen() {
    LazyColumn(
            modifier = Modifier.fillMaxSize().background(Color.White).padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(24.dp)
    ) {
        item { Text("Storybook", style = Title1ExtraBold) }

        // --- Colors ---
        item {
            SectionTitle("Colors")
            ColorPalette()
        }

        // --- Typography ---
        item {
            SectionTitle("Typography")
            Text("Title1ExtraBold", style = Title1ExtraBold)
            Text("Title1Semibold", style = Title1Semibold)
            Text("Title2Bold", style = Title2Bold)
            Text("Title3Semibold", style = Title3Semibold)
            Text("HeadlineMedium", style = HeadlineMedium)
            Text("TextMedium", style = TextMedium)
            Text("TextRegular", style = TextRegular)
            Text("CaptionRegular", style = CaptionRegular)
        }

        // --- Buttons ---
        item {
            SectionTitle("Buttons")
            Button(onClick = {}, modifier = Modifier.fillMaxWidth()) { Text("Primary Button") }
            Spacer(modifier = Modifier.height(8.dp))
            Button(onClick = {}, modifier = Modifier.fillMaxWidth(), enabled = false) {
                Text("Disabled Button")
            }
            Spacer(modifier = Modifier.height(8.dp))
            OutlinedButton(onClick = {}, modifier = Modifier.fillMaxWidth()) {
                Text("Outlined Button")
            }
        }

        // --- Text Fields ---
        item {
            SectionTitle("Text Fields")
            var text by remember { mutableStateOf("") }
            AppTextField(
                    value = text,
                    onValueChange = { text = it },
                    label = "Label",
                    placeholder = "Placeholder"
            )
            Spacer(modifier = Modifier.height(8.dp))
            AppTextField(
                    value = "Error Value",
                    onValueChange = {},
                    label = "Error State",
                    isError = true,
                    errorMessage = "This is an error"
            )
        }

        // --- Select Field ---
        item {
            SectionTitle("Select Field")
            var selectedOption by remember { mutableStateOf("") }
            var selectedWithoutIcon by remember { mutableStateOf("") }

            AppSelectField(
                    value = selectedOption,
                    label = "Выберите пол",
                    placeholder = "Пол",
                    options = listOf("👨 Мужской", "👩 Женский"),
                    onOptionSelected = { selectedOption = it }
            )

            Spacer(modifier = Modifier.height(8.dp))

            AppSelectField(
                    value = selectedWithoutIcon,
                    label = "Select без иконки",
                    placeholder = "Выберите опцию",
                    options = listOf("🔥 Горячее", "✨ Новое", "✅ Подтверждено"),
                    onOptionSelected = { selectedWithoutIcon = it },
                    showChevron = false
            )
        }

        // --- Chips ---
        item {
            SectionTitle("Chips ON/OFF")
            var chipState by remember { mutableStateOf(true) }

            Row(horizontalArrangement = Arrangement.spacedBy(12.dp)) {
                AppChip(
                        text = "Активный",
                        isSelected = chipState,
                        onClick = { chipState = !chipState }
                )
                AppChip(
                        text = "Неактивный",
                        isSelected = !chipState,
                        onClick = { chipState = !chipState }
                )
            }
        }

        // --- Icons ---
        item {
            SectionTitle("Icons")
            IconGrid()
        }

        // --- Search Bar ---
        item {
            SectionTitle("Search Bar")
            var searchQuery by remember { mutableStateOf("") }
            SearchBar(
                    value = searchQuery,
                    onValueChange = { searchQuery = it },
                    placeholder = "Искать в каталоге"
            )
        }

        // --- App Header ---
        item {
            SectionTitle("App Header")
            Text("Title only:", style = CaptionRegular)
            AppHeader(title = "Каталог")

            Spacer(modifier = Modifier.height(8.dp))
            Text("Back button and Title:", style = CaptionRegular)
            AppHeader(title = "Профиль", showBackButton = true)

            Spacer(modifier = Modifier.height(8.dp))
            Text("With Trailing Icon (Profile):", style = CaptionRegular)
            AppHeader(
                    title = "Главная",
                    trailingIcon = {
                        Box(
                                modifier =
                                        Modifier.size(32.dp).background(Color.Black, CircleShape),
                                contentAlignment = Alignment.Center
                        ) {
                            Icon(
                                    painter = painterResource(id = R.drawable.polzovatel_3),
                                    contentDescription = null,
                                    tint = Color.White,
                                    modifier = Modifier.size(20.dp)
                            )
                        }
                    }
            )
        }

        // --- Bottom Sheet ---
        item {
            SectionTitle("Bottom Sheet")
            var showGenderSheet by remember { mutableStateOf(false) }
            var showPhotoSheet by remember { mutableStateOf(false) }

            Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
                Button(onClick = { showGenderSheet = true }, modifier = Modifier.weight(1f)) {
                    Text("Gender Sheet")
                }
                Button(onClick = { showPhotoSheet = true }, modifier = Modifier.weight(1f)) {
                    Text("Photo Sheet")
                }
            }

            if (showGenderSheet) {
                GenderSelectionSheet(
                        onDismiss = { showGenderSheet = false },
                        onGenderSelected = { showGenderSheet = false }
                )
            }

            if (showPhotoSheet) {
                PhotoPickerBottomSheet(
                        onDismiss = { showPhotoSheet = false },
                        onCameraClick = { showPhotoSheet = false },
                        onGalleryClick = { showPhotoSheet = false }
                )
            }
        }

        // --- Product Card ---
        item {
            SectionTitle("Product Card")
            val sampleProduct =
                    Product(
                            id = 1,
                            title = "Nike Air Max 270",
                            description = "Great sneakers",
                            price = 12990,
                            category = "Sneakers",
                            imageUrl = "https://example.com/image.png"
                    )

            Text("Not in Cart:", style = CaptionRegular)
            Spacer(modifier = Modifier.height(4.dp))
            ProductCard(
                    product = sampleProduct,
                    onClick = {},
                    onAddToCart = {},
                    onRemoveFromCart = {},
                    isInCart = false
            )

            Spacer(modifier = Modifier.height(16.dp))
            Text("In Cart:", style = CaptionRegular)
            Spacer(modifier = Modifier.height(4.dp))
            ProductCard(
                    product = sampleProduct,
                    onClick = {},
                    onAddToCart = {},
                    onRemoveFromCart = {},
                    isInCart = true
            )
        }

        // --- Error Notification ---
        item {
            SectionTitle("Error Notification")
            var errorMessage by remember { mutableStateOf<String?>(null) }

            Button(onClick = { errorMessage = "Произошла ошибка загрузки" }) {
                Text("Показать ошибку")
            }

            // Note: ErrorNotification uses absolute positioning/overlay,
            // so it might appear at the top of the screen, not inline.
            ErrorNotification(message = errorMessage, onDismiss = { errorMessage = null })
        }

        // --- TabBar ---
        item {
            SectionTitle("TabBar (Preview)")
            StorybookBottomBar()
        }

        // Add some bottom padding
        item { Spacer(modifier = Modifier.height(48.dp)) }
    }
}

@Composable
fun SectionTitle(title: String) {
    Text(text = title, style = Title2Bold, modifier = Modifier.padding(bottom = 8.dp, top = 8.dp))
    HorizontalDivider(color = InputStroke)
}

@Composable
fun ColorPalette() {
    val colors =
            listOf(
                    "AccentColor" to AccentColor,
                    "AccentBlue" to AccentBlue,
                    "AccentBlueInactive" to AccentBlueInactive,
                    "TextBlack" to TextBlack,
                    "TextGray" to TextGray,
                    "TextHint" to TextHint,
                    "InputBg" to InputBg,
                    "InputStroke" to InputStroke,
                    "RedError" to RedError,
                    "ChipInactiveBg" to ChipInactiveBg
            )

    Column {
        colors.chunked(2).forEach { rowColors ->
            Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.spacedBy(8.dp)
            ) {
                rowColors.forEach { (name, color) -> ColorItem(name, color, Modifier.weight(1f)) }
                if (rowColors.size == 1) {
                    Spacer(modifier = Modifier.weight(1f))
                }
            }
            Spacer(modifier = Modifier.height(8.dp))
        }
    }
}

@Composable
fun ColorItem(name: String, color: Color, modifier: Modifier = Modifier) {
    Row(
            modifier =
                    modifier.background(Color.White, RoundedCornerShape(8.dp))
                            .border(1.dp, InputStroke, RoundedCornerShape(8.dp))
                            .padding(8.dp),
            verticalAlignment = Alignment.CenterVertically
    ) {
        Box(
                modifier =
                        Modifier.size(40.dp)
                                .background(color, RoundedCornerShape(8.dp))
                                .border(1.dp, Color.LightGray, RoundedCornerShape(8.dp))
        )
        Spacer(modifier = Modifier.width(8.dp))
        Text(text = name, style = CaptionRegular, fontSize = 12.sp)
    }
}

@Composable
fun IconGrid() {
    val icons =
            listOf(
                    R.drawable.icon_search,
                    R.drawable.icon_close,
                    R.drawable.icon_plus,
                    R.drawable.icon_minus,
                    R.drawable.icon_check,
                    R.drawable.icon_filter,
                    R.drawable.icon_shopping_cart,
                    R.drawable.icon_chevron_down,
                    R.drawable.icon_chevron_left
            )

    // Simple Grid workaround since LazyVerticalGrid cannot be nested inside LazyColumn easily
    // without fixed height
    // Using FlowRow-like layout with Columns

    Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(16.dp)) {
        icons.take(5).forEach { iconId -> IconItem(iconId) }
    }
    Spacer(modifier = Modifier.height(16.dp))
    Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(16.dp)) {
        icons.drop(5).forEach { iconId -> IconItem(iconId) }
    }
}

@Composable
fun IconItem(iconId: Int) {
    Box(
            modifier = Modifier.size(48.dp).background(InputBg, RoundedCornerShape(8.dp)),
            contentAlignment = Alignment.Center
    ) {
        Icon(
                painter = painterResource(id = iconId),
                contentDescription = null,
                tint = Color.Black,
                modifier = Modifier.size(24.dp)
        )
    }
}

@Composable
fun StorybookBottomBar() {
    val items =
            listOf(
                    AppTabBarItem("Main", "Главная", R.drawable.analizy),
                    AppTabBarItem("Catalogue", "Каталог", R.drawable.rezultaty),
                    AppTabBarItem("Projects", "Проекты", R.drawable.podderzhka),
                    AppTabBarItem("Profile", "Профиль", R.drawable.polzovatel)
            )
    var selectedRoute by remember { mutableStateOf("Main") }

    AppTabBar(
            items = items,
            selectedRoute = selectedRoute,
            onItemSelected = { selectedRoute = it },
            modifier =
                    Modifier.height(88.dp)
                            .border(1.dp, Color(0xFFF4F4F4))
    )
}
```

## File: app/src/test/java/com/example/lol/data/repository/CartRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/** Unit-тесты для CartRepository с использованием MockWebServer. */
class CartRepositoryTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: CartRepository

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        repository = CartRepository(api)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `addToCart success returns cart item`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.cartItemJson)
        )

        // When
        val result = repository.addToCart(userId = "user123", productId = "prod1", count = 2)

        // Then
        assertTrue(result.isSuccess)
        val cartItem = result.getOrNull()
        assertNotNull(cartItem)
        assertEquals("cart1", cartItem?.id)
        assertEquals("prod1", cartItem?.productId)
        assertEquals(2, cartItem?.count)
    }

    @Test
    fun `addToCart failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.addToCart(userId = "user123", productId = "invalid", count = 1)

        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }

    @Test
    fun `updateCartItem network error returns error`() = runTest {
        // Given - shutdown server to simulate network error
        mockWebServer.shutdown()

        // When
        val result =
                repository.updateCartItem(
                        cartItemId = "cart1",
                        userId = "user123",
                        productId = "prod1",
                        count = 5
                )

        // Then
        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }
}
```

## File: app/src/test/java/com/example/lol/data/repository/ProductRepositoryApiTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/** Unit-тесты для ProductRepositoryApi с использованием MockWebServer. */
class ProductRepositoryApiTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: ProductRepositoryApi

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        repository = ProductRepositoryApi(api)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `getProducts success returns product list`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productsListJson)
        )

        // When
        val result = repository.getProducts()

        // Then
        assertTrue(result.isSuccess)
        val products = result.getOrNull()
        assertNotNull(products)
        assertEquals(2, products?.size)
        assertEquals("Футболка", products?.first()?.title)
        assertEquals(1500, products?.first()?.price)
    }

    @Test
    fun `getProductById success returns product details`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productDetailJson)
        )

        // When
        val result = repository.getProductById("prod1")

        // Then
        assertTrue(result.isSuccess)
        val product = result.getOrNull()
        assertNotNull(product)
        assertEquals("prod1", product?.id)
        assertEquals("Футболка", product?.title)
        assertEquals("Хлопковая футболка", product?.description)
    }

    @Test
    fun `searchProducts sends correct filter parameter`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.productsListJson)
        )

        // When
        val result = repository.searchProducts("Футболка")

        // Then
        assertTrue(result.isSuccess)

        // Verify the request was made with correct filter
        val request = mockWebServer.takeRequest()
        assertTrue(request.path?.contains("filter") == true)
    }

    @Test
    fun `getProducts failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.getProducts()

        // Then
        assertTrue(result.isError)
        assertNotNull(result.errorMessageOrNull())
    }
}
```

## File: app/src/main/java/com/example/lol/authorization/SplashScreen.kt
```kotlin
package com.example.lol.authorization

import androidx.compose.foundation.Image
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.remember
import androidx.compose.ui.Modifier
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.navigation.NavController
import com.example.lol.R
import kotlinx.coroutines.delay

@Composable
fun SplashScreen(navController: NavController) {
    val context = LocalContext.current
    val sessionManager = remember { SessionManager(context) }

    LaunchedEffect(Unit) {
        delay(2500) // 2.5 seconds
        if (sessionManager.isLoggedIn()) {
            if (sessionManager.getPin() != null) {
                navController.navigate("PinCode") {
                    popUpTo("Splash") { inclusive = true }
                }
            } else {
                navController.navigate("CreatePin") {
                    popUpTo("Splash") { inclusive = true }
                }
            }
        } else {
            navController.navigate("SignIn") {
                popUpTo("Splash") { inclusive = true }
            }
        }
    }

    Box(
        modifier = Modifier
            .fillMaxSize()
    ) {
        Image(
            painter = painterResource(id = R.drawable.splash_bg),
            contentDescription = null,
            modifier = Modifier.fillMaxSize(),
            contentScale = ContentScale.FillBounds
        )
    }
}
```

## File: app/src/main/java/com/example/lol/data/ProductRepository.kt
```kotlin
package com.example.lol.data

import android.content.Context
import com.example.lol.data.cache.ProductCache
import com.example.lol.data.repository.IProductRepository
import org.json.JSONArray
import java.io.IOException

class ProductRepository(private val context: Context) : IProductRepository {
    private val cache = ProductCache(context)

    override fun getProducts(): List<Product> {
        val cached = cache.getProducts()

        val jsonString: String
        try {
            jsonString = context.assets.open("products.json").bufferedReader().use { it.readText() }
        } catch (ioException: IOException) {
            ioException.printStackTrace()
            return cached ?: emptyList()
        }

        val products = mutableListOf<Product>()
        try {
            val jsonArray = JSONArray(jsonString)
            for (i in 0 until jsonArray.length()) {
                val jsonObject = jsonArray.getJSONObject(i)
                val id = jsonObject.getInt("id")
                val title = jsonObject.getString("title")
                val description = jsonObject.getString("description")
                val price = jsonObject.getInt("price")
                val category = jsonObject.getString("category")
                val imageUrl = jsonObject.getString("imageUrl")
                
                products.add(Product(id, title, description, price, category, imageUrl))
            }
            cache.saveProducts(products)
        } catch (e: Exception) {
            e.printStackTrace()
            return cached ?: emptyList() 
        }
        return products
    }

    override fun getProductById(id: Int): Product? {
        return getProducts().find { it.id == id }
    }
    
    override fun searchProducts(query: String): List<Product> {
        return getProducts().filter { 
            it.title.contains(query, ignoreCase = true) || it.description.contains(query, ignoreCase = true) 
        }
    }
}
```

## File: app/src/main/java/com/example/lol/Projects/ProjectDetailsScreen.kt
```kotlin
package com.example.lol.Projects

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.HorizontalDivider
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import coil.compose.AsyncImage
import com.example.lol.R
import com.example.lol.ui.theme.*

@Composable
fun ProjectDetailsScreen(
        navController: NavController,
        viewModel: ProjectsViewModel,
        projectId: String
) {
        val projects by viewModel.projects.collectAsState()
        val project = projects.find { it.id == projectId }

        if (project == null) {
                Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
                        Text("Проект не найден", style = Title3Semibold, color = Color.Gray)
                }
                return
        }

        Column(
                modifier =
                        Modifier.fillMaxSize()
                                .background(Color.White)
                                .verticalScroll(rememberScrollState())
        ) {
                Box(
                        modifier =
                                Modifier.fillMaxWidth()
                                        .padding(
                                                top = 52.dp,
                                                bottom = 12.dp,
                                                start = 20.dp,
                                                end = 20.dp
                                        )
                ) {
                        IconButton(
                                onClick = { navController.popBackStack() },
                                modifier =
                                        Modifier.align(Alignment.CenterStart)
                                                .size(32.dp)
                                                .background(
                                                        Color(0xFFF5F5F9),
                                                        RoundedCornerShape(8.dp)
                                                )
                        ) {
                                Icon(
                                        painter =
                                                painterResource(id = R.drawable.icon_chevron_left),
                                        contentDescription = "Back",
                                        tint = Color.Black,
                                        modifier = Modifier.size(24.dp)
                                )
                        }
                        Text(
                                text = project.name,
                                style = Title2Semibold,
                                modifier = Modifier.align(Alignment.Center),
                                color = Color.Black
                        )
                        IconButton(
                                onClick = {
                                        viewModel.removeProject(project.id)
                                        navController.popBackStack()
                                },
                                modifier = Modifier.align(Alignment.CenterEnd).size(32.dp)
                        ) {
                                Icon(
                                        painter = painterResource(id = R.drawable.icon_delete),
                                        contentDescription = "Delete",
                                        tint = Color.Red,
                                        modifier = Modifier.size(24.dp)
                                )
                        }
                }

                HorizontalDivider(color = Color(0xFFF5F5F9), thickness = 1.dp)

                Column(modifier = Modifier.padding(20.dp)) {
                        if (project.imageUri != null) {
                                AsyncImage(
                                        model = project.imageUri,
                                        contentDescription = "Project Image",
                                        modifier =
                                                Modifier.fillMaxWidth()
                                                        .height(200.dp)
                                                        .clip(RoundedCornerShape(12.dp))
                                                        .background(Color(0xFFF5F5F9)),
                                        contentScale = ContentScale.Crop
                                )
                                Spacer(modifier = Modifier.height(24.dp))
                        } else {
                                Box(
                                        modifier =
                                                Modifier.fillMaxWidth()
                                                        .height(200.dp)
                                                        .clip(RoundedCornerShape(12.dp))
                                                        .background(Color(0xFFF5F5F9)),
                                        contentAlignment = Alignment.Center
                                ) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id = R.drawable.icon_file_text
                                                        ),
                                                contentDescription = null,
                                                tint = Color(0xFFBFC7D1),
                                                modifier = Modifier.size(48.dp)
                                        )
                                }
                                Spacer(modifier = Modifier.height(24.dp))
                        }

                        Text(text = "Информация", style = Title3Semibold, color = Color.Black)
                        Spacer(modifier = Modifier.height(16.dp))

                        InfoRow(
                                label = "Категория",
                                value = project.category.ifEmpty { "Не указана" }
                        )
                        InfoRow(
                                label = "Дата начала",
                                value = project.startDate.ifEmpty { "Не указана" }
                        )
                        InfoRow(
                                label = "Дата окончания",
                                value = project.endDate.ifEmpty { "Не указана" }
                        )
                        InfoRow(
                                label = "Получатель",
                                value = project.recipient.ifEmpty { "Не указан" }
                        )

                        Spacer(modifier = Modifier.height(32.dp))

                        Text(text = "Описание", style = Title3Semibold, color = Color.Black)
                        Spacer(modifier = Modifier.height(12.dp))
                        Text(
                                text = project.descriptionSource.ifEmpty { "Нет описания" },
                                style = TextRegular,
                                color = Color(0xFF939396)
                        )

                        Spacer(modifier = Modifier.height(32.dp))

                        Text(text = "Результаты", style = Title3Semibold, color = Color.Black)
                        Spacer(modifier = Modifier.height(12.dp))
                        Box(
                                modifier =
                                        Modifier.fillMaxWidth()
                                                .height(100.dp)
                                                .background(
                                                        Color(0xFFF5F5F9),
                                                        RoundedCornerShape(12.dp)
                                                ),
                                contentAlignment = Alignment.Center
                        ) {
                                Text(
                                        text = "Здесь будут результаты проекта",
                                        style = CaptionRegular,
                                        color = Color(0xFF939396)
                                )
                        }
                }
        }
}

@Composable
fun InfoRow(label: String, value: String) {
        Row(
                modifier = Modifier.fillMaxWidth().padding(vertical = 8.dp),
                horizontalArrangement = Arrangement.SpaceBetween
        ) {
                Text(text = label, style = TextRegular, color = Color(0xFF939396))
                Text(text = value, style = TextMedium, color = Color.Black)
        }
}
```

## File: app/src/main/java/com/example/lol/Projects/ProjectsScreen.kt
```kotlin
package com.example.lol.Projects

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.CaptionSemibold
import com.example.lol.ui.theme.Title2Semibold
import com.example.lol.ui.theme.Title3Semibold

@Composable
fun ProjectsScreen(navController: NavController, viewModel: ProjectsViewModel) {
    val projects by viewModel.projects.collectAsState()

    Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
        // Header Section
        Box(
                modifier =
                        Modifier.fillMaxWidth()
                                .padding(top = 52.dp, bottom = 12.dp, start = 20.dp, end = 20.dp)
        ) {
            Text(
                    text = "Проекты",
                    style = Title2Semibold,
                    modifier = Modifier.align(Alignment.Center),
                    color = Color.Black
            )
            IconButton(
                    onClick = { navController.navigate("CreateProject") },
                    modifier = Modifier.align(Alignment.CenterEnd)
            ) {
                Icon(
                        painter = painterResource(id = R.drawable.icon_plus),
                        contentDescription = "Создать проект",
                        tint = Color(0xFFB8C1CC),
                        modifier = Modifier.size(24.dp)
                )
            }
        }

        Box(modifier = Modifier.fillMaxWidth().height(1.dp).background(Color(0xFFF4F4F4)))

        if (projects.isEmpty()) {
            // Empty state
            Box(
                    modifier = Modifier.fillMaxSize().padding(20.dp),
                    contentAlignment = Alignment.Center
            ) {
                Column(horizontalAlignment = Alignment.CenterHorizontally) {
                    Text(text = "Нет проектов", style = Title3Semibold, color = Color.Gray)
                    Spacer(modifier = Modifier.height(8.dp))
                    Text(
                            text = "Нажмите + чтобы создать первый проект",
                            style = CaptionRegular,
                            color = Color.Gray
                    )
                }
            }
        } else {
            // Projects List
            LazyColumn(
                    modifier = Modifier.weight(1f),
                    contentPadding = PaddingValues(horizontal = 20.dp, vertical = 24.dp),
                    verticalArrangement = Arrangement.spacedBy(16.dp)
            ) {
                items(projects) { project ->
                    val context = androidx.compose.ui.platform.LocalContext.current
                    ProjectCard(
                            title = project.name,
                            date = viewModel.getRelativeTime(project.createdAt),
                            onClick = { navController.navigate("ProjectDetails/${project.id}") }
                    )
                }
            }
        }
    }
}

@Composable
fun ProjectCard(title: String, date: String, onClick: () -> Unit) {
    Card(
            modifier = Modifier.fillMaxWidth().height(104.dp),
            shape = RoundedCornerShape(16.dp),
            colors = CardDefaults.cardColors(containerColor = Color.White),
            elevation = CardDefaults.cardElevation(defaultElevation = 8.dp) // Soft shadow
    ) {
        Row(
                modifier = Modifier.fillMaxSize().padding(16.dp),
                verticalAlignment = Alignment.CenterVertically
        ) {
            Column(modifier = Modifier.weight(1f)) {
                Text(text = title, style = Title3Semibold, color = Color.Black)
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                        text = date,
                        style = CaptionRegular,
                        color = Color(0xFF939396) // Caption gray
                )
            }

            Button(
                    onClick = onClick,
                    modifier = Modifier.width(114.dp).height(35.dp),
                    colors = ButtonDefaults.buttonColors(containerColor = AccentBlue),
                    shape = RoundedCornerShape(8.dp),
                    contentPadding = PaddingValues(0.dp)
            ) { Text("Открыть", style = CaptionSemibold, color = Color.White) }
        }
    }
}
```

## File: app/src/test/java/com/example/lol/data/repository/AuthRepositoryTest.kt
```kotlin
package com.example.lol.data.repository

import com.example.lol.data.network.api.MatuleApi
import com.example.lol.data.network.models.*
import com.example.lol.testdata.TestJsonResponses
import kotlinx.coroutines.test.runTest
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

/**
 * Unit-тесты для AuthRepository с использованием MockWebServer. Использует StubTokenManager для
 * изоляции от Android Context.
 */
class AuthRepositoryTest {

    private lateinit var mockWebServer: MockWebServer
    private lateinit var api: MatuleApi
    private lateinit var repository: AuthRepository
    private lateinit var stubTokenManager: StubTokenManager

    @Before
    fun setup() {
        mockWebServer = MockWebServer()
        mockWebServer.start()

        api =
                Retrofit.Builder()
                        .baseUrl(mockWebServer.url("/"))
                        .addConverterFactory(GsonConverterFactory.create())
                        .build()
                        .create(MatuleApi::class.java)

        stubTokenManager = StubTokenManager()
        repository = AuthRepository(api, stubTokenManager)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    @Test
    fun `login success returns token and user`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.successLoginJson)
        )

        // When
        val result = repository.login("test@test.ru", "password123")

        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test", data?.token)
        assertEquals("user123", data?.record?.id)
        assertEquals("Иван", data?.record?.firstname)

        // Verify token was saved
        assertEquals("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test", stubTokenManager.savedToken)
        assertEquals("user123", stubTokenManager.savedUserId)
    }

    @Test
    fun `login failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse()
                        .setResponseCode(400)
                        .setBody(TestJsonResponses.invalidCredentialsJson)
        )

        // When
        val result = repository.login("wrong@test.ru", "wrongpassword")

        // Then
        assertTrue(result.isError)
        assertEquals("Invalid credentials.", result.errorMessageOrNull())
    }

    @Test
    fun `register success returns user data`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.successRegisterJson)
        )

        // When
        val result = repository.register("new@test.ru", "password123")

        // Then
        assertTrue(result.isSuccess)
        val data = result.getOrNull()
        assertNotNull(data)
        assertEquals("user456", data?.id)
        assertFalse(data?.verified ?: true)
    }

    @Test
    fun `register failure returns error`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(400).setBody(TestJsonResponses.errorJson)
        )

        // When
        val result = repository.register("existing@test.ru", "password123")

        // Then
        assertTrue(result.isError)
        assertEquals("Failed to create record.", result.errorMessageOrNull())
    }

    @Test
    fun `updateUser success returns updated user`() = runTest {
        // Given
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.updatedUserJson)
        )
        stubTokenManager.savedUserId = "user123"

        // When
        val result = repository.updateUser(
                userId = "user123",
                firstname = "Петр",
                lastname = "Петров",
                secondname = "Петрович",
                datebirthday = "1995-05-15",
                gender = "Мужской"
        )

        // Then
        assertTrue(result.isSuccess)
        val user = result.getOrNull()
        assertNotNull(user)
        assertEquals("Петр", user?.firstname)
        assertEquals("Петров", user?.lastname)
    }

    @Test
    fun `logout success clears tokens`() = runTest {
        // Given
        stubTokenManager.savedToken = "test_token"
        stubTokenManager.savedUserId = "user123"
        
        // First response for getUsersAuth
        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.usersAuthJson)
        )
        // Second response for logout (delete token)
        mockWebServer.enqueue(
                MockResponse().setResponseCode(204)
        )

        // When
        val result = repository.logout()

        // Then
        assertTrue(result.isSuccess)
        assertNull(stubTokenManager.savedToken)
        assertNull(stubTokenManager.savedUserId)
    }

    @Test
    fun `logout when token missing still clears local auth`() = runTest {
        stubTokenManager.savedToken = "test_token"
        stubTokenManager.savedUserId = "unknown_user"

        mockWebServer.enqueue(
                MockResponse().setResponseCode(200).setBody(TestJsonResponses.usersAuthJson)
        )

        val result = repository.logout()

        assertTrue(result.isSuccess)
        assertNull(stubTokenManager.savedToken)
        assertNull(stubTokenManager.savedUserId)
    }
}

/** Stub реализация для тестов без Android Context. Имитирует поведение TokenManager в памяти. */
class StubTokenManager : com.example.lol.data.network.ITokenManager {
    var savedToken: String? = null
    var savedUserId: String? = null

    override fun saveToken(token: String) {
        savedToken = token
    }

    override fun getToken(): String? = savedToken

    override fun saveUserId(userId: String) {
        savedUserId = userId
    }

    override fun getUserId(): String? = savedUserId

    override fun hasToken(): Boolean = !savedToken.isNullOrBlank()

    override fun clearAuth() {
        savedToken = null
        savedUserId = null
    }
}
```

## File: app/src/test/java/com/example/lol/testdata/TestJsonResponses.kt
```kotlin
package com.example.lol.testdata

import com.example.lol.data.network.models.*

/** Тестовые данные и JSON ответы для unit-тестов. */
object TestJsonResponses {

    // ==================== AUTH ====================

    val successLoginJson =
            """
        {
            "record": {
                "id": "user123",
                "collectionId": "users",
                "collectionName": "_pb_users_auth_",
                "created": "2026-01-01T00:00:00Z",
                "updated": "2026-01-01T00:00:00Z",
                "emailVisibility": true,
                "firstname": "Иван",
                "lastname": "Иванов",
                "secondname": "Иванович",
                "verified": true,
                "datebirthday": "1990-01-01",
                "gender": "Мужской"
            },
            "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test"
        }
    """.trimIndent()

    val successRegisterJson =
            """
        {
            "id": "user456",
            "collectionId": "users",
            "collectionName": "_pb_users_auth_",
            "created": "2026-01-02T00:00:00Z",
            "updated": "2026-01-02T00:00:00Z",
            "emailVisibility": true,
            "firstname": "",
            "lastname": "",
            "secondname": "",
            "verified": false,
            "datebirthday": "",
            "gender": ""
        }
    """.trimIndent()

    val errorJson =
            """
        {
            "status": 400,
            "message": "Failed to create record.",
            "data": {}
        }
    """.trimIndent()

    val invalidCredentialsJson =
            """
        {
            "status": 400,
            "message": "Invalid credentials.",
            "data": {}
        }
    """.trimIndent()

    // ==================== PRODUCTS ====================

    val productsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 2,
            "items": [
                {
                    "id": "prod1",
                    "title": "Футболка",
                    "price": 1500,
                    "typeCloses": "Верх",
                    "type": "Новинки"
                },
                {
                    "id": "prod2",
                    "title": "Джинсы",
                    "price": 3000,
                    "typeCloses": "Низ",
                    "type": "Популярные"
                }
            ]
        }
    """.trimIndent()

    val productDetailJson =
            """
        {
            "id": "prod1",
            "collectionId": "products",
            "collectionName": "products",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "title": "Футболка",
            "description": "Хлопковая футболка",
            "price": 1500,
            "typeCloses": "Верх",
            "type": "Новинки",
            "approximateCost": "1500 ₽"
        }
    """.trimIndent()

    // ==================== CART ====================

    val cartItemJson =
            """
        {
            "id": "cart1",
            "collectionId": "cart",
            "collectionName": "cart",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "user_id": "user123",
            "product_id": "prod1",
            "count": 2
        }
    """.trimIndent()

    // ==================== PROJECTS ====================

    val projectsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "proj1",
                    "collectionId": "project",
                    "collectionName": "project",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z",
                    "title": "Мой проект",
                    "dateStart": "2026-01-01",
                    "dateEnd": "2026-12-31",
                    "gender": "Мужской",
                    "description_source": "Описание",
                    "category": "Популярные",
                    "image": "image.jpg",
                    "user_id": "user123"
                }
            ]
        }
    """.trimIndent()

    val createdProjectJson =
            """
        {
            "id": "proj2",
            "collectionId": "project",
            "collectionName": "project",
            "created": "2026-01-02T00:00:00Z",
            "updated": "2026-01-02T00:00:00Z",
            "title": "Новый проект",
            "dateStart": "2026-02-01",
            "dateEnd": "2026-06-30",
            "gender": "Женский",
            "description_source": "Новое описание",
            "category": "Новинки",
            "image": "",
            "user_id": "user123"
        }
    """.trimIndent()

    // ==================== ORDER ====================

    val orderJson =
            """
        {
            "id": "order1",
            "collectionId": "orders",
            "collectionName": "orders",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "user_id": "user123",
            "product_id": "prod1",
            "count": 3
        }
    """.trimIndent()

    // ==================== NEWS ====================

    val newsListJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "news1",
                    "collectionId": "news",
                    "collectionName": "news",
                    "newsImage": "promo.jpg",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z"
                }
            ]
        }
    """.trimIndent()

    // ==================== TEST DATA OBJECTS ====================

    fun createTestUser(
            id: String = "user123",
            firstname: String = "Иван",
            lastname: String = "Иванов"
    ) =
            User(
                    id = id,
                    collectionId = "users",
                    collectionName = "_pb_users_auth_",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    emailVisibility = true,
                    firstname = firstname,
                    lastname = lastname,
                    secondname = "Иванович",
                    verified = true,
                    datebirthday = "1990-01-01",
                    gender = "Мужской"
            )

    fun createTestProductItem(id: String = "prod1", title: String = "Футболка", price: Int = 1500) =
            ProductItem(
                    id = id,
                    title = title,
                    price = price,
                    typeCloses = "Верх",
                    type = "Новинки"
            )

    fun createTestProductApi(id: String = "prod1", title: String = "Футболка", price: Int = 1500) =
            ProductApi(
                    id = id,
                    collectionId = "products",
                    collectionName = "products",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    title = title,
                    description = "Описание товара",
                    price = price,
                    typeCloses = "Верх",
                    type = "Новинки",
                    approximateCost = "$price ₽"
            )

    fun createTestProjectApi(id: String = "proj1", title: String = "Мой проект") =
            ProjectApi(
                    id = id,
                    collectionId = "project",
                    collectionName = "project",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    title = title,
                    dateStart = "2026-01-01",
                    dateEnd = "2026-12-31",
                    gender = "Мужской",
                    descriptionSource = "Описание",
                    category = "Популярные",
                    image = "image.jpg",
                    userId = "user123"
            )

    fun createTestResponseCart(id: String = "cart1", productId: String = "prod1", count: Int = 1) =
            ResponseCart(
                    id = id,
                    collectionId = "cart",
                    collectionName = "cart",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    userId = "user123",
                    productId = productId,
                    count = count
            )

    fun createTestResponseOrder(
            id: String = "order1",
            productId: String = "prod1",
            count: Int = 1
    ) =
            ResponseOrder(
                    id = id,
                    collectionId = "orders",
                    collectionName = "orders",
                    created = "2026-01-01T00:00:00Z",
                    updated = "2026-01-01T00:00:00Z",
                    userId = "user123",
                    productId = productId,
                    count = count
            )

    fun createTestResponseAuth() = ResponseAuth(record = createTestUser(), token = "test_token_123")

    fun createTestResponseRegister() =
            ResponseRegister(
                    id = "user456",
                    collectionId = "users",
                    collectionName = "_pb_users_auth_",
                    created = "2026-01-02T00:00:00Z",
                    updated = "2026-01-02T00:00:00Z",
                    emailVisibility = true,
                    firstname = "",
                    lastname = "",
                    secondname = "",
                    verified = false,
                    datebirthday = "",
                    gender = ""
            )

    val updatedUserJson =
            """
        {
            "id": "user123",
            "collectionId": "users",
            "collectionName": "_pb_users_auth_",
            "created": "2026-01-01T00:00:00Z",
            "updated": "2026-01-01T00:00:00Z",
            "emailVisibility": true,
            "firstname": "Петр",
            "lastname": "Петров",
            "secondname": "Петрович",
            "verified": true,
            "datebirthday": "1995-05-15",
            "gender": "Мужской"
        }
    """.trimIndent()

    val usersAuthJson =
            """
        {
            "page": 1,
            "perPage": 30,
            "totalPages": 1,
            "totalItems": 1,
            "items": [
                {
                    "id": "token1",
                    "collectionId": "_authOrigins",
                    "collectionName": "_authOrigins",
                    "created": "2026-01-01T00:00:00Z",
                    "updated": "2026-01-01T00:00:00Z",
                    "collectionRef": "users",
                    "fingerprint": "fp_test",
                    "recordRef": "user123"
                }
            ]
        }
    """.trimIndent()
}
```

## File: build.gradle.kts
```kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.android.library) apply false
    alias(libs.plugins.kotlin.android) apply false
    alias(libs.plugins.kotlin.compose) apply false
    alias(libs.plugins.android.test) apply false
}
```

## File: app/src/main/AndroidManifest.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

    <application
        android:name=".MatuleApplication"
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.Lol"
        tools:targetApi="31">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="@string/app_name"
            android:theme="@style/Theme.Lol">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>


        <activity
            android:name=".storybook.StorybookActivity"
            android:exported="true"
            android:label="Storybook"
            android:theme="@style/Theme.Lol">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <provider
            android:name="androidx.startup.InitializationProvider"
            android:authorities="${applicationId}.androidx-startup"
            android:exported="false"
            tools:node="merge">
            <meta-data
                android:name="androidx.work.WorkManagerInitializer"
                android:value="androidx.startup"
                tools:node="remove" />
        </provider>

        <receiver
            android:name="androidx.profileinstaller.ProfileInstallReceiver"
            tools:node="merge"
            android:exported="true"
            android:permission="android.permission.DUMP">
            <intent-filter>
                <action android:name="androidx.profileinstaller.action.INSTALL_PROFILE" />
                <action android:name="androidx.profileinstaller.action.SKIP_FILE" />
                <action android:name="androidx.profileinstaller.action.SAVE_PROFILE" />
                <action android:name="androidx.profileinstaller.action.BENCHMARK_OPERATION" />
            </intent-filter>
        </receiver>
    </application>

</manifest>
```

## File: app/src/main/assets/products.json
```json
[
  {
    "id": 1,
    "title": "Шорты Вторник",
    "description": "Удобные и стильные шорты для повседневной носки. Идеально подходят для летней погоды.",
    "price": 4000,
    "category": "Популярные",
    "imageUrl": "placeholder_shorts"
  },
  {
    "id": 2,
    "title": "Рубашка Воскресенье",
    "description": "Классическая рубашка с современным кроем. Отличный выбор для офиса или прогулки.",
    "price": 8000,
    "category": "Новинки",
    "imageUrl": "placeholder_shirt"
  },
  {
    "id": 3,
    "title": "Футболка Понедельник",
    "description": "Базовая футболка из хлопка высокого качества. Мягкая и приятная к телу.",
    "price": 2500,
    "category": "Популярные",
    "imageUrl": "placeholder_tshirt"
  },
  {
    "id": 4,
    "title": "Брюки Среда",
    "description": "Элегантные брюки, которые подойдут как для деловой встречи, так и для вечернего выхода.",
    "price": 6000,
    "category": "Мужское",
    "imageUrl": "placeholder_pants"
  },
  {
    "id": 5,
    "title": "Платье Пятница",
    "description": "Легкое платье с цветочным принтом. Создает романтичное настроение.",
    "price": 9500,
    "category": "Женское",
    "imageUrl": "placeholder_dress"
  },
  {
    "id": 6,
    "title": "Кепка Суббота",
    "description": "Стильная кепка для защиты от солнца и завершения образа.",
    "price": 1500,
    "category": "Аксессуары",
    "imageUrl": "placeholder_cap"
  }
]
```

## File: app/src/main/java/com/example/lol/authorization/AuthViewModel.kt
```kotlin
package com.example.lol.authorization

import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.TokenManager
import com.example.lol.domain.usecase.auth.LoginUseCase
import com.example.lol.domain.usecase.auth.LogoutUseCase
import com.example.lol.domain.usecase.auth.RegisterUseCase
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.launch

/**
 * ViewModel для авторизации и регистрации пользователей. Использует UseCases для бизнес-логики и
 * SessionManager для локального кэша.
 */
class AuthViewModel(
        private val loginUseCase: LoginUseCase,
        private val registerUseCase: RegisterUseCase,
        private val logoutUseCase: LogoutUseCase,
        private val tokenManager: TokenManager,
        private val sessionManager: SessionManager
) : ViewModel() {

    private val _authState = MutableStateFlow<AuthState>(AuthState.Idle)
    val authState: StateFlow<AuthState> = _authState

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading

    /** Валидация email по паттерну name@domenname.ru (только строчные буквы и цифры). */
    fun isValidEmail(email: String): Boolean {
        return email.matches(Regex("^[a-z0-9]+@[a-z0-9]+\\.[a-z]+$"))
    }

    /**
     * Валидация пароля:
     * - Не менее 8 символов
     * - Заглавные и строчные буквы
     * - Цифры
     * - Спецсимволы
     */
    fun isValidPassword(password: String): Boolean {
        val hasLength = password.length >= 8
        val hasCase = password.any { it.isLowerCase() } && password.any { it.isUpperCase() }
        val hasDigit = password.any { it.isDigit() }
        val hasSpecial = password.any { !it.isLetterOrDigit() && !it.isWhitespace() }
        return hasLength && hasCase && hasDigit && hasSpecial
    }

    /** Проверка наличия пользователя в локальном кэше. */
    fun checkUserExists(email: String): Boolean {
        return sessionManager.isUserExists(email)
    }

    /**
     * Вход пользователя через API. При успехе токен сохраняется в TokenManager автоматически (через
     * Repository, вызываемый UseCase).
     */
    fun signIn(email: String, password: String) {
        viewModelScope.launch {
            _authState.value = AuthState.Loading
            _isLoading.value = true

            when (val result = loginUseCase(email, password)) {
                is NetworkResult.Success -> {
                    // Сохраняем данные в локальный кэш для совместимости
                    sessionManager.setCurrentEmail(email)
                    sessionManager.setLoggedIn(true)

                    // Сохраняем в SessionManager если пользователь новый
                    if (!sessionManager.isUserExists(email)) {
                        val name = result.data.record.firstname.ifBlank { "User" }
                        sessionManager.registerUser(email, name)
                    }

                    _authState.value = AuthState.Success
                }
                is NetworkResult.Error -> {
                    _authState.value = AuthState.Error(result.message)
                }
                is NetworkResult.Loading -> {
                    // Уже обрабатывается выше
                }
            }
            _isLoading.value = false
        }
    }

    /** Регистрация нового пользователя через API. */
    fun signUp(email: String, name: String, password: String) {
        viewModelScope.launch {
            _authState.value = AuthState.Loading
            _isLoading.value = true

            when (val result = registerUseCase(email, password)) {
                is NetworkResult.Success -> {
                    // Сохраняем данные локально
                    sessionManager.registerUser(email, name)
                    sessionManager.setCurrentEmail(email)
                    sessionManager.savePassword(email, password)

                    _authState.value = AuthState.Success
                }
                is NetworkResult.Error -> {
                    _authState.value = AuthState.Error(result.message)
                }
                is NetworkResult.Loading -> {
                    // Уже обрабатывается выше
                }
            }
            _isLoading.value = false
        }
    }

    /**
     * Регистрация без API (для обратной совместимости). Используется когда нужна только локальная
     * регистрация.
     */
    fun signUpLocal(email: String, name: String) {
        viewModelScope.launch {
            _authState.value = AuthState.Loading
            _isLoading.value = true

            if (sessionManager.isUserExists(email)) {
                _authState.value = AuthState.Error("Аккаунт уже существует")
            } else {
                sessionManager.registerUser(email, name)
                sessionManager.setCurrentEmail(email)
                _authState.value = AuthState.Success
            }
            _isLoading.value = false
        }
    }

    /** Выход из системы. */
    fun logout() {
        viewModelScope.launch {
            _isLoading.value = true

            logoutUseCase()
            sessionManager.clearSession()
            tokenManager.clearAuth()

            _authState.value = AuthState.Idle
            _isLoading.value = false
        }
    }

    /** Сброс состояния авторизации. */
    fun resetState() {
        _authState.value = AuthState.Idle
    }
}

/** Factory для создания AuthViewModel с зависимостями. */
class AuthViewModelFactory(
        private val loginUseCase: LoginUseCase,
        private val registerUseCase: RegisterUseCase,
        private val logoutUseCase: LogoutUseCase,
        private val tokenManager: TokenManager,
        private val sessionManager: SessionManager
) : ViewModelProvider.Factory {
    @Suppress("UNCHECKED_CAST")
    override fun <T : ViewModel> create(modelClass: Class<T>): T {
        return AuthViewModel(
                loginUseCase,
                registerUseCase,
                logoutUseCase,
                tokenManager,
                sessionManager
        ) as
                T
    }
}

/** Состояния авторизации. */
sealed class AuthState {
    object Idle : AuthState()
    object Loading : AuthState()
    object Success : AuthState()
    data class Error(val message: String) : AuthState()
}
```

## File: app/src/main/java/com/example/lol/authorization/PinCodeScreen.kt
```kotlin
package com.example.lol.authorization

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.material3.ripple
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.TextBlack
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title1Semibold

private val PinPressColor = Color(0xFF2074F2)

@Composable
fun PinCodeScreen(navController: NavController) {
    val context = androidx.compose.ui.platform.LocalContext.current
    var pinCode by remember { mutableStateOf("") }
    val maxDigits = 4

    Column(
            modifier = Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp),
            horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Spacer(modifier = Modifier.height(144.dp))

        // Title
        Text(
                text = "Введите код",
                style = Title1Semibold,
                color = TextBlack,
                textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(16.dp))

        // Description
        Text(
                text = "Введите 4-значный код для входа",
                style = TextRegular,
                color = Color(0xFF939396),
                textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(56.dp))

        // Progress indicators (4 dots)
        Row(
                horizontalArrangement = Arrangement.spacedBy(12.dp),
                verticalAlignment = Alignment.CenterVertically
        ) {
            repeat(maxDigits) { index ->
                Box(
                        modifier =
                                Modifier.size(16.dp)
                                        .then(
                                                if (index < pinCode.length) {
                                                    Modifier.background(AccentBlue, CircleShape)
                                                } else {
                                                    Modifier.border(1.dp, AccentBlue, CircleShape)
                                                }
                                        )
                )
            }
        }

        Spacer(modifier = Modifier.height(76.dp))

        // Numeric keyboard
        Column(
                modifier = Modifier.width(288.dp),
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalArrangement = Arrangement.spacedBy(24.dp)
        ) {
            // Rows 1-3
            listOf(listOf("1", "2", "3"), listOf("4", "5", "6"), listOf("7", "8", "9")).forEach {
                    row ->
                Row(
                        modifier = Modifier.fillMaxWidth(),
                        horizontalArrangement = Arrangement.spacedBy(24.dp)
                ) {
                    row.forEach { digit ->
                        PinKeyButton(
                                text = digit,
                                onClick = {
                                    if (pinCode.length < maxDigits) {
                                        pinCode += digit
                                        if (pinCode.length == maxDigits) {
                                            val sessionManager = SessionManager(context)
                                            if (pinCode == sessionManager.getPin()) {
                                                sessionManager.setLoggedIn(true)
                                                sessionManager.resetOneShotInactivityNotificationCycle()
                                                navController.navigate("Home") {
                                                    popUpTo("PinCode") { inclusive = true }
                                                }
                                            } else {
                                                pinCode = ""
                                                android.widget.Toast.makeText(
                                                                context,
                                                                "Неверный код",
                                                                android.widget.Toast.LENGTH_SHORT
                                                        )
                                                        .show()
                                            }
                                        }
                                    }
                                }
                        )
                    }
                }
            }

            // Last row: empty, 0, delete
            Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.spacedBy(24.dp),
                    verticalAlignment = Alignment.CenterVertically
            ) {
                // Empty space - replaced with transparent box for spacing
                Box(modifier = Modifier.size(80.dp))

                // 0
                PinKeyButton(
                        text = "0",
                        onClick = {
                            if (pinCode.length < maxDigits) {
                                pinCode += "0"
                                if (pinCode.length == maxDigits) {
                                    val sessionManager = SessionManager(context)
                                    if (pinCode == sessionManager.getPin()) {
                                        sessionManager.setLoggedIn(true)
                                        sessionManager.resetOneShotInactivityNotificationCycle()
                                        navController.navigate("Home") {
                                            popUpTo("PinCode") { inclusive = true }
                                        }
                                    } else {
                                        pinCode = ""
                                        android.widget.Toast.makeText(
                                                        context,
                                                        "Неверный код",
                                                        android.widget.Toast.LENGTH_SHORT
                                                )
                                                .show()
                                    }
                                }
                            }
                        }
                )

                // Delete button
                Box(
                        modifier =
                                Modifier.size(80.dp)
                                        .clip(CircleShape)
                                        .clickable(
                                                interactionSource =
                                                        remember { MutableInteractionSource() },
                                                indication =
                                                        ripple(
                                                                bounded = true,
                                                                color = PinPressColor
                                                        ),
                                                onClick = {
                                                    if (pinCode.isNotEmpty()) {
                                                        pinCode = pinCode.dropLast(1)
                                                    }
                                                }
                                        ),
                        contentAlignment = Alignment.Center
                ) {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_delete),
                            contentDescription = "Delete",
                            tint = TextBlack,
                            modifier = Modifier.size(35.dp, 24.dp)
                    )
                }
            }
        }
    }
}

@Composable
fun PinKeyButton(text: String, onClick: () -> Unit, isHighlighted: Boolean = false) {
    val interactionSource = remember { MutableInteractionSource() }
    Box(
            modifier =
                    Modifier.size(80.dp)
                            .background(
                                    if (isHighlighted) AccentBlue else Color(0xFFF5F5F9),
                                    CircleShape
                            )
                            .clip(CircleShape)
                            .clickable(
                                    interactionSource = interactionSource,
                                    indication =
                                            ripple(bounded = true, color = PinPressColor),
                                    onClick = onClick
                            ),
            contentAlignment = Alignment.Center
    ) {
        Text(
                text = text,
                style = Title1Semibold,
                color = if (isHighlighted) Color.White else Color.Black
        )
    }
}
```

## File: app/src/main/java/com/example/lol/Cart/CartScreen.kt
```kotlin
package com.example.lol.Cart

import android.widget.Toast
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.HeadlineRegular
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title1Semibold
import com.example.lol.ui.theme.Title2Semibold
import com.example.lol.ui.theme.Title3Medium
import com.example.lol.ui.theme.Title3Semibold
import kotlinx.coroutines.launch

@Composable
fun CartScreen(
        navController: NavController,
        viewModel: CartViewModel,
        ordersViewModel: com.example.lol.Profile.OrdersViewModel
) {
        val cartItems by viewModel.cartItems.collectAsState()
        val context = LocalContext.current
        val scope = rememberCoroutineScope()
        var isProcessing by remember { mutableStateOf(false) }

        Box(modifier = Modifier.fillMaxSize().background(Color.White)) {
                Column(modifier = Modifier.fillMaxSize().padding(horizontal = 20.dp)) {
                        Spacer(modifier = Modifier.height(52.dp))
                        Row(
                                modifier = Modifier.fillMaxWidth(),
                                verticalAlignment = Alignment.CenterVertically
                        ) {
                                IconButton(
                                        onClick = {
                                                if (!navController.popBackStack()) {
                                                        navController.navigate("Main") {
                                                                popUpTo(
                                                                        navController
                                                                                .graph
                                                                                .startDestinationId
                                                                ) { inclusive = true }
                                                        }
                                                }
                                        }
                                ) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id = R.drawable.icon_chevron_left
                                                        ),
                                                contentDescription = "Назад",
                                                tint = Color.Black,
                                                modifier = Modifier.size(24.dp)
                                        )
                                }
                                Text(text = "Корзина", style = Title1Semibold)
                        }
                        Spacer(modifier = Modifier.height(24.dp))

                        if (cartItems.isEmpty()) {
                                Box(
                                        modifier = Modifier.fillMaxSize(),
                                        contentAlignment = Alignment.Center
                                ) { Text("Корзина пуста", color = Color.Gray) }
                        } else {
                                LazyColumn(
                                        modifier = Modifier.weight(1f),
                                        contentPadding = PaddingValues(bottom = 140.dp)
                                ) {
                                        items(cartItems) { item ->
                                                CartItemView(
                                                        item = item,
                                                        onRemove = {
                                                                viewModel.removeFromCart(
                                                                        item.product
                                                                )
                                                        },
                                                        onIncrease = {
                                                                viewModel.increaseQuantity(
                                                                        item.product
                                                                )
                                                        },
                                                        onDecrease = {
                                                                viewModel.decreaseQuantity(
                                                                        item.product
                                                                )
                                                        }
                                                )
                                                Spacer(modifier = Modifier.height(16.dp))
                                        }
                                }
                        }
                }

                if (cartItems.isNotEmpty()) {
                        Box(
                                modifier =
                                        Modifier.align(Alignment.BottomCenter)
                                                .fillMaxWidth()
                                                .background(Color.White)
                                                .shadow(
                                                        elevation = 16.dp,
                                                        shape =
                                                                RoundedCornerShape(
                                                                        topStart = 20.dp,
                                                                        topEnd = 20.dp
                                                                ),
                                                        spotColor = Color(0x99E4E8F5)
                                                )
                                                .padding(20.dp)
                        ) {
                                Column {
                                        Row(
                                                modifier =
                                                        Modifier.fillMaxWidth()
                                                                .padding(horizontal = 4.dp),
                                                horizontalArrangement = Arrangement.SpaceBetween
                                        ) {
                                                Text(
                                                        text = "Сумма",
                                                        style = Title2Semibold,
                                                        color = Color.Black
                                                )
                                                Text(
                                                        text = "${viewModel.calculateTotal()} ₽",
                                                        style = Title2Semibold,
                                                        color = Color.Black
                                                )
                                        }
                                        Spacer(modifier = Modifier.height(16.dp))

                                        Button(
                                                onClick = {
                                                        scope.launch {
                                                                isProcessing = true
                                                                ordersViewModel.addOrder(
                                                                        items = cartItems,
                                                                        totalPrice =
                                                                                viewModel
                                                                                        .calculateTotal()
                                                                                        .toDouble()
                                                                )

                                                                isProcessing = false
                                                                viewModel.clearCart()
                                                                Toast.makeText(
                                                                                context,
                                                                                "Заказ успешно оформлен!",
                                                                                Toast.LENGTH_LONG
                                                                        )
                                                                        .show()
                                                                navController.navigate("Main") {
                                                                        popUpTo("Main") {
                                                                                inclusive = false
                                                                        }
                                                                }
                                                        }
                                                },
                                                modifier = Modifier.fillMaxWidth().height(56.dp),
                                                colors =
                                                        ButtonDefaults.buttonColors(
                                                                containerColor = AccentBlue
                                                        ),
                                                shape =
                                                        RoundedCornerShape(10.dp),
                                                enabled = !isProcessing
                                        ) {
                                                Text(
                                                        text =
                                                                if (isProcessing) "Обработка..."
                                                                else "Оплатить",
                                                        style = Title3Semibold
                                                )
                                        }
                                }
                        }
                }
        }
}

@Composable
fun CartItemView(
        item: CartItem,
        onRemove: () -> Unit,
        onIncrease: () -> Unit,
        onDecrease: () -> Unit
) {
        Card(
                modifier =
                        Modifier.fillMaxWidth()
                                .height(138.dp)
                                .shadow(
                                        elevation = 20.dp,
                                        shape = RoundedCornerShape(12.dp),
                                        spotColor = Color(0x99E4E8F5)
                                ),
                shape = RoundedCornerShape(12.dp),
                colors = CardDefaults.cardColors(containerColor = Color.White),
                border = androidx.compose.foundation.BorderStroke(1.dp, Color(0xFFF4F4F4)),
                elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
        ) {
                Box(modifier = Modifier.fillMaxSize()) {
                        Icon(
                                painter = painterResource(id = R.drawable.icon_delete),
                                contentDescription = "Delete",
                                tint = Color(0xFF7E7E9A),
                                modifier =
                                        Modifier.padding(top = 16.dp, end = 16.dp)
                                                .align(Alignment.TopEnd)
                                                .size(20.dp)
                                                .clickable(onClick = onRemove)
                        )

                        Text(
                                text = item.product.title,
                                style = HeadlineRegular,
                                color = Color.Black,
                                modifier =
                                        Modifier.padding(start = 16.dp, top = 16.dp).width(250.dp)
                        )

                        Text(
                                text = "${item.product.price * item.quantity} ₽",
                                style = Title3Medium,
                                color = Color.Black,
                                modifier =
                                        Modifier.align(Alignment.BottomStart)
                                                .padding(start = 16.dp, bottom = 20.dp)
                        )

                        Row(
                                verticalAlignment = Alignment.CenterVertically,
                                modifier =
                                        Modifier.align(Alignment.BottomEnd)
                                                .padding(end = 16.dp, bottom = 16.dp)
                                                .width(64.dp)
                                                .height(32.dp)
                                                .background(
                                                        Color(0xFFF5F5F9),
                                                        RoundedCornerShape(8.dp)
                                                ),
                                horizontalArrangement = Arrangement.SpaceBetween
                        ) {
                                IconButton(onClick = onDecrease, modifier = Modifier.size(20.dp)) {
                                        Icon(
                                                painterResource(id = R.drawable.icon_minus),
                                                contentDescription = "Decrease",
                                                modifier = Modifier.size(12.dp),
                                                tint = Color(0xFFB8C1CC)
                                        )
                                }

                                Text(
                                        text = item.quantity.toString(),
                                        style = TextRegular,
                                        color = Color.Black
                                )

                                IconButton(onClick = onIncrease, modifier = Modifier.size(20.dp)) {
                                        Icon(
                                                painterResource(id = R.drawable.icon_plus),
                                                contentDescription = "Increase",
                                                modifier = Modifier.size(12.dp),
                                                tint = Color(0xFF939396)
                                        )
                                }
                        }
                }
        }
}
```

## File: app/src/main/java/com/example/lol/Main/MainScreen.kt
```kotlin
package com.example.lol.Main

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.LazyRow
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.BottomSheetDefaults
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.navigation.NavController
import com.example.lol.Cart.CartViewModel
import com.example.lol.Catalogue.CatalogueViewModel
import com.example.lol.R
import com.example.lol.components.AppChip
import com.example.lol.components.AppTextField
import com.example.lol.components.ProductCard
import com.example.lol.components.ProductDetailsContent
import com.example.lol.data.Product
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.Roboto
import com.example.lol.ui.theme.TextMedium
import com.example.lol.ui.theme.Title2ExtraBold
import com.example.lol.ui.theme.Title3Semibold

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun MainScreen(
        navController: NavController,
        viewModel: CatalogueViewModel,
        cartViewModel: CartViewModel
) {
    val products by viewModel.products.collectAsState()
    val allProducts by viewModel.allProducts.collectAsState()
    val cartItems by cartViewModel.cartItems.collectAsState()
    var selectedProduct by remember { mutableStateOf<Product?>(null) }
    var showSheet by remember { mutableStateOf(false) }
    val sheetState = rememberModalBottomSheetState()
    var searchQuery by remember { mutableStateOf("") }

    // Баннеры берём из полного списка, чтобы они не зависели от фильтров.
    val bannerProducts = remember(allProducts) { allProducts.take(2) }

    Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
        // Поиск в шапке.
        Box(modifier = Modifier.fillMaxWidth().padding(20.dp)) {
            AppTextField(
                    value = searchQuery,
                    onValueChange = {
                        searchQuery = it
                        viewModel.filterProducts(it)
                    },
                    placeholder = "Поиск",
                    modifier = Modifier.fillMaxWidth(),
                    leadingIcon = {
                        Icon(
                                painter = painterResource(id = R.drawable.icon_search),
                                contentDescription = "Search",
                                tint = Color(0xFF939396)
                        )
                    }
            )
        }

        LazyColumn(
                modifier = Modifier.fillMaxSize(),
                contentPadding = PaddingValues(bottom = 80.dp)
        ) {
            // Блок баннеров.
            item {
                Text(
                        text = "Акции и новости",
                        style = Title3Semibold,
                        color = Color(0xFF939396),
                        modifier = Modifier.padding(horizontal = 20.dp)
                )
                Spacer(modifier = Modifier.height(16.dp))
                LazyRow(
                        contentPadding = PaddingValues(horizontal = 20.dp),
                        horizontalArrangement = Arrangement.spacedBy(16.dp)
                ) {
                    items(bannerProducts.size) { index ->
                        BannerCard(
                                index = index,
                                product = bannerProducts.getOrNull(index),
                                onClick = {
                                    bannerProducts.getOrNull(index)?.let { product ->
                                        selectedProduct = product
                                        showSheet = true
                                    }
                                }
                        )
                    }
                }
                Spacer(modifier = Modifier.height(32.dp))
            }

            // Блок категорий.
            item {
                Text(
                        text = "Каталог описаний",
                        style = Title3Semibold,
                        color = Color(0xFF939396),
                        modifier = Modifier.padding(horizontal = 20.dp)
                )
                Spacer(modifier = Modifier.height(16.dp))
                val currentCategory by viewModel.selectedCategory.collectAsState()

                LazyRow(
                        contentPadding = PaddingValues(horizontal = 20.dp),
                        horizontalArrangement = Arrangement.spacedBy(10.dp)
                ) {
                    val categories =
                            listOf(
                                    "Все",
                                    "Популярные",
                                    "Новинки",
                                    "Мужское",
                                    "Женское",
                                    "Аксессуары"
                            )
                    items(categories) { category ->
                        AppChip(
                                text = category,
                                isSelected = category == currentCategory,
                                onClick = { viewModel.setCategory(category) }
                        )
                    }
                }
                Spacer(modifier = Modifier.height(24.dp))
            }

            // Блок товаров.
            items(products) { product ->
                val isInCart = cartItems.any { it.product.id == product.id }
                ProductCard(
                        product = product,
                        onClick = {
                            selectedProduct = product
                            showSheet = true
                        },
                        onAddToCart = { cartViewModel.addToCart(product) },
                        onRemoveFromCart = { cartViewModel.removeFromCart(product) },
                        isInCart = isInCart,
                        modifier = Modifier.padding(horizontal = 20.dp)
                )
                Spacer(modifier = Modifier.height(16.dp))
            }
        }

        if (showSheet && selectedProduct != null) {
            ModalBottomSheet(
                    onDismissRequest = { showSheet = false },
                    sheetState = sheetState,
                    containerColor = Color.White,
                    dragHandle = { BottomSheetDefaults.DragHandle(color = Color(0xFFC4C4C4)) }
            ) {
                ProductDetailsContent(
                        product = selectedProduct!!,
                        onAddToCart = {
                            cartViewModel.addToCart(selectedProduct!!)
                            showSheet = false
                        },
                        onClose = { showSheet = false }
                )
            }
        }
    }
}

@Composable
fun BannerCard(index: Int, product: Product?, onClick: () -> Unit) {
    val imageRes =
            if (index == 0) R.drawable.zemri9vo71oremovebgpreview1
            else R.drawable.ditylc26zviremovebgpreview1
    val gradient =
            if (index == 0) {
                Brush.linearGradient(colors = listOf(Color(0xFF97D9F0), Color(0xFF92E9D4)))
            } else {
                Brush.linearGradient(colors = listOf(Color(0xFF76B3FF), Color(0xFFCDE3FF)))
            }

    Box(
            modifier =
                    Modifier.width(270.dp)
                            .height(152.dp)
                            .background(gradient, shape = RoundedCornerShape(12.dp))
                            .clickable(onClick = onClick)
    ) {
        // Слой изображения.
        androidx.compose.foundation.Image(
                painter = painterResource(id = imageRes),
                contentDescription = null,
                contentScale = androidx.compose.ui.layout.ContentScale.Fit,
                modifier =
                        Modifier.align(Alignment.CenterEnd)
                                .size(150.dp)
                                .padding(end = 8.dp)
        )

        // Текстовый слой.
        Column(modifier = Modifier.fillMaxSize().padding(16.dp)) {
            Text(
                    text =
                            (product?.title
                                            ?: if (index == 0) "Шорты\nВторник"
                                            else "Рубашка\nВоскресенье")
                                    .replace(" ", "\n"),
                    style = Title2ExtraBold.copy(fontFamily = Roboto, lineHeight = 24.sp),
                    color = Color.White,
                    modifier = Modifier.width(170.dp)
            )
            Spacer(modifier = Modifier.weight(1f))
            Text(
                    text = "${product?.price ?: if (index == 0) 4000 else 8000} ₽",
                    style = Title2ExtraBold.copy(fontFamily = Roboto),
                    color = Color.White
            )
        }
    }
}
```

## File: app/src/main/java/com/example/lol/Projects/CreateProjectScreen.kt
```kotlin
package com.example.lol.Projects

import android.graphics.Bitmap
import android.graphics.ImageDecoder
import android.net.Uri
import android.os.Build
import android.provider.MediaStore
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.asImageBitmap
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.components.AppSelectField
import com.example.lol.components.AppTextField
import com.example.lol.components.PhotoPickerBottomSheet
import com.example.lol.ui.theme.*
import com.example.lol.ui.theme.Title2Semibold
import com.example.lol.ui.theme.Title3Semibold
import java.text.SimpleDateFormat
import java.util.*

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CreateProjectScreen(navController: NavController, viewModel: ProjectsViewModel) {
    var projectType by remember { mutableStateOf("") }
    var projectName by remember { mutableStateOf("") }
    var startDate by remember { mutableStateOf("") }
    var endDate by remember { mutableStateOf("") }
    var recipient by remember { mutableStateOf("") }
    var descriptionSource by remember { mutableStateOf("") }
    var category by remember { mutableStateOf("") }
    var selectedImageUri by remember { mutableStateOf<Uri?>(null) }
    var selectedImageBitmap by remember { mutableStateOf<Bitmap?>(null) }

    val datePickerState = rememberDatePickerState()
    var showDatePicker by remember { mutableStateOf(false) }
    var datePickingField by remember { mutableStateOf("") } // "start" or "end"

    val launcher =
            rememberLauncherForActivityResult(contract = ActivityResultContracts.GetContent()) {
                    uri: Uri? ->
                selectedImageUri = uri
            }

    val isFormValid = projectName.isNotBlank()

    val cameraLauncher =
            rememberLauncherForActivityResult(
                    contract = ActivityResultContracts.TakePicturePreview()
            ) { bitmap ->
                if (bitmap != null) {
                    // Камера возвращает Bitmap, поэтому храним его отдельно от URI из галереи.
                    selectedImageBitmap = bitmap
                    selectedImageUri = null
                }
            }

    var showPhotoSheet by remember { mutableStateOf(false) }

    Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
        Box(
                modifier =
                        Modifier.fillMaxWidth()
                                .padding(top = 52.dp, bottom = 12.dp, start = 20.dp, end = 20.dp)
        ) {
            IconButton(
                    onClick = {
                        if (!navController.popBackStack()) {
                            navController.navigate("Projects") {
                                popUpTo(navController.graph.startDestinationId) { inclusive = true }
                            }
                        }
                    },
                    modifier = Modifier.align(Alignment.CenterStart)
            ) {
                Icon(
                        painter = painterResource(id = R.drawable.icon_chevron_left),
                        contentDescription = "Назад",
                        tint = Color.Black,
                        modifier = Modifier.size(24.dp)
                )
            }
            Text(
                    text = "Создать проект",
                    style = Title2Semibold,
                    modifier = Modifier.align(Alignment.Center),
                    color = Color.Black
            )
        }

        Box(modifier = Modifier.fillMaxWidth().height(1.dp).background(Color(0xFFF4F4F4)))

        Column(
                modifier =
                        Modifier.weight(1f)
                                .verticalScroll(rememberScrollState())
                                .padding(horizontal = 20.dp, vertical = 24.dp)
        ) {
            AppSelectField(
                    value = projectType,
                    options =
                            listOf(
                                    "Веб-сайт",
                                    "Мобильное приложение",
                                    "Маркетинг",
                                    "Дизайн-система"
                            ),
                    onOptionSelected = { projectType = it },
                    label = "Тип",
                    placeholder = "Выберите тип",
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(16.dp))

            AppTextField(
                    value = projectName,
                    onValueChange = { projectName = it },
                    label = "Название проекта",
                    placeholder = "Введите имя",
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(16.dp))

            Box(
                    modifier =
                            Modifier.clickable {
                                datePickingField = "start"
                                showDatePicker = true
                            }
            ) {
                AppTextField(
                        value = startDate,
                        onValueChange = {},
                        label = "Дата начала",
                        placeholder = "--.--.----",
                        modifier = Modifier.fillMaxWidth(),
                        trailingIcon = {
                            Icon(
                                    painter = painterResource(id = R.drawable.icons2),
                                    contentDescription = "Calendar",
                                    tint = Color(0xFFBFC7D1),
                                    modifier = Modifier.size(20.dp)
                            )
                        }
                )
                Box(
                        modifier =
                                Modifier.matchParentSize().clickable {
                                    datePickingField = "start"
                                    showDatePicker = true
                                }
                )
            }

            Spacer(modifier = Modifier.height(16.dp))

            Box(
                    modifier =
                            Modifier.clickable {
                                datePickingField = "end"
                                showDatePicker = true
                            }
            ) {
                AppTextField(
                        value = endDate,
                        onValueChange = {},
                        label = "Дата Окончания",
                        placeholder = "--.--.----",
                        modifier = Modifier.fillMaxWidth(),
                        trailingIcon = {
                            Icon(
                                    painter = painterResource(id = R.drawable.icons2),
                                    contentDescription = "Calendar",
                                    tint = Color(0xFFBFC7D1),
                                    modifier = Modifier.size(20.dp)
                            )
                        }
                )
                Box(
                        modifier =
                                Modifier.matchParentSize().clickable {
                                    datePickingField = "end"
                                    showDatePicker = true
                                }
                )
            }

            Spacer(modifier = Modifier.height(16.dp))

            AppSelectField(
                    value = recipient,
                    options =
                            listOf(
                                    "Команда разработчиков",
                                    "Отдел маркетинга",
                                    "Заказчик",
                                    "Личный проект"
                            ),
                    onOptionSelected = { recipient = it },
                    label = "Кому",
                    placeholder = "Выберите кому",
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(16.dp))

            AppTextField(
                    value = descriptionSource,
                    onValueChange = { descriptionSource = it },
                    label = "Источник описания",
                    placeholder = "example.com",
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(16.dp))

            AppSelectField(
                    value = category,
                    options = viewModel.getCategories(),
                    onOptionSelected = { category = it },
                    label = "Категория",
                    placeholder = "Выберите категорию",
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(32.dp))

            Box(
                    modifier =
                            Modifier.size(162.dp)
                                    .align(Alignment.CenterHorizontally)
                                    .background(InputBg, RoundedCornerShape(16.dp))
                                    .clickable { showPhotoSheet = true },
                    contentAlignment = Alignment.Center
            ) {
                if (selectedImageUri != null || selectedImageBitmap != null) {
                    val context = LocalContext.current
                    val bitmap =
                            if (selectedImageBitmap != null) {
                                selectedImageBitmap
                            } else {
                                remember(selectedImageUri) {
                                    try {
                                        if (Build.VERSION.SDK_INT < 28) {
                                            @Suppress("DEPRECATION")
                                            MediaStore.Images.Media.getBitmap(
                                                    context.contentResolver,
                                                    selectedImageUri
                                            )
                                        } else {
                                            val source =
                                                    ImageDecoder.createSource(
                                                            context.contentResolver,
                                                            selectedImageUri!!
                                                    )
                                            ImageDecoder.decodeBitmap(source)
                                        }
                                    } catch (e: Exception) {
                                        null
                                    }
                                }
                            }

                    if (bitmap != null) {
                        Image(
                                bitmap = bitmap.asImageBitmap(),
                                contentDescription = "Selected image",
                                modifier = Modifier.fillMaxSize().clip(RoundedCornerShape(16.dp)),
                                contentScale = ContentScale.Crop
                        )
                    } else {
                        Icon(
                                painter = painterResource(id = R.drawable.icon_plus),
                                contentDescription = "Error loading image",
                                tint = Color.Red,
                                modifier = Modifier.size(48.dp)
                        )
                    }
                } else {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_plus),
                            contentDescription = "Add photo",
                            tint = Color(0xFFBFC7D1),
                            modifier = Modifier.size(48.dp)
                    )
                }
            }

            Spacer(modifier = Modifier.height(32.dp))

            Button(
                    onClick = {
                        if (projectName.isNotBlank()) {
                            val newProject =
                                    Project(
                                            name = projectName,
                                            type = projectType,
                                            startDate = startDate,
                                            endDate = endDate,
                                            recipient = recipient,
                                            descriptionSource = descriptionSource,
                                            category = category,
                                            imageUri = selectedImageUri?.toString()
                                    )
                            viewModel.addProject(newProject)
                            // Явная навигация на Projects с очисткой стека
                            navController.navigate("Projects") {
                                popUpTo("Projects") { inclusive = true }
                            }
                        }
                    },
                    modifier = Modifier.fillMaxWidth().height(56.dp),
                    colors = ButtonDefaults.buttonColors(containerColor = AccentBlue),
                    shape = RoundedCornerShape(10.dp),
                    enabled = projectName.isNotBlank()
            ) { Text(text = "Подтвердить", style = Title3Semibold, color = Color.White) }

            Spacer(modifier = Modifier.height(24.dp))
        }
    }

    if (showDatePicker) {
        DatePickerDialog(
                onDismissRequest = { showDatePicker = false },
                confirmButton = {
                    TextButton(
                            onClick = {
                                val date =
                                        datePickerState.selectedDateMillis?.let {
                                            val sdf =
                                                    SimpleDateFormat(
                                                            "dd.MM.yyyy",
                                                            Locale.getDefault()
                                                    )
                                            sdf.format(Date(it))
                                        }
                                                ?: ""
                                if (datePickingField == "start") startDate = date
                                else endDate = date
                                showDatePicker = false
                            }
                    ) { Text("OK") }
                },
                dismissButton = {
                    TextButton(onClick = { showDatePicker = false }) { Text("Отмена") }
                }
        ) { DatePicker(state = datePickerState) }
    }

    if (showPhotoSheet) {
        PhotoPickerBottomSheet(
                onDismiss = { showPhotoSheet = false },
                onCameraClick = {
                    cameraLauncher.launch(null)
                    showPhotoSheet = false
                },
                onGalleryClick = {
                    launcher.launch("image/*")
                    showPhotoSheet = false
                }
        )
    }
}
```

## File: gradle/libs.versions.toml
```toml
[versions]
activityComposeVersion = "1.12.1"
agp = "8.10.1"
composeBomVersion = "2025.12.00"
kotlin = "2.0.21"
coreKtx = "1.17.0"
junit = "4.13.2"
junitVersion = "1.3.0"
espressoCore = "3.7.0"
lifecycleRuntimeKtx = "2.6.1"
activityCompose = "1.8.0"
composeBom = "2024.09.00"
adsMobileSdk = "0.22.0-beta04"
coil = "2.7.0"
lifecycleRuntimeKtxVersion = "2.10.0"
benchmarkMacroJunit4 = "1.3.3"
uiautomator = "2.3.0"

[libraries]
androidx-activity-compose-v1121 = { module = "androidx.activity:activity-compose", version.ref = "activityComposeVersion" }
androidx-compose-bom-v20251200 = { module = "androidx.compose:compose-bom", version.ref = "composeBomVersion" }
androidx-compose-ui = { module = "androidx.compose.ui:ui" }
androidx-compose-ui-graphics = { module = "androidx.compose.ui:ui-graphics" }
androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
androidx-lifecycle-runtime-ktx-v2100 = { module = "androidx.lifecycle:lifecycle-runtime-ktx", version.ref = "lifecycleRuntimeKtxVersion" }
junit = { group = "junit", name = "junit", version.ref = "junit" }
androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "junitVersion" }
androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espressoCore" }
androidx-lifecycle-runtime-ktx = { group = "androidx.lifecycle", name = "lifecycle-runtime-ktx", version.ref = "lifecycleRuntimeKtx" }
androidx-activity-compose = { group = "androidx.activity", name = "activity-compose", version.ref = "activityCompose" }
androidx-compose-bom = { group = "androidx.compose", name = "compose-bom", version.ref = "composeBom" }
androidx-ui = { group = "androidx.compose.ui", name = "ui" }
androidx-ui-graphics = { group = "androidx.compose.ui", name = "ui-graphics" }
androidx-ui-tooling = { group = "androidx.compose.ui", name = "ui-tooling" }
androidx-ui-tooling-preview = { group = "androidx.compose.ui", name = "ui-tooling-preview" }
androidx-ui-test-manifest = { group = "androidx.compose.ui", name = "ui-test-manifest" }
androidx-ui-test-junit4 = { group = "androidx.compose.ui", name = "ui-test-junit4" }
androidx-material3 = { group = "androidx.compose.material3", name = "material3" }
ads-mobile-sdk = { group = "com.google.android.libraries.ads.mobile.sdk", name = "ads-mobile-sdk", version.ref = "adsMobileSdk" }
coil-compose = { group = "io.coil-kt", name = "coil-compose", version.ref = "coil" }
coil-svg = { group = "io.coil-kt", name = "coil-svg", version.ref = "coil" }
androidx-benchmark-macro-junit4 = { group = "androidx.benchmark", name = "benchmark-macro-junit4", version.ref = "benchmarkMacroJunit4" }
androidx-uiautomator = { group = "androidx.test.uiautomator", name = "uiautomator", version.ref = "uiautomator" }
androidx-test-rules = { group = "androidx.test", name = "rules", version = "1.6.1" }
androidx-profileinstaller = { group = "androidx.profileinstaller", name = "profileinstaller", version = "1.4.1" }

[plugins]
android-application = { id = "com.android.application", version.ref = "agp" }
android-library = { id = "com.android.library", version.ref = "agp" }
kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }
kotlin-compose = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }
android-test = { id = "com.android.test", version.ref = "agp" }
```

## File: settings.gradle.kts
```kotlin
pluginManagement {
    repositories {
        google {
            content {
                includeGroupByRegex("com\\.android.*")
                includeGroupByRegex("com\\.google.*")
                includeGroupByRegex("androidx.*")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = "Matule"
include(":app", ":benchmark", ":uikit", ":network")
```

## File: app/src/main/java/com/example/lol/authorization/CreatePinScreen.kt
```kotlin
package com.example.lol.authorization

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.material3.ripple
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.TextBlack
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title1Semibold

@Composable
fun CreatePinScreen(navController: NavController) {
    val context = androidx.compose.ui.platform.LocalContext.current
    val sessionManager = remember { SessionManager(context) }
    var pinCode by remember { mutableStateOf("") }
    val maxDigits = 4

    Column(
            modifier = Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp),
            horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Spacer(modifier = Modifier.height(60.dp))

        Spacer(modifier = Modifier.height(71.dp))

        // Title
        Text(
                text = "Создайте пин-код",
                style = Title1Semibold,
                color = TextBlack,
                textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(16.dp))

        // Description
        Text(
                text = "Для быстрого входа в приложение",
                style = TextRegular,
                color = Color(0xFF939396),
                textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(56.dp))

        // Dots (4)
        Row(
                horizontalArrangement = Arrangement.spacedBy(12.dp),
                verticalAlignment = Alignment.CenterVertically
        ) {
            repeat(maxDigits) { index ->
                Box(
                        modifier =
                                Modifier.size(16.dp)
                                        .then(
                                                if (index < pinCode.length) {
                                                    Modifier.background(AccentBlue, CircleShape)
                                                } else {
                                                    Modifier.border(1.dp, AccentBlue, CircleShape)
                                                }
                                        )
                )
            }
        }

        Spacer(modifier = Modifier.height(60.dp))

        // Keyboard
        Column(
                modifier = Modifier.width(288.dp),
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalArrangement = Arrangement.spacedBy(24.dp)
        ) {
            listOf(listOf("1", "2", "3"), listOf("4", "5", "6"), listOf("7", "8", "9")).forEach {
                    row ->
                Row(
                        modifier = Modifier.fillMaxWidth(),
                        horizontalArrangement = Arrangement.spacedBy(24.dp)
                ) {
                    row.forEach { digit ->
                        PinKeyButton(
                                text = digit,
                                onClick = {
                                    if (pinCode.length < maxDigits) {
                                        pinCode += digit
                                        if (pinCode.length == maxDigits) {
                                            val email = sessionManager.getCurrentEmail() ?: ""
                                            sessionManager.savePin(email, pinCode)
                                            sessionManager.setLoggedIn(true)
                                            sessionManager.resetOneShotInactivityNotificationCycle()
                                            navController.navigate("Home")
                                        }
                                    }
                                }
                        )
                    }
                }
            }

            Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.spacedBy(24.dp),
                    verticalAlignment = Alignment.CenterVertically
            ) {
                Box(modifier = Modifier.size(80.dp))
                PinKeyButton(
                        text = "0",
                        onClick = {
                            if (pinCode.length < maxDigits) {
                                pinCode += "0"
                                if (pinCode.length == maxDigits) {
                                    val email = sessionManager.getCurrentEmail() ?: ""
                                    sessionManager.savePin(email, pinCode)
                                    sessionManager.setLoggedIn(true)
                                    sessionManager.resetOneShotInactivityNotificationCycle()
                                    navController.navigate("Home")
                                }
                            }
                        }
                )
                Box(
                        modifier =
                                Modifier.size(80.dp).clip(CircleShape).clickable(
                                                interactionSource =
                                                        remember { MutableInteractionSource() },
                                                indication =
                                                        ripple(
                                                                bounded = true,
                                                                color = Color(0xFF2074F2)
                                                        )
                                        ) {
                                    if (pinCode.isNotEmpty()) pinCode = pinCode.dropLast(1)
                                },
                        contentAlignment = Alignment.Center
                ) {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_delete),
                            contentDescription = "Delete",
                            modifier = Modifier.size(35.dp, 24.dp)
                    )
                }
            }
        }
    }
}
```

## File: app/src/main/java/com/example/lol/Catalogue/CatalogueScreen.kt
```kotlin
package com.example.lol.Catalogue

import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.LazyRow
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.BottomSheetDefaults
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.example.lol.Cart.CartViewModel
import com.example.lol.R
import com.example.lol.components.AppChip
import com.example.lol.components.AppTextField
import com.example.lol.components.ProductCard
import com.example.lol.components.ProductDetailsContent
import com.example.lol.data.Product
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.HeadlineMedium
import com.example.lol.ui.theme.TextMedium

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CatalogueScreen(
        navController: NavController,
        viewModel: CatalogueViewModel,
        cartViewModel: CartViewModel
) {
    val products by viewModel.products.collectAsState()
    var searchQuery by remember { mutableStateOf("") }
    var selectedProduct by remember { mutableStateOf<Product?>(null) }
    var showSheet by remember { mutableStateOf(false) }
    val sheetState = rememberModalBottomSheetState()

    Column(modifier = Modifier.fillMaxSize().background(Color.White)) {
        // Search & Header
        Column(modifier = Modifier.fillMaxWidth().padding(20.dp)) {
            // Header with Search and Cart icon
            Row(
                    modifier = Modifier.fillMaxWidth(),
                    verticalAlignment = Alignment.CenterVertically,
                    horizontalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                AppTextField(
                        value = searchQuery,
                        onValueChange = {
                            searchQuery = it
                            viewModel.filterProducts(it)
                        },
                        placeholder = "Искать описания",
                        modifier = Modifier.weight(1f),
                        leadingIcon = {
                            Icon(
                                    painter = painterResource(id = R.drawable.icon_search),
                                    contentDescription = "Search",
                                    tint = Color(0xFF939396)
                            )
                        }
                )

                // Profile icon
                Image(
                        painter = painterResource(id = R.drawable.user_icon_catalogue),
                        contentDescription = "Профиль",
                        contentScale = ContentScale.Crop,
                        modifier =
                                Modifier.size(32.dp).clip(CircleShape).clickable {
                                    navController.navigate("Profile") {
                                        popUpTo(navController.graph.startDestinationId) {
                                            saveState = true
                                        }
                                        launchSingleTop = true
                                        restoreState = true
                                    }
                                }
                )
            }
            Spacer(modifier = Modifier.height(16.dp))

            val currentCategory by viewModel.selectedCategory.collectAsState()

            // Categories Chips
            LazyRow(horizontalArrangement = Arrangement.spacedBy(16.dp)) {
                val categories =
                        listOf("Все", "Популярные", "Новинки", "Мужское", "Женское", "Аксессуары")
                items(categories) { category ->
                    AppChip(
                            text = category,
                            isSelected = category == currentCategory,
                            onClick = { viewModel.setCategory(category) }
                    )
                }
            }
        }

        Box(modifier = Modifier.weight(1f)) {
            val cartItems by cartViewModel.cartItems.collectAsState()

            LazyColumn(
                    modifier = Modifier.fillMaxSize(),
                    contentPadding = PaddingValues(horizontal = 20.dp, vertical = 10.dp),
                    verticalArrangement = Arrangement.spacedBy(20.dp)
            ) {
                items(products) { product ->
                    val isInCart = cartItems.any { it.product.id == product.id }
                    ProductCard(
                            product = product,
                            onClick = {
                                selectedProduct = product
                                showSheet = true
                            },
                            onAddToCart = { cartViewModel.addToCart(product) },
                            onRemoveFromCart = { cartViewModel.removeFromCart(product) },
                            isInCart = isInCart
                    )
                }

                if (cartItems.isNotEmpty()) {
                    item { Spacer(modifier = Modifier.height(80.dp)) }
                }
            }

            if (cartItems.isNotEmpty()) {
                val totalPrice = cartViewModel.calculateTotal()
                Box(
                        modifier =
                                Modifier.fillMaxWidth()
                                        .align(Alignment.BottomCenter)
                                        .padding(20.dp)
                                        .shadow(10.dp, RoundedCornerShape(12.dp))
                                        .background(AccentBlue, RoundedCornerShape(12.dp))
                                        .clickable { navController.navigate("Cart") }
                                        .padding(vertical = 16.dp, horizontal = 20.dp)
                ) {
                    Row(
                            modifier = Modifier.fillMaxWidth(),
                            verticalAlignment = Alignment.CenterVertically,
                            horizontalArrangement = Arrangement.SpaceBetween
                    ) {
                        Row(verticalAlignment = Alignment.CenterVertically) {
                            Icon(
                                    painter = painterResource(id = R.drawable.icon_shopping_cart),
                                    contentDescription = null,
                                    tint = Color.White,
                                    modifier = Modifier.size(24.dp)
                            )
                            Spacer(modifier = Modifier.width(12.dp))
                            Text(text = "В корзину", color = Color.White, style = HeadlineMedium)
                        }
                        Text(text = "$totalPrice ₽", color = Color.White, style = HeadlineMedium)
                    }
                }
            }
        }

        if (showSheet && selectedProduct != null) {
            ModalBottomSheet(
                    onDismissRequest = { showSheet = false },
                    sheetState = sheetState,
                    containerColor = Color.White,
                    dragHandle = { BottomSheetDefaults.DragHandle(color = Color(0xFFC4C4C4)) }
            ) {
                ProductDetailsContent(
                        product = selectedProduct!!,
                        onAddToCart = {
                            cartViewModel.addToCart(selectedProduct!!)
                            showSheet = false
                        },
                        onClose = { showSheet = false }
                )
            }
        }
    }
}
```

## File: app/src/main/java/com/example/lol/Catalogue/CatalogueViewModel.kt
```kotlin
package com.example.lol.Catalogue

import android.app.Application
import androidx.lifecycle.AndroidViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import com.example.lol.data.Product
import com.example.lol.data.ProductRepository
import com.example.lol.data.cache.ProductCache
import com.example.lol.data.network.NetworkResult
import com.example.lol.data.network.models.ProductItem
import com.example.lol.domain.usecase.product.GetProductsUseCase
import com.example.lol.domain.usecase.product.SearchProductsUseCase
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch

/** Состояние загрузки каталога. */
sealed class CatalogueState {
    object Idle : CatalogueState()
    object Loading : CatalogueState()
    object Success : CatalogueState()
    data class Error(val message: String) : CatalogueState()
}

/** ViewModel для управления каталогом продуктов. Использует UseCases для сетевых запросов. */
class CatalogueViewModel(
        application: Application,
        private val getProductsUseCase: GetProductsUseCase? = null,
        private val searchProductsUseCase: SearchProductsUseCase? = null
) : AndroidViewModel(application) {

    // Локальный репозиторий для fallback (JSON assets)
    private val localRepository = ProductRepository(application)

    // Кэш для offline-режима
    private val productCache = ProductCache(application)

    private val _products = MutableStateFlow<List<Product>>(emptyList())
    val products: StateFlow<List<Product>> = _products.asStateFlow()

    // Все продукты для баннеров (не затронуты фильтрами)
    private val _allProducts = MutableStateFlow<List<Product>>(emptyList())
    val allProducts: StateFlow<List<Product>> = _allProducts.asStateFlow()

    private val _selectedCategory = MutableStateFlow("Все")
    val selectedCategory: StateFlow<String> = _selectedCategory.asStateFlow()

    private val _catalogueState = MutableStateFlow<CatalogueState>(CatalogueState.Idle)
    val catalogueState: StateFlow<CatalogueState> = _catalogueState.asStateFlow()

    private var currentSearchQuery = ""
    private var apiProducts: List<ProductItem> = emptyList()

    init {
        loadProducts()
    }

    /** Загрузка продуктов: сначала API, затем fallback на локальные данные. */
    fun loadProducts() {
        viewModelScope.launch {
            _catalogueState.value = CatalogueState.Loading

            val useCase = getProductsUseCase
            if (useCase != null) {
                when (val result = useCase()) {
                    is NetworkResult.Success -> {
                        apiProducts = result.data
                        val products = result.data.map { it.toLocalProduct() }
                        _products.value = products
                        _allProducts.value = products
                        // Кэшируем для offline
                        cacheProducts(products)
                        _catalogueState.value = CatalogueState.Success
                    }
                    is NetworkResult.Error -> {
                        // Fallback на локальные данные
                        loadLocalProducts()
                        _catalogueState.value = CatalogueState.Error(result.message)
                    }
                    is NetworkResult.Loading -> {}
                }
            } else {
                // Нет API репозитория (UseCase) - используем локальные данные
                loadLocalProducts()
                _catalogueState.value = CatalogueState.Success
            }
        }
    }

    /** Загрузка продуктов из локального JSON. */
    private fun loadLocalProducts() {
        val productsList = localRepository.getProducts()
        _products.value = productsList
        _allProducts.value = productsList
    }

    /** Кэширование продуктов для offline-режима. */
    private fun cacheProducts(products: List<Product>) {
        productCache.saveProducts(products)
    }

    /** Установка категории для фильтрации. */
    fun setCategory(category: String) {
        _selectedCategory.value = category
        applyFilters()
    }

    /** Поиск продуктов. При наличии API репозитория выполняет поиск через API. */
    fun filterProducts(query: String) {
        currentSearchQuery = query

        if (searchProductsUseCase != null && query.isNotBlank()) {
            searchViaApi(query)
        } else {
            applyFilters()
        }
    }

    /** Поиск через API. */
    private fun searchViaApi(query: String) {
        viewModelScope.launch {
            _catalogueState.value = CatalogueState.Loading

            val useCase = searchProductsUseCase ?: return@launch

            when (val result = useCase(query)) {
                is NetworkResult.Success -> {
                    val products = result.data.map { it.toLocalProduct() }
                    // Применяем фильтр категории к результатам поиска
                    _products.value =
                            if (_selectedCategory.value == "Все") {
                                products
                            } else {
                                products.filter {
                                    it.category.contains(_selectedCategory.value, ignoreCase = true)
                                }
                            }
                    _catalogueState.value = CatalogueState.Success
                }
                is NetworkResult.Error -> {
                    // Fallback на локальную фильтрацию
                    applyFilters()
                    _catalogueState.value = CatalogueState.Error(result.message)
                }
                is NetworkResult.Loading -> {}
            }
        }
    }

    /** Применение фильтров (категория + поиск) локально. */
    private fun applyFilters() {
        val allProducts =
                if (apiProducts.isNotEmpty()) {
                    apiProducts.map { it.toLocalProduct() }
                } else {
                    localRepository.getProducts()
                }

        val categoryFiltered =
                if (_selectedCategory.value == "Все") {
                    allProducts
                } else {
                    allProducts.filter {
                        it.category.contains(_selectedCategory.value, ignoreCase = true)
                    }
                }

        if (currentSearchQuery.isBlank()) {
            _products.value = categoryFiltered
        } else {
            _products.value =
                    categoryFiltered.filter {
                        it.title.contains(currentSearchQuery, ignoreCase = true) ||
                                it.category.contains(currentSearchQuery, ignoreCase = true)
                    }
        }
    }

    /** Получение списка доступных категорий. */
    fun getCategories(): List<String> {
        val categories = _allProducts.value.map { it.category }.distinct().toMutableList()
        categories.add(0, "Все")
        return categories
    }

    /** Сброс состояния ошибки. */
    fun resetState() {
        _catalogueState.value = CatalogueState.Idle
    }

    /** Конвертация ProductItem из API в локальный Product. */
    private fun ProductItem.toLocalProduct(): Product {
        return Product(
                id = this.id.hashCode(), // Преобразуем String ID в Int
                title = this.title,
                description = "", // API не возвращает description в списке
                price = this.price,
                category = this.typeCloses.ifEmpty { this.type },
                imageUrl = "" // Изображения загружаются отдельно
        )
    }
}

/** Factory для создания CatalogueViewModel с зависимостями. */
class CatalogueViewModelFactory(
        private val application: Application,
        private val getProductsUseCase: GetProductsUseCase? = null,
        private val searchProductsUseCase: SearchProductsUseCase? = null
) : ViewModelProvider.Factory {
    @Suppress("UNCHECKED_CAST")
    override fun <T : androidx.lifecycle.ViewModel> create(modelClass: Class<T>): T {
        return CatalogueViewModel(application, getProductsUseCase, searchProductsUseCase) as T
    }
}
```

## File: app/build.gradle.kts
```kotlin
import org.gradle.api.JavaVersion
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
}

android {
    namespace = "com.example.lol"
    compileSdk = 36

    defaultConfig {
        applicationId = "com.example.lol"
        minSdk = 24
        targetSdk = 35
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("debug")
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
        create("benchmark") {
            initWith(getByName("release"))
            signingConfig = signingConfigs.getByName("debug")
            matchingFallbacks += listOf("release")
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = "11"
    }
    buildFeatures {
        compose = true
    }
    ndkVersion = "29.0.14206865"
    buildToolsVersion = "36.1.0"
}

dependencies {
    implementation(project(":uikit"))
    implementation(project(":network"))

    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx.v2100)
    implementation(libs.androidx.activity.compose.v1121)
    implementation(platform(libs.androidx.compose.bom.v20251200))
    implementation(libs.androidx.compose.ui)
    implementation(libs.androidx.compose.ui.graphics)
    implementation(libs.androidx.ui.tooling.preview)
    implementation(libs.androidx.material3)
    implementation(libs.androidx.profileinstaller)
    implementation("androidx.navigation:navigation-compose:2.9.6")
    implementation("androidx.compose.material:material-icons-extended:1.7.8")
    implementation(libs.coil.compose)
    implementation(libs.coil.svg)
    implementation(libs.ads.mobile.sdk)
    implementation("androidx.work:work-runtime-ktx:2.9.1")
    implementation("androidx.credentials:credentials:1.3.0")
    implementation("androidx.credentials:credentials-play-services-auth:1.3.0")

    testImplementation(libs.junit)
    testImplementation("com.squareup.okhttp3:mockwebserver:4.12.0")
    testImplementation("com.squareup.retrofit2:retrofit:2.9.0")
    testImplementation("com.squareup.retrofit2:converter-gson:2.9.0")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.3")
    testImplementation("io.mockk:mockk:1.13.8")
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(platform(libs.androidx.compose.bom))
    androidTestImplementation(libs.androidx.ui.test.junit4)
    debugImplementation(libs.androidx.ui.tooling)
    debugImplementation(libs.androidx.ui.test.manifest)
}
```

## File: app/src/main/java/com/example/lol/authorization/CreatePasswordScreen.kt
```kotlin
package com.example.lol.authorization

import android.widget.Toast
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.lifecycle.viewmodel.compose.viewModel
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.components.AppTextField
import com.example.lol.components.ErrorNotification
import com.example.lol.data.network.TokenManager
import com.example.lol.domain.usecase.auth.LoginUseCase
import com.example.lol.domain.usecase.auth.LogoutUseCase
import com.example.lol.domain.usecase.auth.RegisterUseCase
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.TextBlack
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title1Semibold
import com.example.lol.ui.theme.Title3Semibold
import kotlinx.coroutines.launch

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CreatePasswordScreen(navController: NavController) {
        val context = LocalContext.current
        val scope = rememberCoroutineScope()
        val credentialHelper = remember { CredentialHelper(context) }
        val sessionManager = remember { SessionManager(context) }
        val tokenManager = remember { TokenManager(context) }
        val authRepository = remember { AuthRepositoryProvider.provide(tokenManager) }
        val loginUseCase = remember { LoginUseCase(authRepository) }
        val registerUseCase = remember { RegisterUseCase(authRepository) }
        val logoutUseCase = remember { LogoutUseCase(authRepository) }
        val viewModel: AuthViewModel =
                viewModel(
                        factory =
                                AuthViewModelFactory(
                                        loginUseCase,
                                        registerUseCase,
                                        logoutUseCase,
                                        tokenManager,
                                        sessionManager
                                )
                )
        var password by remember { mutableStateOf("") }
        var confirmPassword by remember { mutableStateOf("") }
        var errorMessage by remember { mutableStateOf<String?>(null) }
        val authState by viewModel.authState.collectAsState()

        LaunchedEffect(authState) {
                when (authState) {
                        is AuthState.Success -> {
                                Toast.makeText(context, "Пароль установлен!", Toast.LENGTH_SHORT)
                                        .show()
                                navController.navigate("CreatePin") {
                                        popUpTo("CreatePassword") { inclusive = true }
                                }
                                viewModel.resetState()
                        }
                        is AuthState.Error -> {
                                errorMessage = (authState as AuthState.Error).message
                                viewModel.resetState()
                        }
                        else -> {}
                }
        }
        Column(
                modifier =
                        Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp),
                verticalArrangement = Arrangement.Top,
                horizontalAlignment = Alignment.CenterHorizontally
        ) {
                Spacer(modifier = Modifier.height(103.dp))

                Column(
                        modifier = Modifier.fillMaxWidth(),
                        horizontalAlignment = Alignment.CenterHorizontally
                ) {
                        AuthModeBanner()
                        Spacer(modifier = Modifier.height(12.dp))
                        Text(
                                text = "Создание пароля",
                                style = Title1Semibold,
                                color = TextBlack,
                                textAlign = TextAlign.Center
                        )
                        Spacer(modifier = Modifier.height(23.dp))
                        Text(
                                text = "Создайте пароль для входа в приложение",
                                color = TextBlack,
                                style = TextRegular,
                                textAlign = TextAlign.Center
                        )
                }

                Spacer(modifier = Modifier.height(60.dp))

                var passwordVisible by remember { mutableStateOf(false) }
                var confirmPasswordVisible by remember { mutableStateOf(false) }
                var isPasswordError by remember { mutableStateOf(false) }
                var isConfirmPasswordError by remember { mutableStateOf(false) }

                AppTextField(
                        value = password,
                        onValueChange = {
                                password = it
                                isPasswordError = false
                        },
                        label = "Пароль",
                        placeholder = "••••••••",
                        visualTransformation =
                                if (passwordVisible)
                                        androidx.compose.ui.text.input.VisualTransformation.None
                                else PasswordVisualTransformation(),
                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),
                        modifier = Modifier.fillMaxWidth(),
                        isError = isPasswordError,
                        errorMessage =
                                if (isPasswordError) "Пароль не соответствует требованиям"
                                else null,
                        trailingIcon = {
                                IconButton(onClick = { passwordVisible = !passwordVisible }) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id =
                                                                        if (passwordVisible)
                                                                                R.drawable
                                                                                        .eye_off_an_inner_journey_icon_svg_co
                                                                        else
                                                                                R.drawable
                                                                                        .eye_closed
                                                        ),
                                                contentDescription =
                                                        if (passwordVisible) "Hide password"
                                                        else "Show password",
                                                tint = Color(0xFF7E7E9A),
                                                modifier = Modifier.size(24.dp)
                                        )
                                }
                        }
                )

                Spacer(modifier = Modifier.height(16.dp))

                AppTextField(
                        value = confirmPassword,
                        onValueChange = {
                                confirmPassword = it
                                isConfirmPasswordError = false
                        },
                        label = "Повторите пароль",
                        placeholder = "••••••••",
                        visualTransformation =
                                if (confirmPasswordVisible)
                                        androidx.compose.ui.text.input.VisualTransformation.None
                                else PasswordVisualTransformation(),
                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),
                        modifier = Modifier.fillMaxWidth(),
                        isError = isConfirmPasswordError,
                        errorMessage = if (isConfirmPasswordError) "Пароли не совпадают" else null,
                        trailingIcon = {
                                IconButton(
                                        onClick = {
                                                confirmPasswordVisible = !confirmPasswordVisible
                                        }
                                ) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id =
                                                                        if (confirmPasswordVisible)
                                                                                R.drawable
                                                                                        .eye_off_an_inner_journey_icon_svg_co
                                                                        else
                                                                                R.drawable
                                                                                        .eye_closed
                                                        ),
                                                contentDescription =
                                                        if (confirmPasswordVisible) "Hide password"
                                                        else "Show password",
                                                tint = Color(0xFF7E7E9A),
                                                modifier = Modifier.size(24.dp)
                                        )
                                }
                        }
                )

                Spacer(modifier = Modifier.height(16.dp))

                val hasLength = password.length >= 8
                val hasCase = password.any { it.isLowerCase() } && password.any { it.isUpperCase() }
                val hasDigit = password.any { it.isDigit() }
                val hasSpecial = password.any { !it.isLetterOrDigit() && !it.isWhitespace() }

                Column(modifier = Modifier.fillMaxWidth()) {
                        Text(
                                "Требования к паролю:",
                                style = CaptionRegular,
                                color = Color(0xFF939396)
                        )
                        Spacer(modifier = Modifier.height(8.dp))
                        RequirementItem("Минимум 8 символов", hasLength)
                        RequirementItem("Заглавные и строчные буквы", hasCase)
                        RequirementItem("Цифры", hasDigit)
                        RequirementItem("Спецсимволы", hasSpecial)
                }

                Spacer(modifier = Modifier.height(24.dp))

                Button(
                        onClick = {
                                if (password != confirmPassword) {
                                        isConfirmPasswordError = true
                                        Toast.makeText(
                                                        context,
                                                        "Пароли не совпадают",
                                                        Toast.LENGTH_SHORT
                                                )
                                                .show()
                                } else if (!viewModel.isValidPassword(password)) {
                                        isPasswordError = true
                                        Toast.makeText(
                                                        context,
                                                        "Пароль не соответствует требованиям",
                                                        Toast.LENGTH_SHORT
                                                )
                                                .show()
                                } else {
                                        val email = sessionManager.getCurrentEmail() ?: ""
                                        val name = sessionManager.getUserName(email) ?: ""
                                        viewModel.signUp(email, name, password)

                                        // Пытаемся сохранить учетные данные в Credential Manager.
                                        // Ошибка сохранения не должна блокировать регистрацию.
                                        scope.launch {
                                                credentialHelper.saveCredentials(
                                                        context = context,
                                                        email = email,
                                                        password = password
                                                )
                                        }
                                }
                        },
                        modifier = Modifier.fillMaxWidth().height(56.dp),
                        colors =
                                ButtonDefaults.buttonColors(
                                        containerColor =
                                                AccentBlue,
                                        disabledContainerColor = Color(0xFFC9D4FB)
                                ),
                        shape = RoundedCornerShape(10.dp),
                        enabled = authState !is AuthState.Loading
                ) {
                        if (authState is AuthState.Loading) {
                                CircularProgressIndicator(
                                        color = Color.White,
                                        modifier = Modifier.size(24.dp)
                                )
                        } else {
                                Text("Далее", color = Color.White, style = Title3Semibold)
                        }
                }
        }

        ErrorNotification(message = errorMessage, onDismiss = { errorMessage = null })
}

@Composable
fun RequirementItem(text: String, isMet: Boolean) {
        Row(verticalAlignment = Alignment.CenterVertically) {
                Box(
                        modifier =
                                Modifier.size(6.dp)
                                        .background(
                                                if (isMet) Color(0xFF00BFA5) else Color(0xFF939396),
                                                androidx.compose.foundation.shape.CircleShape
                                        )
                )
                Spacer(modifier = Modifier.width(8.dp))
                Text(
                        text = text,
                        style = CaptionRegular,
                        color = if (isMet) Color(0xFF00BFA5) else Color(0xFF939396)
                )
        }
}
```

## File: app/src/main/java/com/example/lol/authorization/SessionManager.kt
```kotlin
package com.example.lol.authorization

import android.content.Context
import android.content.SharedPreferences

class SessionManager(context: Context) {
    private val prefs: SharedPreferences =
            context.getSharedPreferences("user_session", Context.MODE_PRIVATE)

    companion object {
        private const val KEY_IS_LOGGED_IN = "is_logged_in"
        private const val KEY_CURRENT_USER_EMAIL = "current_user_email"
        private const val KEY_USERS_LIST = "registered_users"
        private const val KEY_LAST_ROUTE = "last_route"
        private const val KEY_ONE_SHOT_INACTIVITY_SENT = "one_shot_inactivity_sent"

        // Шаблоны ключей для данных конкретного пользователя.
        private fun keyPassword(email: String) = "user:$email:password"
        private fun keyPin(email: String) = "user:$email:pin"
        private fun keyName(email: String) = "user:$email:name"

        private const val KEY_NOTIFICATIONS_ENABLED = "notifications_enabled"
        private const val KEY_PROFILE_DRAFT_NAME = "profile_draft_name"
        private const val KEY_PROFILE_DRAFT_SURNAME = "profile_draft_surname"
        private const val KEY_PROFILE_DRAFT_PATRONYMIC = "profile_draft_patronymic"
        private const val KEY_PROFILE_DRAFT_BIRTHDAY = "profile_draft_birthday"
        private const val KEY_PROFILE_DRAFT_GENDER = "profile_draft_gender"
        private const val KEY_PROFILE_DRAFT_EMAIL = "profile_draft_email"
    }

    data class CreateProfileDraft(
            val name: String = "",
            val surname: String = "",
            val patronymic: String = "",
            val birthday: String = "",
            val gender: String = "",
            val email: String = ""
    )

    fun setNotificationsEnabled(enabled: Boolean) {
        prefs.edit().putBoolean(KEY_NOTIFICATIONS_ENABLED, enabled).apply()
    }

    fun isNotificationsEnabled(): Boolean {
        return prefs.getBoolean(KEY_NOTIFICATIONS_ENABLED, false)
    }

    fun markOneShotInactivityNotificationSent() {
        prefs.edit().putBoolean(KEY_ONE_SHOT_INACTIVITY_SENT, true).apply()
    }

    fun isOneShotInactivityNotificationSent(): Boolean {
        return prefs.getBoolean(KEY_ONE_SHOT_INACTIVITY_SENT, false)
    }

    fun resetOneShotInactivityNotificationCycle() {
        prefs.edit().putBoolean(KEY_ONE_SHOT_INACTIVITY_SENT, false).apply()
    }

    fun saveCreateProfileDraft(
            name: String,
            surname: String,
            patronymic: String,
            birthday: String,
            gender: String,
            email: String
    ) {
        prefs.edit()
                .putString(KEY_PROFILE_DRAFT_NAME, name)
                .putString(KEY_PROFILE_DRAFT_SURNAME, surname)
                .putString(KEY_PROFILE_DRAFT_PATRONYMIC, patronymic)
                .putString(KEY_PROFILE_DRAFT_BIRTHDAY, birthday)
                .putString(KEY_PROFILE_DRAFT_GENDER, gender)
                .putString(KEY_PROFILE_DRAFT_EMAIL, email)
                .apply()
    }

    fun getCreateProfileDraft(): CreateProfileDraft {
        return CreateProfileDraft(
                name = prefs.getString(KEY_PROFILE_DRAFT_NAME, "").orEmpty(),
                surname = prefs.getString(KEY_PROFILE_DRAFT_SURNAME, "").orEmpty(),
                patronymic = prefs.getString(KEY_PROFILE_DRAFT_PATRONYMIC, "").orEmpty(),
                birthday = prefs.getString(KEY_PROFILE_DRAFT_BIRTHDAY, "").orEmpty(),
                gender = prefs.getString(KEY_PROFILE_DRAFT_GENDER, "").orEmpty(),
                email = prefs.getString(KEY_PROFILE_DRAFT_EMAIL, "").orEmpty()
        )
    }

    fun clearCreateProfileDraft() {
        prefs.edit()
                .remove(KEY_PROFILE_DRAFT_NAME)
                .remove(KEY_PROFILE_DRAFT_SURNAME)
                .remove(KEY_PROFILE_DRAFT_PATRONYMIC)
                .remove(KEY_PROFILE_DRAFT_BIRTHDAY)
                .remove(KEY_PROFILE_DRAFT_GENDER)
                .remove(KEY_PROFILE_DRAFT_EMAIL)
                .apply()
    }

    fun saveLastRoute(route: String) {
        prefs.edit().putString(KEY_LAST_ROUTE, route).apply()
    }

    fun getLastRoute(): String {
        val route = prefs.getString(KEY_LAST_ROUTE, "Main") ?: "Main"
        val validStartRoutes =
                setOf(
                        "Main",
                        "Catalogue",
                        "Projects",
                        "Profile",
                        "Cart",
                        "MyOrders",
                        "CreateProject"
                )

        return when {
            route in validStartRoutes -> route
            route.startsWith("OrderDetails/") -> route
            route.startsWith("ProjectDetails/") -> route
            else -> "Main"
        }
    }

    fun isUserExists(email: String): Boolean {
        val users = prefs.getStringSet(KEY_USERS_LIST, emptySet()) ?: emptySet()
        return users.contains(email)
    }

    fun registerUser(email: String, name: String) {
        val users = prefs.getStringSet(KEY_USERS_LIST, emptySet())?.toMutableSet() ?: mutableSetOf()
        users.add(email)
        prefs.edit().putStringSet(KEY_USERS_LIST, users).putString(keyName(email), name).apply()
    }

    fun savePassword(email: String, password: String) {
        prefs.edit().putString(keyPassword(email), password).apply()
    }

    fun savePin(email: String, pin: String) {
        prefs.edit().putString(keyPin(email), pin).apply()
    }

    fun validatePassword(email: String, password: String): Boolean {
        val savedPassword = prefs.getString(keyPassword(email), null)
        return savedPassword == password
    }

    fun getUserPin(email: String): String? {
        return prefs.getString(keyPin(email), null)
    }

    fun getUserName(email: String): String? {
        return prefs.getString(keyName(email), null)
    }

    fun setCurrentEmail(email: String) {
        prefs.edit().putString(KEY_CURRENT_USER_EMAIL, email).apply()
    }

    fun getCurrentEmail(): String? {
        return prefs.getString(KEY_CURRENT_USER_EMAIL, null)
    }

    fun setLoggedIn(loggedIn: Boolean) {
        prefs.edit().putBoolean(KEY_IS_LOGGED_IN, loggedIn).apply()
    }

    fun isLoggedIn(): Boolean {
        return prefs.getBoolean(KEY_IS_LOGGED_IN, false)
    }

    fun clearSession() {
        prefs.edit()
                .remove(KEY_IS_LOGGED_IN)
                .remove(KEY_CURRENT_USER_EMAIL)
                .remove(KEY_LAST_ROUTE)
                .remove(KEY_ONE_SHOT_INACTIVITY_SENT)
                .remove(KEY_PROFILE_DRAFT_NAME)
                .remove(KEY_PROFILE_DRAFT_SURNAME)
                .remove(KEY_PROFILE_DRAFT_PATRONYMIC)
                .remove(KEY_PROFILE_DRAFT_BIRTHDAY)
                .remove(KEY_PROFILE_DRAFT_GENDER)
                .remove(KEY_PROFILE_DRAFT_EMAIL)
                .apply()
    }

    // Методы сохранены для совместимости со старым кодом и проксируют текущего пользователя.
    fun getEmail(): String? = getCurrentEmail()
    fun getUserName(): String? = getCurrentEmail()?.let { getUserName(it) } ?: "Эдуард"
    fun getPin(): String? = getCurrentEmail()?.let { getUserPin(it) }
}
```

## File: app/src/main/java/com/example/lol/authorization/SignInScreen.kt
```kotlin
package com.example.lol.authorization

import android.widget.Toast
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.lifecycle.viewmodel.compose.viewModel
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.components.AppTextField
import com.example.lol.components.ErrorNotification
import com.example.lol.data.network.TokenManager
import com.example.lol.domain.usecase.auth.LoginUseCase
import com.example.lol.domain.usecase.auth.LogoutUseCase
import com.example.lol.domain.usecase.auth.RegisterUseCase
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.TextBlack
import com.example.lol.ui.theme.TextGray
import com.example.lol.ui.theme.TextMedium
import com.example.lol.ui.theme.TextRegular
import com.example.lol.ui.theme.Title1ExtraBold
import com.example.lol.ui.theme.Title3Medium
import com.example.lol.ui.theme.Title3Semibold

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SignInScreen(navController: NavController) {
        var email by remember { mutableStateOf("") }
        var password by remember { mutableStateOf("") }
        var errorMessage by remember { mutableStateOf<String?>(null) }
        val context = LocalContext.current
        val sessionManager = remember { SessionManager(context) }
        val tokenManager = remember { TokenManager(context) }
        val authRepository = remember { AuthRepositoryProvider.provide(tokenManager) }
        val loginUseCase = remember { LoginUseCase(authRepository) }
        val registerUseCase = remember { RegisterUseCase(authRepository) }
        val logoutUseCase = remember { LogoutUseCase(authRepository) }
        val viewModel: AuthViewModel =
                viewModel(
                        factory =
                                AuthViewModelFactory(
                                        loginUseCase,
                                        registerUseCase,
                                        logoutUseCase,
                                        tokenManager,
                                        sessionManager
                                )
                )
        val authState by viewModel.authState.collectAsState()

        LaunchedEffect(authState) {
                when (authState) {
                        is AuthState.Success -> {
                                sessionManager.setCurrentEmail(email)
                                sessionManager.setLoggedIn(true)
                                sessionManager.resetOneShotInactivityNotificationCycle()
                                Toast.makeText(context, "С возвращением!", Toast.LENGTH_SHORT)
                                        .show()
                                navController.navigate("Home") {
                                        popUpTo("SignIn") { inclusive = true }
                                }
                                viewModel.resetState()
                        }
                        is AuthState.Error -> {
                                errorMessage = (authState as AuthState.Error).message
                                viewModel.resetState()
                        }
                        else -> {}
                }
        }

        Column(
                modifier =
                        Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp),
                verticalArrangement = Arrangement.Top,
                horizontalAlignment = Alignment.CenterHorizontally
        ) {
                Spacer(modifier = Modifier.height(103.dp))

                Column(
                        modifier = Modifier.fillMaxWidth(),
                        horizontalAlignment = Alignment.CenterHorizontally
                ) {
                        AuthModeBanner()
                        Spacer(modifier = Modifier.height(12.dp))
                        Text(
                                text = "Добро пожаловать!",
                                style = Title1ExtraBold,
                                color = TextBlack,
                                textAlign = TextAlign.Center
                        )
                        Spacer(modifier = Modifier.height(23.dp))
                        Text(
                                text = "Заполните данные для входа",
                                color = TextBlack,
                                style = TextRegular,
                                textAlign = TextAlign.Center
                        )
                }

                Spacer(modifier = Modifier.height(80.dp))

                var isEmailError by remember { mutableStateOf(false) }
                var isPasswordError by remember { mutableStateOf(false) }
                AppTextField(
                        value = email,
                        onValueChange = {
                                email = it
                                isEmailError = false
                        },
                        label = "Вход по E-mail",
                        placeholder = "example@mail.com",
                        modifier = Modifier.fillMaxWidth(),
                        isError = isEmailError,
                        errorMessage =
                                if (isEmailError) "Некорректная почта (name@domain.ru)" else null
                )

                Spacer(modifier = Modifier.height(16.dp))

                var passwordVisible by remember { mutableStateOf(false) }
                AppTextField(
                        value = password,
                        onValueChange = {
                                password = it
                                isPasswordError = false
                        },
                        label = "Пароль",
                        placeholder = "••••••••",
                        visualTransformation =
                                if (passwordVisible)
                                        androidx.compose.ui.text.input.VisualTransformation.None
                                else PasswordVisualTransformation(),
                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),
                        modifier = Modifier.fillMaxWidth(),
                        isError = isPasswordError,
                        errorMessage =
                                if (isPasswordError)
                                        "Пароль: мин. 8 символов, A-z, 0-9, спецсимволы"
                                else null,
                        trailingIcon = {
                                IconButton(onClick = { passwordVisible = !passwordVisible }) {
                                        Icon(
                                                painter =
                                                        painterResource(
                                                                id =
                                                                        if (passwordVisible)
                                                                                R.drawable
                                                                                        .eye_off_an_inner_journey_icon_svg_co
                                                                        else
                                                                                R.drawable
                                                                                        .eye_closed
                                                        ),
                                                contentDescription =
                                                        if (passwordVisible) "Hide password"
                                                        else "Show password",
                                                tint = Color(0xFF7E7E9A),
                                                modifier = Modifier.size(24.dp)
                                        )
                                }
                        }
                )

                Spacer(modifier = Modifier.height(16.dp))
                Box(modifier = Modifier.fillMaxWidth()) {
                        Text(
                                text = "Забыли пароль?",
                                color = TextGray,
                                style = CaptionRegular,
                                modifier =
                                        Modifier.align(Alignment.CenterEnd).clickable {
                                                /* TODO: открыть экран восстановления пароля */
                                        }
                        )
                }

                Spacer(modifier = Modifier.height(30.dp))

                Button(
                        onClick = {
                                var isValid = true
                                if (!viewModel.isValidEmail(email)) {
                                        isEmailError = true
                                        isValid = false
                                }
                                if (!viewModel.isValidPassword(password)) {
                                        isPasswordError = true
                                        isValid = false
                                }

                                if (isValid) {
                                        viewModel.signIn(email, password)
                                }
                        },
                        modifier = Modifier.fillMaxWidth().height(56.dp),
                        colors =
                                ButtonDefaults.buttonColors(
                                        containerColor =
                                                AccentBlue,
                                        disabledContainerColor = Color(0xFFC9D4FB)
                                ),
                        shape = RoundedCornerShape(10.dp),
                        enabled = authState !is AuthState.Loading
                ) {
                        if (authState is AuthState.Loading) {
                                CircularProgressIndicator(
                                        color = Color.White,
                                        modifier = Modifier.size(24.dp)
                                )
                        } else {
                                Text("Далее", color = Color.White, style = Title3Semibold)
                        }
                }

                Spacer(modifier = Modifier.height(24.dp))

                Row(verticalAlignment = Alignment.CenterVertically) {
                        Text("Нет аккаунта? ", color = TextGray, style = TextRegular)
                        Text(
                                "Зарегистрироваться",
                                color = Color(0xFF2074F2),
                                style = TextMedium,
                                fontWeight = FontWeight.Bold,
                                modifier = Modifier.clickable { navController.navigate("SignUp") }
                        )
                }

                Spacer(modifier = Modifier.weight(1f))

                Text(
                        text = "Или войдите с помощью",
                        style = TextRegular,
                        color = Color(0xFF939396),
                        textAlign = TextAlign.Center
                )

                Spacer(modifier = Modifier.height(16.dp))

                Button(
                        onClick = {
                                /* TODO: реализовать авторизацию через VK SDK */
                        },
                        modifier = Modifier.fillMaxWidth().height(60.dp),
                        colors = ButtonDefaults.buttonColors(containerColor = Color.White),
                        shape = RoundedCornerShape(12.dp),
                        border = androidx.compose.foundation.BorderStroke(1.dp, Color(0xFFEBEBEB)),
                        contentPadding = PaddingValues(0.dp)
                ) {
                        Row(
                                modifier = Modifier.fillMaxWidth(),
                                verticalAlignment = Alignment.CenterVertically,
                                horizontalArrangement = Arrangement.Center
                        ) {
                                Icon(
                                        painter = painterResource(id = R.drawable.vkh4_logo),
                                        contentDescription = "VK Logo",
                                        tint = Color.Unspecified,
                                        modifier = Modifier.size(48.dp)
                                )
                                Spacer(modifier = Modifier.width(16.dp))
                                Text("Войти с VK", color = Color.Black, style = Title3Medium)
                        }
                }

                Spacer(modifier = Modifier.height(12.dp))

                Button(
                        onClick = {
                                /* TODO: реализовать авторизацию через Яндекс ID */
                        },
                        modifier = Modifier.fillMaxWidth().height(60.dp),
                        colors = ButtonDefaults.buttonColors(containerColor = Color.White),
                        shape = RoundedCornerShape(12.dp),
                        border = androidx.compose.foundation.BorderStroke(1.dp, Color(0xFFEBEBEB))
                ) {
                        Row(verticalAlignment = Alignment.CenterVertically) {
                                Icon(
                                        painter = painterResource(id = R.drawable.vector),
                                        contentDescription = "Yandex Logo",
                                        tint = Color.Unspecified,
                                        modifier = Modifier.size(32.dp)
                                )
                                Spacer(modifier = Modifier.width(16.dp))
                                Text("Войти с Яндекс", color = Color.Black, style = Title3Medium)
                        }
                }

                Spacer(modifier = Modifier.height(20.dp))
        }

        ErrorNotification(message = errorMessage, onDismiss = { errorMessage = null })
}
```

## File: app/src/main/java/com/example/lol/authorization/SignUpScreen.kt
```kotlin
package com.example.lol.authorization

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.saveable.rememberSaveable
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.lifecycle.viewmodel.compose.viewModel
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.components.AppTextField
import com.example.lol.components.ErrorNotification
import com.example.lol.components.GenderSelectionSheet
import com.example.lol.data.network.TokenManager
import com.example.lol.domain.usecase.auth.LoginUseCase
import com.example.lol.domain.usecase.auth.LogoutUseCase
import com.example.lol.domain.usecase.auth.RegisterUseCase
import com.example.lol.ui.theme.CaptionRegular
import com.example.lol.ui.theme.Title1Semibold
import com.example.lol.ui.theme.Title3Semibold

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SignUpScreen(navController: NavController) {
    val context = LocalContext.current
    val sessionManager = remember { SessionManager(context) }
    val profileDraft = remember { sessionManager.getCreateProfileDraft() }

    var name by rememberSaveable { mutableStateOf(profileDraft.name) }
    var surname by rememberSaveable { mutableStateOf(profileDraft.surname) }
    var patronymic by rememberSaveable { mutableStateOf(profileDraft.patronymic) }
    var birthday by rememberSaveable { mutableStateOf(profileDraft.birthday) }
    var gender by rememberSaveable { mutableStateOf(profileDraft.gender) }
    var email by rememberSaveable { mutableStateOf(profileDraft.email) }

    var showGenderSheet by remember { mutableStateOf(false) }
    var errorMessage by remember { mutableStateOf<String?>(null) }
    var isNameError by remember { mutableStateOf(false) }
    var isSurnameError by remember { mutableStateOf(false) }
    var isPatronymicError by remember { mutableStateOf(false) }
    var isBirthdayError by remember { mutableStateOf(false) }
    var isGenderError by remember { mutableStateOf(false) }
    var isEmailError by remember { mutableStateOf(false) }

    val tokenManager = remember { TokenManager(context) }
    val authRepository = remember { AuthRepositoryProvider.provide(tokenManager) }
    val loginUseCase = remember { LoginUseCase(authRepository) }
    val registerUseCase = remember { RegisterUseCase(authRepository) }
    val logoutUseCase = remember { LogoutUseCase(authRepository) }
    val viewModel: AuthViewModel =
            viewModel(
                    factory =
                            AuthViewModelFactory(
                                    loginUseCase,
                                    registerUseCase,
                                    logoutUseCase,
                                    tokenManager,
                                    sessionManager
                            )
            )
    val authState by viewModel.authState.collectAsState()

    LaunchedEffect(authState) {
        when (authState) {
            is AuthState.Success -> {
                sessionManager.clearCreateProfileDraft()
                navController.navigate("CreatePassword")
                viewModel.resetState()
            }
            is AuthState.Error -> {
                errorMessage = (authState as AuthState.Error).message
                viewModel.resetState()
            }
            else -> {}
        }
    }

    LaunchedEffect(name, surname, patronymic, birthday, gender, email) {
        sessionManager.saveCreateProfileDraft(
                name = name,
                surname = surname,
                patronymic = patronymic,
                birthday = birthday,
                gender = gender,
                email = email
        )
    }

    Box(modifier = Modifier.fillMaxSize()) {
        Column(
                modifier =
                        Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp),
                verticalArrangement = Arrangement.Top,
                horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Spacer(modifier = Modifier.height(24.dp))

            Row(modifier = Modifier.fillMaxWidth()) {
                Box(
                        modifier =
                                Modifier.size(32.dp)
                                        .background(Color(0xFFF5F5F9), RoundedCornerShape(8.dp))
                                        .clickable { navController.popBackStack() },
                        contentAlignment = Alignment.Center
                ) {
                    Icon(
                            painter = painterResource(id = R.drawable.icon_chevron_left),
                            contentDescription = "Back",
                            modifier = Modifier.size(16.dp),
                            tint = Color.Black
                    )
                }
            }

            Spacer(modifier = Modifier.height(20.dp))

            Column(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalAlignment = Alignment.CenterHorizontally
            ) {
                AuthModeBanner()
                Spacer(modifier = Modifier.height(12.dp))
                Text(
                        text = "Создание Профиля",
                        style = Title1Semibold,
                        color = Color.Black,
                        textAlign = TextAlign.Center
                )
            }

            Spacer(modifier = Modifier.height(20.dp))

            Text(
                    text = "Без профиля вы не сможете создавать проекты.",
                    style = CaptionRegular,
                    color = Color(0xFF939396),
                    textAlign = TextAlign.Center,
                    modifier = Modifier.fillMaxWidth()
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                    text = "В профиле будут храниться результаты проектов и ваши описания.",
                    style = CaptionRegular,
                    color = Color(0xFF939396),
                    textAlign = TextAlign.Center,
                    modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(30.dp))

            Column(
                    modifier = Modifier.fillMaxWidth(),
                    verticalArrangement = Arrangement.spacedBy(24.dp)
            ) {
                AppTextField(
                        value = name,
                        onValueChange = {
                            name = it
                            isNameError = false
                        },
                        placeholder = "Имя",
                        isError = isNameError,
                        errorMessage = if (isNameError) "Введите имя" else null
                )
                AppTextField(
                        value = surname,
                        onValueChange = {
                            surname = it
                            isSurnameError = false
                        },
                        placeholder = "Фамилия",
                        isError = isSurnameError,
                        errorMessage = if (isSurnameError) "Введите фамилию" else null
                )
                AppTextField(
                        value = patronymic,
                        onValueChange = {
                            patronymic = it
                            isPatronymicError = false
                        },
                        placeholder = "Отчество",
                        isError = isPatronymicError,
                        errorMessage = if (isPatronymicError) "Введите отчество" else null
                )
                var showDatePicker by remember { mutableStateOf(false) }
                val datePickerState = androidx.compose.material3.rememberDatePickerState()

                Box(modifier = Modifier.clickable { showDatePicker = true }) {
                    AppTextField(
                            value = birthday,
                            onValueChange = {},
                            placeholder = "Дата рождения",
                            isError = isBirthdayError,
                            errorMessage = if (isBirthdayError) "Введите дату рождения" else null,
                            trailingIcon = {
                                Icon(
                                        painter = painterResource(id = R.drawable.icons2),
                                        contentDescription = "Calendar",
                                        tint = Color(0xFFBFC7D1),
                                        modifier = Modifier.size(20.dp)
                                )
                            }
                    )
                    Box(modifier = Modifier.matchParentSize().clickable { showDatePicker = true })
                }

                if (showDatePicker) {
                    androidx.compose.material3.DatePickerDialog(
                            onDismissRequest = { showDatePicker = false },
                            confirmButton = {
                                androidx.compose.material3.TextButton(
                                        onClick = {
                                            datePickerState.selectedDateMillis?.let {
                                                val date = java.util.Date(it)
                                                val format =
                                                        java.text.SimpleDateFormat(
                                                                "dd.MM.yyyy",
                                                                java.util.Locale.getDefault()
                                                        )
                                                birthday = format.format(date)
                                                isBirthdayError = false
                                            }
                                            showDatePicker = false
                                        }
                                ) { Text("OK") }
                            },
                            dismissButton = {
                                androidx.compose.material3.TextButton(
                                        onClick = { showDatePicker = false }
                                ) { Text("Отмена") }
                            }
                    ) { androidx.compose.material3.DatePicker(state = datePickerState) }
                }
                Box(modifier = Modifier.clickable { showGenderSheet = true }) {
                    AppTextField(
                            value = gender,
                            onValueChange = {},
                            placeholder = "Пол",
                            trailingIcon = {
                                Icon(
                                        painter =
                                                painterResource(id = R.drawable.icon_chevron_down),
                                        contentDescription = "Dropdown",
                                        tint = Color(0xFF7E7E9A)
                                )
                            },
                            isError = isGenderError,
                            errorMessage = if (isGenderError) "Выберите пол" else null
                    )
                    Box(modifier = Modifier.matchParentSize().clickable { showGenderSheet = true })
                }
                AppTextField(
                        value = email,
                        onValueChange = {
                            email = it
                            isEmailError = false
                        },
                        placeholder = "Почта",
                        isError = isEmailError,
                        errorMessage =
                                if (isEmailError) "Некорректная почта (name@domain.ru)" else null
                )
            }

            Spacer(modifier = Modifier.height(40.dp))

            Button(
                    onClick = {
                        var isValid = true

                        if (name.isBlank()) {
                            isNameError = true
                            isValid = false
                        }
                        if (surname.isBlank()) {
                            isSurnameError = true
                            isValid = false
                        }
                        if (patronymic.isBlank()) {
                            isPatronymicError = true
                            isValid = false
                        }
                        if (birthday.isBlank()) {
                            isBirthdayError = true
                            isValid = false
                        }
                        if (gender.isBlank()) {
                            isGenderError = true
                            isValid = false
                        }

                        val emailPattern = "^[a-z0-9]+@[a-z0-9]+\\.[a-z]+$".toRegex()
                        if (!email.matches(emailPattern)) {
                            isEmailError = true
                            isValid = false
                        }
                        if (!isValid) {
                            errorMessage = "Заполните все поля корректно"
                        } else {
                            sessionManager.setCurrentEmail(email)
                            sessionManager.registerUser(email, name)
                            sessionManager.clearCreateProfileDraft()
                            navController.navigate("CreatePassword")
                        }
                    },
                    modifier = Modifier.fillMaxWidth().height(56.dp),
                    colors =
                            ButtonDefaults.buttonColors(
                                    containerColor =
                                            Color(0xFF1A6FEE)
                            ),
                    shape = RoundedCornerShape(10.dp)
            ) { Text("Далее", color = Color.White, style = Title3Semibold) }
        }

        if (showGenderSheet) {
            GenderSelectionSheet(
                    onDismiss = { showGenderSheet = false },
                    onGenderSelected = {
                        gender = it
                        isGenderError = false
                        showGenderSheet = false
                    }
            )
        }

        ErrorNotification(message = errorMessage, onDismiss = { errorMessage = null })
    }
}
```

## File: app/src/main/java/com/example/lol/Profile/ProfileScreen.kt
```kotlin
package com.example.lol.Profile

import android.Manifest
import android.content.Intent
import android.content.pm.PackageManager
import android.net.Uri
import android.os.Build
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Switch
import androidx.compose.material3.SwitchDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.core.content.ContextCompat
import androidx.navigation.NavController
import com.example.lol.R
import com.example.lol.authorization.SessionManager
import com.example.lol.notifications.InactivityNotificationScheduler
import com.example.lol.ui.theme.HeadlineRegular
import com.example.lol.ui.theme.TextMedium
import com.example.lol.ui.theme.Title1Bold
import com.example.lol.ui.theme.Title3Semibold

@Composable
fun ProfileScreen(navController: NavController, rootNavController: NavController) {
        val context = androidx.compose.ui.platform.LocalContext.current
        val sessionManager = remember { SessionManager(context) }
        val showNotifications = remember { mutableStateOf(sessionManager.isNotificationsEnabled()) }

        val notificationsPermissionLauncher =
                rememberLauncherForActivityResult(
                        contract = ActivityResultContracts.RequestPermission(),
                        onResult = { isGranted ->
                                showNotifications.value = isGranted
                                sessionManager.setNotificationsEnabled(isGranted)
                        }
                )

        Column(
                modifier =
                        Modifier.fillMaxSize().background(Color.White).padding(horizontal = 20.dp)
        ) {
                Column(modifier = Modifier.padding(top = 76.dp)) {
                        Text(
                                text = sessionManager.getUserName() ?: "Эдуард",
                                style = Title1Bold,
                                color = Color.Black
                        )
                        Spacer(modifier = Modifier.height(8.dp))
                        Text(
                                text = sessionManager.getEmail() ?: "afersfsr@dsfsr.ru",
                                style = HeadlineRegular,
                                color = Color(0xFF939396)
                        )
                }

                Spacer(modifier = Modifier.height(24.dp))

                ProfileMenuItem(iconRes = R.drawable.order, title = "Мои заказы") {
                        navController.navigate("MyOrders")
                }

                ProfileMenuItem(
                        iconRes = R.drawable.settings,
                        title = "Уведомления",
                        isSwitch = true,
                        checked = showNotifications.value,
                        onCheckedChange = { isChecked ->
                                if (isChecked) {
                                        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
                                                val permissionCheckResult =
                                                        ContextCompat.checkSelfPermission(
                                                                context,
                                                                Manifest.permission
                                                                        .POST_NOTIFICATIONS
                                                        )
                                                if (permissionCheckResult ==
                                                                PackageManager.PERMISSION_GRANTED
                                                ) {
                                                        showNotifications.value = true
                                                        sessionManager.setNotificationsEnabled(true)
                                                } else {
                                                        notificationsPermissionLauncher.launch(
                                                                Manifest.permission
                                                                        .POST_NOTIFICATIONS
                                                        )
                                                }
                                        } else {
                                                showNotifications.value = true
                                                sessionManager.setNotificationsEnabled(true)
                                        }
                                } else {
                                        showNotifications.value = false
                                        sessionManager.setNotificationsEnabled(false)
                                        InactivityNotificationScheduler.cancel(context)
                                }
                        }
                ) {}

                Spacer(modifier = Modifier.height(176.dp))

                Column(
                        horizontalAlignment = Alignment.CenterHorizontally,
                        modifier = Modifier.fillMaxWidth()
                ) {
                        Text(
                                text = "Политика конфиденциальности",
                                color = Color(0xFF939396),
                                style = TextMedium,
                                modifier =
                                        Modifier.clickable {
                                                val browserIntent =
                                                        Intent(
                                                                Intent.ACTION_VIEW,
                                                                Uri.parse(
                                                                        "https://example.com/privacy_policy.pdf"
                                                                )
                                                        )
                                                context.startActivity(browserIntent)
                                        }
                        )
                        Spacer(modifier = Modifier.height(24.dp))
                        Text(
                                text = "Пользовательское соглашение",
                                color = Color(0xFF939396),
                                style = TextMedium,
                                modifier =
                                        Modifier.clickable {
                                                val browserIntent =
                                                        Intent(
                                                                Intent.ACTION_VIEW,
                                                                Uri.parse(
                                                                        "https://example.com/user_agreement.pdf"
                                                                )
                                                        )
                                                context.startActivity(browserIntent)
                                        }
                        )
                        Spacer(modifier = Modifier.height(24.dp))
                        Text(
                                text = "Выйти",
                                color = Color(0xFFFD3535),
                                style = TextMedium,
                                modifier =
                                        Modifier.clickable {
                                                sessionManager.clearSession()
                                                rootNavController.navigate("SignIn") {
                                                        popUpTo(0) { inclusive = true }
                                                }
                                        }
                        )
                }
        }
}

@Composable
fun ProfileMenuItem(
        iconRes: Int,
        title: String,
        isSwitch: Boolean = false,
        checked: Boolean = false,
        onCheckedChange: (Boolean) -> Unit = {},
        onClick: () -> Unit
) {
        Row(
                modifier = Modifier.fillMaxWidth().height(64.dp).clickable(onClick = onClick),
                verticalAlignment = Alignment.CenterVertically
        ) {
                Box(
                        modifier =
                                Modifier.size(32.dp)
                                        .background(Color(0xFFF5F5F9), RoundedCornerShape(8.dp)),
                        contentAlignment = Alignment.Center
                ) {
                        Icon(
                                painter = painterResource(id = iconRes),
                                contentDescription = null,
                                tint = Color.Unspecified,
                                modifier = Modifier.size(24.dp)
                        )
                }
                Spacer(modifier = Modifier.width(16.dp))
                Text(
                        text = title,
                        style = Title3Semibold,
                        color = Color.Black,
                        modifier = Modifier.weight(1f)
                )
                if (isSwitch) {
                        Switch(
                                checked = checked,
                                onCheckedChange = onCheckedChange,
                                colors =
                                        SwitchDefaults.colors(
                                                checkedThumbColor = Color.White,
                                                checkedTrackColor = Color(0xFF1A6FEE),
                                                uncheckedThumbColor = Color.White,
                                                uncheckedTrackColor = Color(0xFFD1D1D1),
                                                uncheckedBorderColor = Color.Transparent
                                        )
                        )
                }
        }
}
```

## File: app/src/main/java/com/example/lol/MainActivity.kt
```kotlin
package com.example.lol

import android.app.Application
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import androidx.compose.animation.core.FastOutSlowInEasing
import androidx.compose.animation.core.tween
import androidx.compose.animation.fadeIn
import androidx.compose.animation.fadeOut
import androidx.compose.animation.scaleIn
import androidx.compose.animation.scaleOut
import androidx.compose.animation.slideInHorizontally
import androidx.compose.animation.slideInVertically
import androidx.compose.animation.slideOutHorizontally
import androidx.compose.animation.slideOutVertically
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.material3.Icon
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.NavigationBar
import androidx.compose.material3.NavigationBarItem
import androidx.compose.material3.NavigationBarItemDefaults
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.saveable.rememberSaveable
import androidx.compose.runtime.setValue
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.lifecycle.viewmodel.compose.viewModel
import androidx.navigation.NavController
import androidx.navigation.NavType
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.currentBackStackEntryAsState
import androidx.navigation.compose.rememberNavController
import androidx.navigation.navArgument
import com.example.lol.Cart.CartScreen
import com.example.lol.Cart.CartViewModel
import com.example.lol.Cart.CartViewModelFactory
import com.example.lol.Catalogue.CatalogueScreen
import com.example.lol.Catalogue.CatalogueViewModel
import com.example.lol.Catalogue.CatalogueViewModelFactory
import com.example.lol.Main.MainScreen
import com.example.lol.Profile.MyOrdersScreen
import com.example.lol.Profile.OrdersViewModelFactory
import com.example.lol.Profile.ProfileScreen
import com.example.lol.Projects.CreateProjectScreen
import com.example.lol.Projects.ProjectsScreen
import com.example.lol.Projects.ProjectsViewModel
import com.example.lol.Projects.ProjectsViewModelFactory
import com.example.lol.authorization.CreatePasswordScreen
import com.example.lol.authorization.CreatePinScreen
import com.example.lol.authorization.PinCodeScreen
import com.example.lol.authorization.SignInScreen
import com.example.lol.authorization.SignUpScreen
import com.example.lol.authorization.SplashScreen
import com.example.lol.components.AppTabBar
import com.example.lol.components.AppTabBarItem
import com.example.lol.data.network.RetrofitInstance
import com.example.lol.data.network.TokenManager
import com.example.lol.data.repository.CartRepository
import com.example.lol.data.repository.OrderRepository
import com.example.lol.data.repository.ProductRepositoryApi
import com.example.lol.data.repository.ProjectRepository
import com.example.lol.domain.usecase.cart.AddToCartUseCase
import com.example.lol.domain.usecase.cart.UpdateCartItemUseCase
import com.example.lol.domain.usecase.product.GetProductsUseCase
import com.example.lol.domain.usecase.product.SearchProductsUseCase
import com.example.lol.notifications.InactivityNotificationScheduler
import com.example.lol.ui.theme.AccentBlue
import com.example.lol.ui.theme.LolTheme

class MainActivity : ComponentActivity() {
        override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)

                // Инициализация TokenManager и настройка RetrofitInstance
                val tokenManager = TokenManager(this)
                RetrofitInstance.setTokenProvider { tokenManager.getToken() }

                enableEdgeToEdge()
                setContent {
                        LolTheme {
                                Surface(
                                        modifier = Modifier.fillMaxSize(),
                                        color = MaterialTheme.colorScheme.background
                                ) {
                                        val navController = rememberNavController()

                                        NavHost(
                                                navController = navController,
                                                startDestination = "Splash"
                                        ) {
                                                // Splash: только плавное исчезновение.
                                                composable(
                                                        route = "Splash",
                                                        exitTransition = {
                                                                fadeOut(animationSpec = tween(400))
                                                        }
                                                ) { SplashScreen(navController = navController) }
                                                // SignIn: плавное появление и сдвиг при переходах.
                                                composable(
                                                        route = "SignIn",
                                                        enterTransition = {
                                                                fadeIn(animationSpec = tween(300))
                                                        },
                                                        exitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popEnterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popExitTransition = {
                                                                fadeOut(animationSpec = tween(300))
                                                        }
                                                ) { SignInScreen(navController = navController) }
                                                // PinCode: плавное появление после Splash.
                                                composable(
                                                        route = "PinCode",
                                                        enterTransition = {
                                                                fadeIn(animationSpec = tween(300))
                                                        },
                                                        exitTransition = {
                                                                fadeOut(
                                                                        animationSpec = tween(300)
                                                                ) + scaleOut(targetScale = 0.9f)
                                                        },
                                                        popEnterTransition = {
                                                                fadeIn(animationSpec = tween(300))
                                                        },
                                                        popExitTransition = {
                                                                fadeOut(animationSpec = tween(300))
                                                        }
                                                ) { PinCodeScreen(navController = navController) }
                                                // SignUp: горизонтальные переходы.
                                                composable(
                                                        route = "SignUp",
                                                        enterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        exitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popEnterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popExitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        }
                                                ) { SignUpScreen(navController = navController) }
                                                // CreatePassword: горизонтальные переходы.
                                                composable(
                                                        route = "CreatePassword",
                                                        enterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        exitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popEnterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popExitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        }
                                                ) {
                                                        CreatePasswordScreen(
                                                                navController = navController
                                                        )
                                                }
                                                // CreatePin: горизонтальные переходы, затем fade+scale в Home.
                                                composable(
                                                        route = "CreatePin",
                                                        enterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        exitTransition = {
                                                                fadeOut(
                                                                        animationSpec = tween(300)
                                                                ) + scaleOut(targetScale = 0.9f)
                                                        },
                                                        popEnterTransition = {
                                                                slideInHorizontally(
                                                                        initialOffsetX = { -it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        },
                                                        popExitTransition = {
                                                                slideOutHorizontally(
                                                                        targetOffsetX = { it },
                                                                        animationSpec =
                                                                                tween(
                                                                                        300,
                                                                                        easing =
                                                                                                FastOutSlowInEasing
                                                                                )
                                                                )
                                                        }
                                                ) { CreatePinScreen(navController = navController) }
                                                // Home: плавное появление и масштаб.
                                                composable(
                                                        route = "Home",
                                                        enterTransition = {
                                                                fadeIn(animationSpec = tween(400)) +
                                                                        scaleIn(
                                                                                initialScale = 0.95f
                                                                        )
                                                        }
                                                ) {
                                                        MainContainer(
                                                                application = application,
                                                                rootNavController = navController,
                                                                tokenManager = tokenManager
                                                        )
                                                }
                                        }
                                }
                        }
                }
        }

        override fun onResume() {
                super.onResume()
                InactivityNotificationScheduler.cancel(this)
        }

        override fun onStop() {
                super.onStop()
                val sessionManager = com.example.lol.authorization.SessionManager(this)
                if (sessionManager.isNotificationsEnabled()) {
                        InactivityNotificationScheduler.schedule(this, sessionManager)
                }
        }
}

@Composable
fun MainContainer(
        application: Application,
        rootNavController: NavController,
        tokenManager: TokenManager
) {
        val navController = rememberNavController()
        val context = LocalContext.current
        val sessionManager = remember { com.example.lol.authorization.SessionManager(context) }

        // Создание API репозиториев
        val api = RetrofitInstance.api
        val productRepositoryApi = remember { ProductRepositoryApi(api) }
        val cartRepository = remember { CartRepository(api) }
        val projectRepository = remember { ProjectRepository(api) }
        val orderRepository = remember { OrderRepository(api) }

        // Создание use case-ов.
        val getProductsUseCase = remember { GetProductsUseCase(productRepositoryApi) }
        val searchProductsUseCase = remember { SearchProductsUseCase(productRepositoryApi) }
        val addToCartUseCase = remember { AddToCartUseCase(cartRepository) }
        val updateCartItemUseCase = remember { UpdateCartItemUseCase(cartRepository) }

        // Создание ViewModel с use case-ами из domain-слоя.
        val catalogueViewModel: CatalogueViewModel =
                viewModel(
                        factory =
                                CatalogueViewModelFactory(
                                        application,
                                        getProductsUseCase,
                                        searchProductsUseCase
                                )
                )
        val cartViewModel: CartViewModel =
                viewModel(
                        factory =
                                CartViewModelFactory(
                                        addToCartUseCase,
                                        updateCartItemUseCase,
                                        tokenManager
                                )
                )
        val projectsViewModel: ProjectsViewModel =
                viewModel(
                        factory =
                                ProjectsViewModelFactory(
                                        application,
                                        projectRepository,
                                        tokenManager
                                )
                )
        val ordersViewModel: com.example.lol.Profile.OrdersViewModel =
                viewModel(
                        factory = OrdersViewModelFactory(application, orderRepository, tokenManager)
                )

        LaunchedEffect(navController) {
                navController.currentBackStackEntryFlow.collect { backStackEntry ->
                        backStackEntry.destination.route?.let { route ->
                                sessionManager.saveLastRoute(route)
                        }
                }
        }
        var hasNavigatedToLastRoute by rememberSaveable { mutableStateOf(false) }
        val lastRoute = remember { sessionManager.getLastRoute() }

        LaunchedEffect(Unit) {
                if (!hasNavigatedToLastRoute && lastRoute != "Main") {
                        hasNavigatedToLastRoute = true
                        try {
                                navController.navigate(lastRoute) {
                                        popUpTo("Main") { inclusive = false }
                                        launchSingleTop = true
                                }
                        } catch (e: Exception) {
                                // Если маршрут недействителен, остаёмся на Main
                        }
                }
        }

        val navBackStackEntry by navController.currentBackStackEntryAsState()
        val currentRoute = navBackStackEntry?.destination?.route
        val showBottomBar =
                currentRoute !in listOf("Cart", "ProductDetails/{productId}", "CreateProject")

        Scaffold(
                bottomBar = {
                        if (showBottomBar) {
                                BottomNavigationBar(navController)
                        }
                }
        ) { innerPadding ->
                Box(modifier = Modifier.padding(innerPadding)) {
                        NavHost(navController = navController, startDestination = "Main") {
                                // Main: fade+scale при переключении табов.
                                composable(
                                        route = "Main",
                                        enterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        exitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        },
                                        popEnterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        popExitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        }
                                ) {
                                        MainScreen(
                                                navController = navController,
                                                viewModel = catalogueViewModel,
                                                cartViewModel = cartViewModel
                                        )
                                }
                                // Catalogue: fade+scale при переключении табов.
                                composable(
                                        route = "Catalogue",
                                        enterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        exitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        },
                                        popEnterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        popExitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        }
                                ) {
                                        CatalogueScreen(
                                                navController = navController,
                                                viewModel = catalogueViewModel,
                                                cartViewModel = cartViewModel
                                        )
                                }
                                // Cart: вертикальные переходы в модальном стиле.
                                composable(
                                        route = "Cart",
                                        enterTransition = {
                                                slideInVertically(
                                                        initialOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeIn(animationSpec = tween(300))
                                        },
                                        exitTransition = {
                                                slideOutVertically(
                                                        targetOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeOut(animationSpec = tween(300))
                                        },
                                        popEnterTransition = { fadeIn(animationSpec = tween(200)) },
                                        popExitTransition = {
                                                slideOutVertically(
                                                        targetOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeOut(animationSpec = tween(300))
                                        }
                                ) {
                                        CartScreen(
                                                navController = navController,
                                                viewModel = cartViewModel,
                                                ordersViewModel = ordersViewModel
                                        )
                                }
                                // Profile: fade+scale при переключении табов.
                                composable(
                                        route = "Profile",
                                        enterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        exitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        },
                                        popEnterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        popExitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        }
                                ) {
                                        ProfileScreen(
                                                navController = navController,
                                                rootNavController = rootNavController
                                        )
                                }
                                // MyOrders: горизонтальные переходы по иерархии.
                                composable(
                                        route = "MyOrders",
                                        enterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        exitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popEnterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popExitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        }
                                ) {
                                        MyOrdersScreen(
                                                navController = navController,
                                                viewModel = ordersViewModel
                                        )
                                }
                                // OrderDetails: горизонтальные переходы по иерархии.
                                composable(
                                        route = "OrderDetails/{orderId}",
                                        arguments =
                                                listOf(
                                                        navArgument("orderId") {
                                                                type = NavType.StringType
                                                        }
                                                ),
                                        enterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        exitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popEnterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popExitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        }
                                ) { backStackEntry ->
                                        val orderId =
                                                backStackEntry.arguments?.getString("orderId")
                                                        ?: return@composable
                                        com.example.lol.Profile.OrderDetailsScreen(
                                                navController = navController,
                                                viewModel = ordersViewModel,
                                                orderId = orderId
                                        )
                                }
                                // Projects: fade+scale при переключении табов.
                                composable(
                                        route = "Projects",
                                        enterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        exitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        },
                                        popEnterTransition = {
                                                fadeIn(animationSpec = tween(200)) +
                                                        scaleIn(initialScale = 0.96f)
                                        },
                                        popExitTransition = {
                                                fadeOut(animationSpec = tween(200)) +
                                                        scaleOut(targetScale = 0.96f)
                                        }
                                ) {
                                        ProjectsScreen(
                                                navController = navController,
                                                viewModel = projectsViewModel
                                        )
                                }
                                // CreateProject: вертикальные переходы в модальном стиле.
                                composable(
                                        route = "CreateProject",
                                        enterTransition = {
                                                slideInVertically(
                                                        initialOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeIn(animationSpec = tween(300))
                                        },
                                        exitTransition = {
                                                slideOutVertically(
                                                        targetOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeOut(animationSpec = tween(300))
                                        },
                                        popEnterTransition = { fadeIn(animationSpec = tween(200)) },
                                        popExitTransition = {
                                                slideOutVertically(
                                                        targetOffsetY = { fullHeight ->
                                                                fullHeight
                                                        },
                                                        animationSpec = tween(300)
                                                ) + fadeOut(animationSpec = tween(300))
                                        }
                                ) {
                                        CreateProjectScreen(
                                                navController = navController,
                                                viewModel = projectsViewModel
                                        )
                                }
                                // ProjectDetails: горизонтальные переходы по иерархии.
                                composable(
                                        route = "ProjectDetails/{projectId}",
                                        arguments =
                                                listOf(
                                                        navArgument("projectId") {
                                                                type = NavType.StringType
                                                        }
                                                ),
                                        enterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        exitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popEnterTransition = {
                                                slideInHorizontally(
                                                        initialOffsetX = { -it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        },
                                        popExitTransition = {
                                                slideOutHorizontally(
                                                        targetOffsetX = { it },
                                                        animationSpec =
                                                                tween(
                                                                        300,
                                                                        easing = FastOutSlowInEasing
                                                                )
                                                )
                                        }
                                ) { backStackEntry ->
                                        val projectId =
                                                backStackEntry.arguments?.getString("projectId")
                                                        ?: return@composable
                                        com.example.lol.Projects.ProjectDetailsScreen(
                                                navController = navController,
                                                viewModel = projectsViewModel,
                                                projectId = projectId
                                        )
                                }
                        }
                }
        }
}

@Composable
fun BottomNavigationBar(navController: NavController) {
        val items =
                listOf(
                        BottomNavItem("Main", "Главная", R.drawable.analizy),
                        BottomNavItem("Catalogue", "Каталог", R.drawable.rezultaty),
                        BottomNavItem("Projects", "Проекты", R.drawable.podderzhka),
                        BottomNavItem("Profile", "Профиль", R.drawable.polzovatel)
                )

        val navBackStackEntry by navController.currentBackStackEntryAsState()
        val currentRoute = navBackStackEntry?.destination?.route ?: "Main"

        AppTabBar(
                items =
                        items.map {
                                AppTabBarItem(
                                        route = it.route,
                                        title = it.title,
                                        iconRes = it.iconRes
                                )
                        },
                selectedRoute = currentRoute,
                onItemSelected = { route ->
                        navController.navigate(route) {
                                popUpTo(navController.graph.startDestinationId) {
                                        saveState = true
                                }
                                launchSingleTop = true
                        }
                },
                modifier =
                        Modifier.height(88.dp)
                                .shadow(
                                        elevation = 0.5.dp,
                                        spotColor = Color(0x4DA0A0A0)
                                )
        )
}

data class BottomNavItem(val route: String, val title: String, val iconRes: Int)
```
